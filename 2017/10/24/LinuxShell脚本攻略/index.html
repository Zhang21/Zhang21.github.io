<!DOCTYPE html>




<html class="theme-next muse" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="小试牛刀简介1234567891011#bash(Bourne Again Shell)，shell环境使得用户能与操作系统的内核进行交互操作#!/bin/bash#date#descriptioncmd1; cmd2cmd3#sh /path/xx.sh#Bash还有一个历史记录文件 ~/.bash_history">
<meta property="og:type" content="article">
<meta property="og:title" content="LinuxShell脚本攻略">
<meta property="og:url" content="https://zhang21.github.io/2017/10/24/LinuxShell脚本攻略/index.html">
<meta property="og:site_name" content="风继续吹">
<meta property="og:description" content="小试牛刀简介1234567891011#bash(Bourne Again Shell)，shell环境使得用户能与操作系统的内核进行交互操作#!/bin/bash#date#descriptioncmd1; cmd2cmd3#sh /path/xx.sh#Bash还有一个历史记录文件 ~/.bash_history">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-11-28T08:03:24.179Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LinuxShell脚本攻略">
<meta name="twitter:description" content="小试牛刀简介1234567891011#bash(Bourne Again Shell)，shell环境使得用户能与操作系统的内核进行交互操作#!/bin/bash#date#descriptioncmd1; cmd2cmd3#sh /path/xx.sh#Bash还有一个历史记录文件 ~/.bash_history">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.2',
    sidebar: {"position":"left","display":"hide","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://zhang21.github.io/2017/10/24/LinuxShell脚本攻略/"/>





  <title>LinuxShell脚本攻略 | 风继续吹</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">风继续吹</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Yesterday, you said tomorrow!</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhang21.github.io/2017/10/24/LinuxShell脚本攻略/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang21">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风继续吹">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">LinuxShell脚本攻略</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-24T18:16:38+08:00">
                2017-10-24
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/24/LinuxShell脚本攻略/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/24/LinuxShell脚本攻略/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="小试牛刀"><a href="#小试牛刀" class="headerlink" title="小试牛刀"></a>小试牛刀</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#bash(Bourne Again Shell)，shell环境使得用户能与操作系统的内核进行交互操作</span></div><div class="line"></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#date</span></div><div class="line"><span class="comment">#description</span></div><div class="line"></div><div class="line">cmd1; cmd2</div><div class="line">cmd3</div><div class="line"></div><div class="line"><span class="comment">#sh /path/xx.sh</span></div><div class="line"><span class="comment">#Bash还有一个历史记录文件 ~/.bash_history</span></div></pre></td></tr></table></figure>
<a id="more"></a>
<p><br></p>
<h2 id="终端打印"><a href="#终端打印" class="headerlink" title="终端打印"></a>终端打印</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#终端作为交互式工具，用户可以通过它与shell环境进行交互</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">'$var'</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$var</span></div><div class="line"><span class="built_in">echo</span> -e <span class="string">"1\t2\t3"</span></div><div class="line"><span class="built_in">echo</span> -e <span class="string">'\e[1;31m Red color \e[0m'</span>    <span class="comment">#彩色</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> &#123;1..10&#125;		<span class="comment">#输出1到10</span></div><div class="line"><span class="built_in">echo</span> &#123;A..H&#125;		<span class="comment">#for i in &#123;a..z&#125;</span></div><div class="line"></div><div class="line">cat &lt;&lt; EOF</div><div class="line">11</div><div class="line">22</div><div class="line">33</div><div class="line">EOF</div><div class="line"></div><div class="line"><span class="comment"># \转义字符</span></div><div class="line"><span class="built_in">printf</span> <span class="string">"%-5s %-10s $-4.2f\n"</span> 001 Zhang 56.789</div><div class="line"><span class="comment">#格式替代符%s %d %c %f, -左对齐</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="玩转变量和环境变量"><a href="#玩转变量和环境变量" class="headerlink" title="玩转变量和环境变量"></a>玩转变量和环境变量</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Bash中，每一个变量默认值值都是字符串形式</span></div><div class="line"><span class="comment">#环境变量和自定义变量</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="variable">$SHELL</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$UID</span></div><div class="line"></div><div class="line">var=value	<span class="comment">#这是赋值</span></div><div class="line"><span class="comment">#var = value这是相等操作</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$var</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var&#125;</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#var&#125;</span>	<span class="comment">#字符数</span></div><div class="line"></div><div class="line"><span class="comment">#export用来设置环境变量，此后，任何shell中的程序都会继承环境变量</span></div><div class="line">ZHANG=Gentleman</div><div class="line"><span class="built_in">export</span> ZHANG</div><div class="line"></div><div class="line">PATH=<span class="string">"<span class="variable">$PATH</span>:/home/zhang/bin"</span></div><div class="line"><span class="built_in">export</span> <span class="variable">$PATH</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="通过shell进行数学运算"><a href="#通过shell进行数学运算" class="headerlink" title="通过shell进行数学运算"></a>通过shell进行数学运算</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#let, expr, bc, [], (())</span></div><div class="line"><span class="comment">#要注意默认是字符串类型哦</span></div><div class="line"></div><div class="line">n1=1;n2=2</div><div class="line"><span class="built_in">let</span> sum=n1+n2</div><div class="line"><span class="built_in">let</span> n1++;<span class="built_in">let</span> n2-=1</div><div class="line"></div><div class="line">sum=$[ n1 + n2 ]</div><div class="line">sum2=$(( sum + 3 ))</div><div class="line"></div><div class="line">sum=`expr 3 + 4`</div><div class="line"></div><div class="line"><span class="comment">#浮点计算 bc</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"8 * 1.1"</span> | bc</div><div class="line"></div><div class="line"><span class="comment">#设置小数点精度</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"scale=2; 3/8"</span> | bc</div><div class="line"></div><div class="line"><span class="comment">#进制转换</span></div><div class="line">num=100</div><div class="line"><span class="built_in">echo</span> <span class="string">"obase=2; <span class="variable">$num</span>"</span> | bc</div><div class="line"></div><div class="line">num=1100100</div><div class="line"><span class="built_in">echo</span> <span class="string">"obase=10; ibase=2; <span class="variable">$num</span>"</span> | bc</div><div class="line"></div><div class="line"><span class="comment">#平方和平方根</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"sqrt(100)"</span> | bc</div><div class="line"><span class="built_in">echo</span> <span class="string">"10^2"</span> | bc</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="文件描述符重定向"><a href="#文件描述符重定向" class="headerlink" title="文件描述符重定向"></a>文件描述符重定向</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#最常用的文件描述符是 stdin(0), stdout(1), stderr(2); 通过内容过滤将输出重定向到文件</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"This is a sample text 1"</span> &gt; temp.txt	<span class="comment">#覆盖</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"This is sample text 2"</span> &gt;&gt; temp.txt	<span class="comment">#追加</span></div><div class="line"></div><div class="line">ls + &gt;stdout.txt 2&gt;stderr.txt</div><div class="line">cmd 2&gt;&amp;1 /dev/null  == com &amp;&gt; /dev/null		<span class="comment">#null设备也被称为黑洞</span></div><div class="line"></div><div class="line"><span class="comment">#当一个command发生错误并退回时，它会返回一个非0的状态码</span></div><div class="line"><span class="built_in">echo</span> $?</div><div class="line"></div><div class="line"><span class="comment">#tee命令，一方面可将数据重定向到文件，另一方面还可提供一份重定向数据的副本作为后续命令的stdin</span></div><div class="line"><span class="comment">#tee默认覆盖文件，-a选项追加</span></div><div class="line">cat temp.txt | tee tee.txt | cat -n</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="数组和关联数组"><a href="#数组和关联数组" class="headerlink" title="数组和关联数组"></a>数组和关联数组</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#数组借助索引将多个独立的数据存储为一个集合</span></div><div class="line"><span class="comment">#普通数组只能使用整数作为数组索引，而关联数组可以使用字符串作为数组索引</span></div><div class="line"><span class="comment">#还可将数组定义成一组索引-值(index-value)</span></div><div class="line"></div><div class="line">arr=(1 two 3 four 5)</div><div class="line"><span class="built_in">echo</span> <span class="variable">$&#123;arr[0]&#125;</span></div><div class="line">arr[0]=One</div><div class="line"></div><div class="line">index=3</div><div class="line"><span class="built_in">echo</span> $&#123;arr[<span class="variable">$index</span>]		<span class="comment">#arr[3]</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$&#123;arr[*]&#125;</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#arr[*]&#125;</span>		<span class="comment">#arr-length</span></div><div class="line"></div><div class="line"><span class="comment">#关联数组可用任意文本作为数组索引</span></div><div class="line"><span class="built_in">declare</span> -A ass_arr</div><div class="line">ass_arr=([index1]=val1 [index2]=val2 ...)	<span class="comment">#内嵌索引-值</span></div><div class="line">ass_arr[index3]=val3	<span class="comment">#独立索引-值</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$&#123;!ass_arr[*]&#125;</span>		<span class="comment">#列出数组索引</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#alias作用是暂时的，关闭终端后别名就失效；</span></div><div class="line"><span class="comment">#为使别名一直保持，可将其写入 ~/.bashrc，因为每一个新的shell都会执行~/.bashrc中的命令</span></div><div class="line"><span class="comment">#新设置的别名将取代已有别名</span></div><div class="line"></div><div class="line"><span class="built_in">alias</span> vi=vim; <span class="built_in">unalias</span> vi</div><div class="line"><span class="built_in">echo</span> <span class="string">"alias ll='ls -l --color=auto'"</span> &gt;&gt; ~/.bashrc</div><div class="line"></div><div class="line"><span class="comment">#\对别名命令进行转义，执行原本的命令。避免攻击者利用别名将某些特权命令替换成别有用心的命令</span></div><div class="line">\vi test.sh</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="获取、设置日期和延时"><a href="#获取、设置日期和延时" class="headerlink" title="获取、设置日期和延时"></a>获取、设置日期和延时</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#很多应用程序需要以不同的格式打印日期，设置日期和时间，以及根据日期和时间执行操作;</span></div><div class="line"><span class="comment">#延时通常用于在程序执行过程中提供一段等待时间;</span></div><div class="line"><span class="comment">#在Unix-like系统中，日期被存储为一个整数，其大小为世界标准时间1970年1月1日0时0分0秒起所流逝的秒数；</span></div><div class="line"><span class="comment">#这种计时方式被称之为 纪元时或Unix时间；</span></div><div class="line"><span class="comment">#通过纪元时间，可知道两个日期之间相隔了多少秒</span></div><div class="line"><span class="comment">#编写以循环方式运行的监视脚本时，设置时间间隔是必不可少的</span></div><div class="line"></div><div class="line">date +%s</div><div class="line"></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">start=$(date +%s)</div><div class="line">commands</div><div class="line">sleep 1</div><div class="line">end=$(date +%s)</div><div class="line">diff=$((end - start))</div><div class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$diff</span> seconds"</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="调试脚本"><a href="#调试脚本" class="headerlink" title="调试脚本"></a>调试脚本</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#调试功能能在出现一些异常情况时生成运行信息</span></div><div class="line"></div><div class="line"><span class="comment">#!/bin/bash -xv</span></div><div class="line">sh -x</div><div class="line">sh -n</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="函数和参数"><a href="#函数和参数" class="headerlink" title="函数和参数"></a>函数和参数</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> fname()</div><div class="line">&#123;</div><div class="line">statements</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">fname()</div><div class="line">&#123;</div><div class="line"><span class="built_in">echo</span> <span class="variable">$1</span>, <span class="variable">$2</span>		<span class="comment">#访问第参数1和参数2,$n第n个参数</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$@</span>"</span>		<span class="comment">#以列表的形式一次性打印所有参数</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"$*"</span>		<span class="comment">#类似于$@，但参数被作为单个实体</span></div><div class="line"><span class="built_in">return</span> 0		<span class="comment">#f返回值</span></div><div class="line">&#125;</div><div class="line">fname 1 22 333	<span class="comment">#返回上面定义的变量</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#递归函数，能够调用自身，不断地生成新的进程，最终会造成xx</span></div><div class="line"><span class="comment">#导出函数，使用export导出，这样函数作用域就可以扩展到子进程</span></div><div class="line"><span class="built_in">export</span> -f fname</div><div class="line"><span class="comment">#读取命令返回值</span></div><div class="line"><span class="built_in">echo</span> $?</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="读取命令序列输出"><a href="#读取命令序列输出" class="headerlink" title="读取命令序列输出"></a>读取命令序列输出</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#输入通常是stdin，输出stderr或stdout,这些命令称为 过滤器(filter)。我们使用 管道(pipe) 来连接每一个过滤器</span></div><div class="line">cmd1 | cmd2 | cmd3</div><div class="line"></div><div class="line"><span class="comment">#子shell，子shell生成独立的进程，不会对当前shell有任何影响，所做改变仅限于子shell内</span></div><div class="line">zhang=$(ls | cat -n)</div><div class="line"><span class="comment">#反引用</span></div><div class="line">zhang=`ls | cat -n`</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="读取字符"><a href="#读取字符" class="headerlink" title="读取字符"></a>读取字符</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#read是一个重要的从标准输入中读取文本的命令</span></div><div class="line"><span class="comment">#可以使用read以交互的形式来读取用户的输入</span></div><div class="line"></div><div class="line"><span class="built_in">read</span> -n 5 zhang		<span class="comment">#读取字符数</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$zhang</span></div><div class="line"></div><div class="line"><span class="built_in">read</span> -s passwd		<span class="comment">#不回显</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$passwd</span></div><div class="line"></div><div class="line"><span class="built_in">read</span> -t 5 zhang		<span class="comment">#超时时间</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$zhang</span></div><div class="line"></div><div class="line"><span class="built_in">read</span> -p zhang		<span class="comment">#显示提示信息</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$zhang</span></div><div class="line"></div><div class="line"><span class="built_in">read</span> -d <span class="string">":"</span> zhang		<span class="comment">#定界符结束输入</span></div><div class="line">123：</div><div class="line"><span class="built_in">echo</span> <span class="variable">$zhang</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="字段分隔符和迭代器"><a href="#字段分隔符和迭代器" class="headerlink" title="字段分隔符和迭代器"></a>字段分隔符和迭代器</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#内部字段分隔符(Internal Field Separator, IFS)是shell中的一个重要概念</span></div><div class="line"><span class="comment">#IFS的默认值为空白字符(换行符、制表符、空格)</span></div><div class="line">awk -F: <span class="string">'&#123;print $1,$3&#125;'</span> /etc/passwd		<span class="comment">#IFS=":"</span></div><div class="line"></div><div class="line"><span class="comment">#对一些列值进行迭代，循环非常有用</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;</div><div class="line"><span class="keyword">do</span></div><div class="line">cmd</div><div class="line"><span class="keyword">done</span></div><div class="line"></div><div class="line"><span class="keyword">while</span> condition</div><div class="line"><span class="keyword">do</span></div><div class="line">cmd</div><div class="line"><span class="keyword">done</span></div><div class="line"></div><div class="line">until condition</div><div class="line"><span class="keyword">do</span></div><div class="line">cmd</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="比较与测试"><a href="#比较与测试" class="headerlink" title="比较与测试"></a>比较与测试</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#程序中的流程控制是由比较和测试语句来处理的</span></div><div class="line"><span class="keyword">if</span> condition1 || condition2</div><div class="line"><span class="keyword">then</span></div><div class="line">	cmd1</div><div class="line"><span class="keyword">elif</span> condition3 &amp;&amp; condition4</div><div class="line"><span class="keyword">then</span></div><div class="line">	cmd2</div><div class="line"><span class="keyword">else</span></div><div class="line">	cmd3</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="comment">#算术比较</span></div><div class="line"><span class="keyword">if</span> [ <span class="variable">$num</span> -ge 10 -a <span class="variable">$num</span> -lt 20 ]</div><div class="line"></div><div class="line">-eq</div><div class="line">-gt</div><div class="line">-ge</div><div class="line">-lt</div><div class="line">-le</div><div class="line">-a</div><div class="line">-o</div><div class="line"></div><div class="line"><span class="comment">#文件系统相关</span></div><div class="line"><span class="keyword">if</span> [ -f <span class="variable">$file1</span> -o -x <span class="variable">$file2</span>]</div><div class="line"></div><div class="line">-x</div><div class="line">-w</div><div class="line">-r</div><div class="line">-f</div><div class="line">-d</div><div class="line">-e</div><div class="line">-b		<span class="comment">#block</span></div><div class="line">-l</div><div class="line"></div><div class="line"><span class="comment">#字符串比较</span></div><div class="line">[[ <span class="variable">$str1</span> = <span class="variable">$str2</span>]]</div><div class="line"></div><div class="line">=		<span class="comment">#=号旁有空格--是比较关系；=号旁没空格，是赋值语句</span></div><div class="line">!=</div><div class="line">&gt;</div><div class="line">&lt;</div><div class="line">-z		<span class="comment">#空字符</span></div><div class="line">-n		<span class="comment">#非空字符</span></div><div class="line"></div><div class="line"><span class="comment">#使用test命令来执行条件检测</span></div><div class="line"><span class="keyword">if</span> [ <span class="variable">$num</span> -eq 0 ]  -- <span class="keyword">if</span> <span class="built_in">test</span> <span class="variable">$num</span> -eq 0</div></pre></td></tr></table></figure>
<p><br><br><br></p>
<h1 id="命令之乐"><a href="#命令之乐" class="headerlink" title="命令之乐"></a>命令之乐</h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><p>各种命令可谓Unix-Like系统中优美的部分，它能帮我们搞定各种繁杂的任务。<br>一旦你尝试过Linux提供的这些利器，你一定会感到惊讶：以前没有这些命令的时候，自己是什么熬过来的。<br>最钟爱的莫过于 <code>grep</code>, <code>awk</code>, <code>sed</code>, <code>find</code> 命令了！</p>
<p>本章将会为你介绍一些最有趣同时也是最实用的命令。</p>
<p><br></p>
<h2 id="用cat进行拼接"><a href="#用cat进行拼接" class="headerlink" title="用cat进行拼接"></a>用cat进行拼接</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#cat命令通常用于读取、显示或拼接文件内容，不过它所具备的能力远不止此</span></div><div class="line"><span class="comment">#cat(concatenate, 拼接)</span></div><div class="line">cat file1 file2 ···</div><div class="line"><span class="built_in">echo</span> <span class="string">"Ahaha"</span> | cat - file1 file2		<span class="comment">#-指stdin文本文件名</span></div><div class="line"></div><div class="line">cat -s file3  -- cat file3 | tr -s <span class="string">'\n'</span>		<span class="comment">#压缩空白行</span></div><div class="line">cat -T test.py		<span class="comment">#将制表符显示为 ^I, 避免制表符和连续空格误用, 产生错误缩进</span></div><div class="line">cat -n file4		<span class="comment">#显示行号</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="录制与回放终端会话"><a href="#录制与回放终端会话" class="headerlink" title="录制与回放终端会话"></a>录制与回放终端会话</h2><p>当你需要准备一个命令行教程时，如果将我们输入命令后的一切按照先后次序记录下来，再进行回放，是不是很nice！<br>通过 <code>script</code>, <code>scriptreplay</code> 命令, 把终端会话记录到文件，并回放。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#-t,将时间数据输出到标准错误； -a,追加输出</span></div><div class="line">script -t 2&gt; timing.log -a output.session		<span class="comment">#两个文件随意取名, 如不将错误重定向会显示在屏幕上导致很乱</span></div><div class="line">输入命令</div><div class="line">cmd2</div><div class="line">···</div><div class="line"><span class="built_in">exit</span>		<span class="comment">#退出录制</span></div><div class="line"></div><div class="line">scriptreplay -t timing.log output.session		<span class="comment">#播放</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="文件查找与文件列表"><a href="#文件查找与文件列表" class="headerlink" title="文件查找与文件列表"></a>文件查找与文件列表</h2><p><code>find</code> 是Unix/Linux命令行工具箱中最棒的工具之一。<br><code>find</code> 命令沿着文件层次结构向下遍历，匹配符合条件的文件，并执行相应的操作。</p>
<p>find - search for files in a directory hierarchy<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#基于文件名及正则表达式搜索</span></div><div class="line">find /home/zhang		<span class="comment">#列出/home/zhang目录及其子目录线所有文件和文件夹</span></div><div class="line">find /home/zhang -name <span class="string">"*.txt"</span></div><div class="line">find . -name <span class="string">"*.sh"</span> -o -iname <span class="string">"zhang*"</span>		<span class="comment">#匹配多个</span></div><div class="line">find /home/zhang -path <span class="string">"201710*"</span>		<span class="comment">#-path将文件路径作为一个整体进行匹配</span></div><div class="line">find . -regex	<span class="string">".*\(\.txt|\.[0-9]+\)$"</span>		<span class="comment">#匹配以.txt或数字结尾的文件</span></div><div class="line"></div><div class="line"><span class="comment">#使用-maxdepth, -mindepth参数，来限制find的遍历深度</span></div><div class="line"><span class="comment">#-type, 根据文件类型搜索。 f(普通文件)，d(目录)，b(块设备)，l(符号链接)，s(套接字)等</span></div><div class="line">find /home -maxdepth 1 -<span class="built_in">type</span> f(d)		<span class="comment">#参数顺序也会影响find的查找效率</span></div><div class="line"></div><div class="line"><span class="comment">#根据文件类型搜索</span></div><div class="line">find /dev -<span class="built_in">type</span> b		<span class="comment">#查看/dev及其子目录下设备文件</span></div><div class="line">find / -maxdepth 1 -<span class="built_in">type</span> l		<span class="comment">#查找/下链接文件</span></div><div class="line"></div><div class="line"><span class="comment">#根据文件时间进行搜索</span></div><div class="line"><span class="comment">#Unix/Linux文件系统中的每一个文件都有三种时间戳(timestamp),-表示小于，+表示大于</span></div><div class="line"><span class="comment">#Unix中并没有所谓的 "创建时间" 的概念</span></div><div class="line"><span class="comment">#访问时间(-atime,以天为单位； -amin,以分钟为单位):用户最近一次访问文件时间；</span></div><div class="line"><span class="comment">#修改时间(-mtime,以天为单位； -mmin,以分钟为单位):文件最后一次修改时间；</span></div><div class="line"><span class="comment">#变化时间(-ctime,以天为单位； -cmin,以分钟为单位):文件元数据(如权限，所有权)最后一次变化时间；</span></div><div class="line">find /home/zhang -<span class="built_in">type</span> f -mtime 7		<span class="comment">#7天前被修改的普通文件</span></div><div class="line">find /home/zhang -<span class="built_in">type</span> f -amin -10		<span class="comment">#搜索10分钟内被修改的普通文件</span></div><div class="line">find . -<span class="built_in">type</span> f -newer file1.txt		<span class="comment">#找出比file1.txt新的文件</span></div><div class="line"></div><div class="line"><span class="comment">#基于文件大小的搜索</span></div><div class="line"><span class="comment">#b(块，512字节), c(字节), w(字，2字节), k(千字节), M(兆字节), G(吉字节)</span></div><div class="line">find . -<span class="built_in">type</span> -f -size +100k</div><div class="line"></div><div class="line"><span class="comment">#删除匹配的文件</span></div><div class="line">find . -<span class="built_in">type</span> f -name <span class="string">"*.swp"</span> -delete</div><div class="line"></div><div class="line"><span class="comment">#基于文件权限和所有权的匹配</span></div><div class="line">find . -<span class="built_in">type</span> f -perm 644</div><div class="line">find /var/apache -<span class="built_in">type</span> f -name <span class="string">"*.php"</span> -perm 644		<span class="comment">#搜索基于权限的文件</span></div><div class="line">find /var -maxdepth 2 -<span class="built_in">type</span> f -user zhang		<span class="comment">#搜索基于用户的文件</span></div><div class="line"></div><div class="line"><span class="comment">#执行命令或动作</span></div><div class="line"><span class="comment">#find命令可以借助-exec与其他命令进行结合</span></div><div class="line"><span class="comment">#&#123;&#125;是一个特殊字符串，将替换为相应文件名</span></div><div class="line">find . -<span class="built_in">type</span> f -perm 764 -user zhang -<span class="built_in">exec</span> chmod 644 &#123;&#125; \;		<span class="comment">#将所属用户zhang，权限764的文件权限修改为644</span></div><div class="line">find . -<span class="built_in">type</span> f -mmin +30 -name <span class="string">"*.txt"</span> -<span class="built_in">exec</span> cp &#123;&#125; &#123;&#125;.old \;		<span class="comment">#复制最近30内修改的名字为.txt的文件</span></div><div class="line"></div><div class="line"><span class="comment">#-exec结合多个命令</span></div><div class="line"><span class="comment">#我们无法在-exec参数中直接使用多个命令，不过我们可以把多个命令写到一个shellscript中，然后执行</span></div><div class="line">-<span class="built_in">exec</span> ./test.sh &#123;&#125; \;</div><div class="line">find . -<span class="built_in">type</span> f -name <span class="string">"*.sh"</span> -mmin -10 -<span class="built_in">exec</span> sh &#123;&#125; \;</div><div class="line"></div><div class="line"><span class="comment">#让find跳过特定目录</span></div><div class="line">-prune</div></pre></td></tr></table></figure></p>
<p><br><br><strong>利用<code>stat</code>命令查看atime, mtime, ctime :</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#stat - display file or file system status</div><div class="line">stat 1.txt</div><div class="line"></div><div class="line">#Access:</div><div class="line">#Modify:</div><div class="line">#Change:</div></pre></td></tr></table></figure></p>
<p><br><br><strong>利用<code>touch</code>命令修改atime, mtime, ctime：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#touch - change file timestamps</div><div class="line"></div><div class="line">#-a     change only the access time</div><div class="line">#-m     change only the modification time</div><div class="line">#-d     instead of current time</div><div class="line">#-t     instead of current time</div></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="玩转xargs"><a href="#玩转xargs" class="headerlink" title="玩转xargs"></a>玩转xargs</h2><p>xargs - build and execute command lines from standard input<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#xargs能够处理stdin并将其转换为特定命令的命令行参数</span></div><div class="line"><span class="comment">#也可以将单行或多行输入文本转换成其他格式(如多行变单行)</span></div><div class="line">cmd | xargs</div><div class="line"></div><div class="line"><span class="comment">#将多行输入转换为单行输出</span></div><div class="line"><span class="built_in">echo</span> -e <span class="string">"1\n2\n3"</span> | xargs	<span class="comment">#将换行符替换为空格</span></div><div class="line"><span class="comment">#将单行输入转换成多行输出</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"1 2 3"</span> | xargs -n 1	<span class="comment">#每行一个参数</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"hahaZhahaZhahaZhaha"</span> | xargs -n 2 -d Z	<span class="comment">#-d指定分隔符</span></div><div class="line"></div><div class="line"><span class="comment">#读取stdin，将格式化参数传递给命令</span></div><div class="line">cat test.txt | xargs -n 1 ./zhang.sh	<span class="comment">#zhang.sh arg1; zhang.sh arg2... 每次提供一个参数</span></div><div class="line">cat test.txt | xargs -n X ./zhang.sh	<span class="comment">#X为参数个数，一次提供全部参数</span></div><div class="line"></div><div class="line"><span class="comment">#指定替换字符串</span></div><div class="line">cat test.txt | xargs -I &#123;&#125; ./zhang.sh &#123;&#125;</div><div class="line"></div><div class="line"><span class="comment">#结合find使用xargs</span></div><div class="line">find . -<span class="built_in">type</span> f -name <span class="string">"*.txt"</span> -print0 | xargs -0 ls	<span class="comment">#-print0无换行输出, -0将\0作为输入界定符</span></div><div class="line"></div><div class="line"><span class="comment">#统计某文件行数</span></div><div class="line">find /path -<span class="built_in">type</span> f -name <span class="string">"*.c"</span> -print0 | xargs -0 wc -l</div><div class="line"></div><div class="line"><span class="comment">#结合stdin，运用while和子shell</span></div><div class="line">cat file.txt | <span class="keyword">while</span> <span class="built_in">read</span> arg; <span class="keyword">do</span> cat <span class="variable">$arg</span>; <span class="keyword">done</span> == cat file.txt | xargs - &#123;&#125; cat &#123;&#125;</div><div class="line">cmd0 | (cmd1; cmd2; cmd3) | cmd4	<span class="comment">#子shell</span></div></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="用tr进行转换"><a href="#用tr进行转换" class="headerlink" title="用tr进行转换"></a>用tr进行转换</h2><p>tr - translate or delete characters<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#tr命令经常用来编写优美的单行命令</span></div><div class="line"><span class="comment">#tr可对来自stdin的字符 进行替换、删除以及压缩</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"AH WONDERFUL"</span> | tr <span class="string">'A-Z'</span> <span class="string">'a-z'</span>	<span class="comment">#转换大小写</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"AH WONDERFUL"</span> | tr <span class="string">'A-Z'</span> <span class="string">'a-b'</span> --&gt; ab bbbbbbbbb</div><div class="line"><span class="comment">#tr [option] set1 set2</span></div><div class="line"><span class="comment">#如果两个字符集长度不相等，那么set2会不断重复其最后一个字符，直到长度与set1相同</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> 12345 | tr <span class="string">'0-9'</span> <span class="string">'9876543210'</span>	<span class="comment">#数字加密</span></div><div class="line"><span class="built_in">echo</span> 87654 | tr <span class="string">'9876543210'</span> <span class="string">'0-9'</span>	<span class="comment">#数字解密</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">'He is a cool boy, and she is a beautiful girl'</span> | tr <span class="string">'A-Za-z'</span> <span class="string">'NOPQRSRUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm'</span>	<span class="comment">#加密</span></div><div class="line"><span class="built_in">echo</span> <span class="string">'Ur vf n pbby obl, naq fur'</span> | tr <span class="string">'NOPQRSRUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm'</span> <span class="string">'A-Za-z'</span>	<span class="comment">#解密</span></div><div class="line"></div><div class="line">cat 1.txt | tr <span class="string">'\t'</span> <span class="string">' '</span>	<span class="comment">#将制表符转换为空格</span></div><div class="line"></div><div class="line"><span class="comment">#删除字符</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Hello 530 World"</span> | tr -d <span class="string">'0-9'</span>	<span class="comment">#-d删除，删除数字</span></div><div class="line">Hello  World</div><div class="line"><span class="built_in">echo</span> <span class="string">"Hello 520 World"</span> | tr -d -c <span class="string">'0-9'</span>	<span class="comment">#-c补集</span></div><div class="line"> 520</div><div class="line"></div><div class="line"><span class="comment">#压缩字符，将连续的重复字符压缩为单个字符</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"GNU's    not   Unix"</span> | tr -s <span class="string">' '</span>	<span class="comment">#-s压缩，压缩空格</span></div><div class="line">GNU<span class="string">'s not Unix</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">echo -e "1\n2\n3\n4\n5" &gt; sum.txt</span></div><div class="line"><span class="string">cat sum.txt | echo $[ $(tr '</span>\n<span class="string">' '</span>+<span class="string">') 0 ] -- echo $[1+2+3+4+5+0]</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">#tr字符类</span></div><div class="line"><span class="string">\a	终端鸣响</span></div><div class="line"><span class="string">\b	退格</span></div><div class="line"><span class="string">\f	换页</span></div><div class="line"><span class="string">\n	换行</span></div><div class="line"><span class="string">\r	回车</span></div><div class="line"><span class="string">\t	水平制表符</span></div><div class="line"><span class="string">\v	垂直制表符</span></div><div class="line"><span class="string">string1-stringN	#从字符1到字符N升序过程中的所有字符</span></div><div class="line"><span class="string">[字符*次数]</span></div><div class="line"><span class="string">[:alnum:]	#所有字母和数字</span></div><div class="line"><span class="string">[:alpha:]	#所有字母</span></div><div class="line"><span class="string">[:digit:]	#所有数字</span></div><div class="line"><span class="string">[:lower:]	#所有小写字母</span></div><div class="line"><span class="string">[:upper:]	#所有大写字母</span></div><div class="line"><span class="string">[:graph:]	#所有可打印字符，不含空格</span></div><div class="line"><span class="string">[:print:]	#所有可打印字符，包含空格</span></div><div class="line"><span class="string">[:blank:]	#所有水平排列的空白字符</span></div><div class="line"><span class="string">[:cntrl:]	#所有控制字符</span></div><div class="line"><span class="string">[:punct:]	#所有标点字符</span></div><div class="line"><span class="string">[:space:]	#所有空白字符</span></div><div class="line"><span class="string">[:xdigit:]	#所有十六进制数</span></div><div class="line"><span class="string">[=字符]	#指定字符</span></div></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="校验和-与-核实文件完整性"><a href="#校验和-与-核实文件完整性" class="headerlink" title="校验和 与 核实文件完整性"></a>校验和 与 核实文件完整性</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#校验和(checksum)程序从文件中生成校验和密钥，然后利用校验和密钥核实文件的完整性</span></div><div class="line"><span class="comment">#校验和对于编写备份脚本或系统维护脚本非常重要，因为它们都会涉及通过网络传输文件</span></div><div class="line"><span class="comment">#通过使用校验和核实，我们就可以识别那些在网络传输过程中出现损坏的文件，并重传，从而确保数据完整性</span></div><div class="line"><span class="comment">#校验和对于核实数据完整性非常有用</span></div><div class="line"><span class="comment">#广泛使用的校验和技术有：md5sum, sha1sum</span></div><div class="line"></div><div class="line"><span class="comment">#对单个文件进行校验</span></div><div class="line">md5sum sum.txt &gt; sum.md5</div><div class="line"><span class="comment">#302c28003d487124d97c242de94da856  sum.txt</span></div><div class="line">md5sum -c sum.md5	<span class="comment">#-c检查</span></div><div class="line"><span class="comment">#sum.txt: 确定</span></div><div class="line"></div><div class="line"><span class="comment">#对目录进行校验</span></div><div class="line"><span class="comment">#对目录计算校验和意味着我们需要对目录中的所有文件以递归的方式进行计算</span></div><div class="line">yum install -y md5deep</div><div class="line">md5deep -r ./dir &gt; dir.md5	<span class="comment">#recursive递归</span></div><div class="line">md5sum -c dir.md5</div><div class="line"></div><div class="line"><span class="comment">#可以将测试dir下某个文件更改一下，校验的时候会报错</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="排序、单一、重复"><a href="#排序、单一、重复" class="headerlink" title="排序、单一、重复"></a>排序、单一、重复</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#sort - 对文本文件进行行排序</span></div><div class="line"><span class="comment">#uniq - 删除排序文件中的重复行</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> -e <span class="string">"333\n1"</span> &gt; 1.txt; <span class="built_in">echo</span> -e <span class="string">"22\n22"</span> &gt; 2.txt</div><div class="line">sort 1.txt 2.txt -o ./sorted.txt</div><div class="line"><span class="comment">#1</span></div><div class="line"><span class="comment">#22</span></div><div class="line"><span class="comment">#22</span></div><div class="line"><span class="comment">#333</span></div><div class="line">cat sortec.txt | uniq</div><div class="line"><span class="comment">#1</span></div><div class="line"><span class="comment">#22</span></div><div class="line"><span class="comment">#333</span></div><div class="line"></div><div class="line">sort -n	<span class="comment">#按数字进行排序</span></div><div class="line">sort -r	<span class="comment">#逆向排序</span></div><div class="line">sort -M	<span class="comment">#按月份排序</span></div><div class="line">sort -C	<span class="comment">#检查是否排序</span></div><div class="line">sort -b	<span class="comment">#忽略空白</span></div><div class="line"></div><div class="line"><span class="comment">#依据键或列进行排序</span></div><div class="line">sort -k 2 data.txt	<span class="comment">#依据第二列来排序</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#uniq要么使用管道，要么使用排过序的文件作文输入</span></div><div class="line">uniq -u sorted.txt	<span class="comment">#只显示唯一的行(即没有重复出现的行)</span></div><div class="line">uniq -d sorted.txt	<span class="comment">#只显示重复的行</span></div><div class="line">uniq -s 2 -w 2 sorted.txt	<span class="comment">#-s忽略前2个字符，-w指定用于比较的最大字符数</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="临时文件命名、随机数"><a href="#临时文件命名、随机数" class="headerlink" title="临时文件命名、随机数"></a>临时文件命名、随机数</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在编写shell脚本时，我们经常需要存储临时文件。最适合存储临时数据的位置是 /tmp</span></div><div class="line"><span class="comment">#/tmp目录中的内容会在系统重启后被清空</span></div><div class="line"></div><div class="line">filename=<span class="variable">$RANDOM</span>	<span class="comment">#RANDOM返回一个随机数</span></div><div class="line">filename2=$$	<span class="comment">#当前shell的PID</span></div><div class="line">filename3=$((date +%F))	<span class="comment">#通过日期命令</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="分割文件和数据"><a href="#分割文件和数据" class="headerlink" title="分割文件和数据"></a>分割文件和数据</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#某些情况下，需要把文件分割成多个更小的片段</span></div><div class="line">dd <span class="keyword">if</span>=/dev/zero bs=100k count=1 of=./data.file	<span class="comment">#生成一个大小100k内容全是0的文件</span></div><div class="line">split -b 20k data.file	<span class="comment">#-d指定分割大小</span></div><div class="line"><span class="comment">#data.file xaa xab xac xad xae,这五个文件都为20k</span></div><div class="line"><span class="comment">#我测试了一下，几个文件加起来数据没变，几个文件总行数没变</span></div><div class="line"><span class="comment">#单位有 k, m, G, c(byte), w(word)</span></div><div class="line"><span class="comment">#-d以数字为后缀， -a指定后缀长度</span></div><div class="line"></div><div class="line">split data.file -b 20k -d -a 2 spt	<span class="comment">#增加前缀名'spt'</span></div><div class="line"><span class="comment">#data.file  spt00  spt01  spt02  spt03  spt04</span></div><div class="line"></div><div class="line">split -l 10 data.file	<span class="comment">#-l按行数来分割文件</span></div><div class="line"><span class="comment">#split只能根据大小或行数分割文件</span></div><div class="line"></div><div class="line"><span class="comment">#csplit可以根据文件本身特点进行分割</span></div><div class="line">-f	<span class="comment">#指定分割后文件前缀</span></div><div class="line">-n	<span class="comment">#指定分割后文件后缀数字个数</span></div><div class="line">-b	<span class="comment">#指定后缀格式</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="根据扩展名切分文件名"><a href="#根据扩展名切分文件名" class="headerlink" title="根据扩展名切分文件名"></a>根据扩展名切分文件名</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#借助%操作符将名称从 “名称.扩展名” 格式中提取出来</span></div><div class="line"></div><div class="line">file=<span class="string">"zhang.txt"</span></div><div class="line">name1=<span class="variable">$&#123;file%.*&#125;</span>	<span class="comment">#删除位于%右侧的通配符(.*)所匹配的字符串，通配符从右向左进行匹配</span></div><div class="line"><span class="comment">#zhang</span></div><div class="line"><span class="comment">#*号通配符，.号</span></div><div class="line"><span class="comment">#%属于非贪婪匹配(non-greedy),它会匹配通配符最短结果</span></div><div class="line"><span class="comment">#%%属于贪婪匹配(greedy)，它会匹配符号条件的最长字符串</span></div><div class="line"></div><div class="line">name2=<span class="variable">$&#123;file#*.&#125;</span>	<span class="comment">#删除位于#右侧的通配符(*.)所匹配的字符串，通配符从左向右进行匹配</span></div><div class="line"><span class="comment">#txt</span></div><div class="line"><span class="comment"># #属于非贪婪匹配</span></div><div class="line"><span class="comment"># ##属于贪婪匹配</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#栗子</span></div><div class="line">URL=“www.google.com”</div><div class="line"><span class="built_in">echo</span> <span class="variable">$&#123;URL%.*&#125;</span>	<span class="comment">#非贪婪匹配，移除最右边.及其后面内容</span></div><div class="line">www.google</div><div class="line"><span class="built_in">echo</span> <span class="variable">$&#123;URL%%.*&#125;</span>	<span class="comment">#贪婪匹配</span></div><div class="line">www</div><div class="line"><span class="built_in">echo</span> <span class="variable">$&#123;URL#*.&#125;</span>	<span class="comment">#非贪婪匹配，移除最左边.及其前面内容</span></div><div class="line">google.com</div><div class="line"><span class="built_in">echo</span> <span class="variable">$&#123;URL##*.&#125;</span>	<span class="comment">#贪婪匹配</span></div><div class="line">com</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="批量重命名和移动"><a href="#批量重命名和移动" class="headerlink" title="批量重命名和移动"></a>批量重命名和移动</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#综合运用find、rename、mv命令</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="拼写检查与词典操作"><a href="#拼写检查与词典操作" class="headerlink" title="拼写检查与词典操作"></a>拼写检查与词典操作</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Linux大多数发行版都含有一份词典文件，另外还有一个被称为aspell的拼写检查命令</span></div><div class="line"><span class="comment">#words --&gt; /usr/share/dict/linux.words</span></div><div class="line"></div><div class="line">grep <span class="string">"^good"</span> /usr/share/dict/linux.words</div><div class="line"></div><div class="line">aspell</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="交互输入自动化"><a href="#交互输入自动化" class="headerlink" title="交互输入自动化"></a>交互输入自动化</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#写一个读取交互式输入脚本</span></div><div class="line">vi jiaohu.sh</div><div class="line"></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="built_in">read</span> -p <span class="string">"Input a number:"</span> num</div><div class="line"><span class="built_in">read</span> -p <span class="string">"Input name:"</span> name</div><div class="line"><span class="built_in">echo</span> <span class="string">"You have enterd number:<span class="variable">$num</span>, name:<span class="variable">$name</span>"</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> -e <span class="string">"1\nzhang"</span> | ./jiaohu.sh</div><div class="line">You have entered number:1, name:hello</div><div class="line"></div><div class="line"><span class="comment">#or</span></div><div class="line"><span class="built_in">echo</span> -e <span class="string">"1\nzhang"</span> &gt; input.txt</div><div class="line">./jiaohu.sh &lt; input.txt</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#交互式输入自动化</span></div><div class="line"><span class="comment">#用expect实现自动化</span></div><div class="line">yum install -y expect</div><div class="line">vim auto_expect.sh</div><div class="line"></div><div class="line"><span class="comment">#!/bin/expect</span></div><div class="line">spawn ./jiaohu.sh	<span class="comment">#spawn指定需要自动化哪一个命令</span></div><div class="line">expect <span class="string">"Input a number:"</span>	<span class="comment">#expect提供需要等待的消息</span></div><div class="line">send <span class="string">"1\n"</span>		<span class="comment">#send是要发送的消息</span></div><div class="line">expect <span class="string">"Input name:"</span></div><div class="line">send <span class="string">"zhang"</span></div><div class="line">expect eof	<span class="comment">#expect eof指明命令交互结束</span></div><div class="line"></div><div class="line">./auto_expect.sh</div></pre></td></tr></table></figure>
<p><br><br><br></p>
<h1 id="以文件之名"><a href="#以文件之名" class="headerlink" title="以文件之名"></a>以文件之名</h1><h2 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h2><p>Unix将操作系统中的一切都视为文件。</p>
<p><br></p>
<h2 id="生成任意大小的文件"><a href="#生成任意大小的文件" class="headerlink" title="生成任意大小的文件"></a>生成任意大小的文件</h2><p>由于各种原因，可能需要生成一个包含随机数据的文件。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#dd命令会克隆给定的输入内容，然后将一模一样的副本写到输出</span></div><div class="line"><span class="comment">#如果不指定if，dd会从stdin中读取输入；如果不指定of，dd会输出到stdout</span></div><div class="line"><span class="comment">#/dev/zero是一个字符设备，它会不断返回0值字节(\0)</span></div><div class="line">dd <span class="keyword">if</span>=/dev/zero of=junk.data bs=1M count=1</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="文本文件的交集与差集"><a href="#文本文件的交集与差集" class="headerlink" title="文本文件的交集与差集"></a>文本文件的交集与差集</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#comm命令用于两个文件之间的比较</span></div><div class="line"><span class="comment">#交集(intersection),差集(set difference), 求差</span></div><div class="line"><span class="comment">#comm必须使用排过序的文件作为输入</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> -e <span class="string">"1\n2\n3"</span> &gt; A.txt &amp;&amp; <span class="built_in">echo</span> -e <span class="string">"3\n2\n3"</span> &gt; B.txt</div><div class="line">sort -n A.txt -o A.txt &amp;&amp; sort -n B.txt -o B.txt</div><div class="line">comm A.txt B.txt</div><div class="line"><span class="comment">#输出第一列为A独有，第二列为B独有，第三列为交集</span></div><div class="line"></div><div class="line">comm A.txt B.txt -1 -2</div><div class="line"><span class="comment">#-1从输出中删除第一列，-2删除第二列，-3删除第三列</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="查找并删除重复文件"><a href="#查找并删除重复文件" class="headerlink" title="查找并删除重复文件"></a>查找并删除重复文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#重复文件指的是那些虽然名字不同但内容却一模一样的文件</span></div><div class="line"></div><div class="line">ls -lS	<span class="comment">#以文件大小排序，识别大小相等的文件</span></div><div class="line">md5sum	<span class="comment">#接下来计算这些文件的校验和</span></div></pre></td></tr></table></figure>
<h2 id="创建长路径目录"><a href="#创建长路径目录" class="headerlink" title="创建长路径目录"></a>创建长路径目录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir -p /home/zhang/1/22/333 2&gt;/dev/null</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="文件权限、所有权和粘滞位"><a href="#文件权限、所有权和粘滞位" class="headerlink" title="文件权限、所有权和粘滞位"></a>文件权限、所有权和粘滞位</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#用户(user)，用户组(group)，其他用户(other)</span></div><div class="line">ll ./*</div><div class="line"><span class="comment">#d目录，c字符设备，b块设备，l符号链接，s套接字，p管道，-普通文件</span></div><div class="line"></div><div class="line"><span class="comment">#用户还有一个称为setuid(S)的特殊权限，它出现在用户的x位置</span></div><div class="line"><span class="comment">#setuid权限允许用户以其拥有者的权限来执行可执行文件，即便这个文件是由其他用户运行的</span></div><div class="line">-rwSrw-r--</div><div class="line"></div><div class="line"><span class="comment">#组也拥有一个setgid(S)权限，它出现在组的x位置</span></div><div class="line"><span class="comment">#它允许以同该目录拥有者所在组相同的有效组权限来运行可执行文件</span></div><div class="line">-rwxrwSr--</div><div class="line"></div><div class="line"><span class="comment">#目录有一个特殊权限，叫做粘滞位(sticky bit)(T或t)，出现在其他用户的x位置</span></div><div class="line"><span class="comment">#当一个目录设置了粘滞位，只有创建该目录的用户才能删除目录中的文件,即便group和other有w权限</span></div><div class="line">-rwxr--rwT</div><div class="line"></div><div class="line">chmod u=rwx g=rw o=r file1</div><div class="line">chmod u+x g-w file2</div><div class="line">chmod 744 file3</div><div class="line"></div><div class="line">chmod a+x . -R	<span class="comment">#以递归方式设置权限</span></div><div class="line">chown user.group . -R	<span class="comment">#以递归方式设置所有权</span></div><div class="line"></div><div class="line">chmod a+t dir1	<span class="comment">#设置粘滞位</span></div><div class="line"></div><div class="line">chmod +s fiel4</div><div class="line">chown root.root file4</div><div class="line">chmod +s file4</div><div class="line">./file4	<span class="comment">#每次file4都是以root运行</span></div><div class="line"></div><div class="line"><span class="comment">#setuid的使用不是无限制的，它只能应用在Linux ELF格式二进制，而不能用于脚本文件。</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="创建不可修改文件"><a href="#创建不可修改文件" class="headerlink" title="创建不可修改文件"></a>创建不可修改文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#不可修改(immutable),是保护文件不被修改的安全手段之一。</span></div><div class="line"><span class="comment">#一旦文件被设置为不可修改，任何用户(包括root)都不能修改，除非将其不可修改属性移除</span></div><div class="line"></div><div class="line">chattr	<span class="comment">#修改文件在Linux第二扩展文件系统(E2fs)上的特有属性</span></div><div class="line">chattr +i file1	<span class="comment">#这样就无法删除file1</span></div><div class="line">chattr -i file1</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="批量生成空白文件"><a href="#批量生成空白文件" class="headerlink" title="批量生成空白文件"></a>批量生成空白文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#touch命令可用来生成空白文件，如果文件存在，则可以用它修改文件的时间戳</span></div><div class="line"><span class="keyword">for</span> name <span class="keyword">in</span> &#123;1..100&#125;.txt;<span class="keyword">do</span></div><div class="line">touch <span class="variable">$name</span></div><div class="line"><span class="keyword">done</span></div><div class="line"></div><div class="line">touch -a/-m	<span class="comment">#更改文件访问/修改时间</span></div><div class="line">touch -d <span class="string">"Thu Oct 31 14:20:13 CST 2017"</span> file1	<span class="comment">#指定特定时间戳</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="查找符号链接及其指向目标"><a href="#查找符号链接及其指向目标" class="headerlink" title="查找符号链接及其指向目标"></a>查找符号链接及其指向目标</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#符号链接(软链接)只不过是指向其他文件的指针</span></div><div class="line">ln -s /usr/bin /bin</div><div class="line">ls -l / | grep <span class="string">"^l"</span></div><div class="line">find / -maxdepth 1 -<span class="built_in">type</span> l</div><div class="line"></div><div class="line">readlink /bin	<span class="comment">#找出链接目标</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="列举文件类型统计信息"><a href="#列举文件类型统计信息" class="headerlink" title="列举文件类型统计信息"></a>列举文件类型统计信息</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在Unix/Linux系统中，文件类型并不是由文件扩展名决定的</span></div><div class="line">file /etc/passwd</div><div class="line">file -b /etc/passwd</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="环回文件与挂载"><a href="#环回文件与挂载" class="headerlink" title="环回文件与挂载"></a>环回文件与挂载</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#环回文件系统是指那些在文件中而非物理设备中创建的文件系统</span></div><div class="line">dd <span class="keyword">if</span>=/dev/zero of=loopback.file bs=1G count=1</div><div class="line">mkfs.ext4 loopback.file</div><div class="line">mount -o loop loopback.file /mnt/loopback	<span class="comment">#-o loop来挂载环回文件</span></div><div class="line">df -h</div><div class="line">umount /mnt/loopback</div><div class="line"></div><div class="line"><span class="comment">#将ISO文件作为环回文件挂载</span></div><div class="line">mount -o loop linux.iso /mnt/iso</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="生成ISO文件以及混合ISO"><a href="#生成ISO文件以及混合ISO" class="headerlink" title="生成ISO文件以及混合ISO"></a>生成ISO文件以及混合ISO</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#可引导光盘自身具备引导能力，也可以运行操作系统或其他软件。不可引导光盘则做不到这些。</span></div><div class="line">cat /dev/cdrom  &gt; /dev/sdc	<span class="comment">#sdc指U盘</span></div><div class="line">dd <span class="keyword">if</span>=/dev/cdrom of=/dev/sdc	<span class="comment">#将ISO写入usb存储设备</span></div><div class="line">mkisofs -V <span class="string">"Label"</span> -o /dev/sdc /dev/cdrom</div><div class="line"></div><div class="line">cdrecord -v dev=/dev/cdrom image.iso</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="查找文件差异并进行修补"><a href="#查找文件差异并进行修补" class="headerlink" title="查找文件差异并进行修补"></a>查找文件差异并进行修补</h2><p>diff - compare files line by line<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#补丁文件(patch file)</span></div><div class="line"><span class="comment">#diff命令可以生成差异文件</span></div><div class="line">diff -u file1 file2	<span class="comment">#一体化形式输出</span></div><div class="line">diff -u file1 file2 &gt; diff.patch</div><div class="line">patch -p1 file1 &lt; diff.patch	<span class="comment">#得到file2</span></div><div class="line">patch -p1 file2 &lt; diff.patch	<span class="comment">#得到file1</span></div><div class="line">patch -R file1 &lt; diff.patch; patch -R file2 &lt; diff.patch	<span class="comment">#还原</span></div><div class="line"></div><div class="line"><span class="comment">#diff也能够以递归的形式作用于目录，它对目录中所有内容生成差异输出</span></div><div class="line">diff -Naur dir1 dir2</div><div class="line"><span class="comment">#-N将所有确实文件视为空文件， -a将所有文件视为文本文件</span></div><div class="line"><span class="comment">#-u生成一体化输出， -r遍历目录下所有文件</span></div></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="head与tail"><a href="#head与tail" class="headerlink" title="head与tail"></a>head与tail</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">head file1; tail file1	<span class="comment">#head与tail默认打印10行</span></div><div class="line">head -n 5 file1; tail -n 6 file1	<span class="comment">#指定行数</span></div><div class="line">head -n -5 file1	<span class="comment">#打印除了最后5行外所有行</span></div><div class="line">tail -n +(5+1) file1	<span class="comment">#打印除了开始5行外所有行</span></div><div class="line"></div><div class="line">tail -f /var/<span class="built_in">log</span>/nginx/access.log	<span class="comment">#--follow，动态关注文件</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="只列出目录的其他方法"><a href="#只列出目录的其他方法" class="headerlink" title="只列出目录的其他方法"></a>只列出目录的其他方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ls -d .</div><div class="line">ls -l . | grep &quot;^d&quot;</div><div class="line">ls -F . | grep &quot;/$&quot;</div><div class="line">find . -maxdepth 1 -type d</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="pushd和popd"><a href="#pushd和popd" class="headerlink" title="pushd和popd"></a>pushd和popd</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在命令行中使用pushd和popd快速定位，pushd和popd以栈的方式运作</span></div><div class="line"><span class="comment">#当没有鼠标时，复制粘贴就不怎么实用了</span></div><div class="line"><span class="comment">#pushd和popd可以用于在多个目录之间进行切换而无需复制并粘贴目录路径</span></div><div class="line"></div><div class="line"><span class="built_in">pushd</span> /home/user1; <span class="built_in">pushd</span> /home/user2; <span class="built_in">pushd</span> /home/user3	<span class="comment">#将路径添加到栈</span></div><div class="line"><span class="built_in">pushd</span> +2	<span class="comment">#切换到/home/user3</span></div><div class="line"></div><div class="line"><span class="built_in">popd</span>	<span class="comment">#移除最近添加入栈的目录</span></div><div class="line"></div><div class="line"><span class="built_in">cd</span> /root; <span class="built_in">cd</span> /home/user</div><div class="line"><span class="built_in">cd</span> -	<span class="comment">#回到上次的目录</span></div><div class="line"><span class="built_in">cd</span> ..	<span class="comment">#切换到上一级目录</span></div><div class="line"><span class="built_in">cd</span> ~	<span class="comment">#切换到用户主目录</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="统计文件的行数、单词数、字符数"><a href="#统计文件的行数、单词数、字符数" class="headerlink" title="统计文件的行数、单词数、字符数"></a>统计文件的行数、单词数、字符数</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#wc(word count)，是一个统计工具</span></div><div class="line">wc -l file1	<span class="comment">#统计行数</span></div><div class="line">wc -w file1	<span class="comment">#统计单词数</span></div><div class="line">wc -c file	<span class="comment">#统计字符数</span></div><div class="line">wc -L file	<span class="comment">#打印最长行长度</span></div><div class="line">wc file1	<span class="comment">#行、单词、字符数</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="目录树"><a href="#目录树" class="headerlink" title="目录树"></a>目录树</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#tree命令是以图形化的树状结构打印文件和目录,在Linux发行版中默认未安装</span></div><div class="line">yum install -y tree</div><div class="line">tree /home/zhang</div><div class="line">tree /home/zhang -P <span class="string">"*.sh"</span>	<span class="comment">#只标记出.sh文件</span></div><div class="line">tree /home/zhang -I <span class="string">"*.sh"</span>	<span class="comment">#标记出除.sh文件外所有文件</span></div><div class="line">tree /home/zhang -h	<span class="comment">#显示大小</span></div><div class="line"></div><div class="line">tree /home/zhang -H http://localhost -o tree.html	<span class="comment">#以html形式输出目录树</span></div></pre></td></tr></table></figure>
<p><br><br><br></p>
<h1 id="让文本飞"><a href="#让文本飞" class="headerlink" title="让文本飞"></a>让文本飞</h1><h2 id="简介-3"><a href="#简介-3" class="headerlink" title="简介"></a>简介</h2><p>shell脚本可以将<code>sed</code>, <code>awk</code>, <code>grep</code>, <code>cut</code>等这类优美的工具组合在一起，用于解决文本处理相关问题。</p>
<p><br></p>
<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><p>正则表达式是一种用于文本匹配的形式小巧、具有高度针对性的编程语言。只依靠通配符技术，能够匹配的文本范围相当有限。<br></p>
<p><strong>正则表达式基本组成</strong></p>
<table>
<thead>
<tr>
<th>正则表达式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>^</td>
<td>行起始标记</td>
</tr>
<tr>
<td>$</td>
<td>行尾标记</td>
</tr>
<tr>
<td>.</td>
<td>匹配任意一个字符</td>
</tr>
<tr>
<td>[]</td>
<td>匹配包含在[]中的任意一个字符</td>
</tr>
<tr>
<td>[^]</td>
<td>匹配出[^]之外任意一个字符</td>
</tr>
<tr>
<td>[-]</td>
<td>匹配[]中范围内的任意一个字符</td>
</tr>
<tr>
<td>？</td>
<td>重复0或1次</td>
</tr>
<tr>
<td>+</td>
<td>重复&gt;=1次</td>
</tr>
<tr>
<td>*</td>
<td>重复&gt;=0次</td>
</tr>
<tr>
<td>()</td>
<td>创建一个用于匹配的子串</td>
</tr>
<tr>
<td>{n}</td>
<td>重复n次</td>
</tr>
<tr>
<td>{n, }</td>
<td>重复&gt;=n次</td>
</tr>
<tr>
<td>{n,m}</td>
<td>重复n到m次</td>
</tr>
<tr>
<td>\</td>
<td>转义字符</td>
</tr>
<tr>
<td>竖线l</td>
<td>匹配竖线l两边任意一项</td>
</tr>
</tbody>
</table>
<p><br><br><strong>POSIX字符类</strong></p>
<p>POSIX字符类(POSIX character class),是一个形如[:…:]的特殊元序列，它用于匹配特定的字符范围。<br></p>
<table>
<thead>
<tr>
<th>正则表达式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>[:alnum:]</td>
<td>字母与数字字符</td>
</tr>
<tr>
<td>[:alpha:]</td>
<td>字母字符</td>
</tr>
<tr>
<td>[:blank:]</td>
<td>空格与制表符</td>
</tr>
<tr>
<td>[:digit:]</td>
<td>数字字符</td>
</tr>
<tr>
<td>[:lower:]</td>
<td>小写字母</td>
</tr>
<tr>
<td>[:upper:]</td>
<td>大写字母</td>
</tr>
<tr>
<td>[:punct:]</td>
<td>标点符号</td>
</tr>
<tr>
<td>[:space:]</td>
<td>所有空白字符</td>
</tr>
</tbody>
</table>
<p><br><br><strong>元字符</strong></p>
<p>元字符(meta character)，是一种Perl风格的正则表达式，只有一部分文本处理工具支持它。<br></p>
<table>
<thead>
<tr>
<th>正则表达式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>\b</td>
<td>单词边界</td>
</tr>
<tr>
<td>\B</td>
<td>非单词边界</td>
</tr>
<tr>
<td>\d</td>
<td>单个数字字符</td>
</tr>
<tr>
<td>\D</td>
<td>单个非数字字符</td>
</tr>
<tr>
<td>\w</td>
<td>单个单词字符(数字，字母和_)</td>
</tr>
<tr>
<td>\W</td>
<td>单个非单词字符</td>
</tr>
<tr>
<td>\s</td>
<td>单个空白字符</td>
</tr>
<tr>
<td>\S</td>
<td>单个非空白字符</td>
</tr>
<tr>
<td>\n</td>
<td>换行符</td>
</tr>
<tr>
<td>\r</td>
<td>回车</td>
</tr>
</tbody>
</table>
<p><br><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#匹配一个ipv4地址</span></div><div class="line">[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;</div><div class="line"></div><div class="line"><span class="comment">#匹配一个邮箱地址</span></div><div class="line">[\w]+@[\w]\.com</div></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="用grep在文件中搜索文本"><a href="#用grep在文件中搜索文本" class="headerlink" title="用grep在文件中搜索文本"></a>用grep在文件中搜索文本</h2><p><code>grep</code>命令是Unix中用于文本搜索的工具，它能够接受正则表达式和通配符。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">grep <span class="string">"匹配文本/通配符"</span> file1 file2... --color=auto	<span class="comment">#重点标记匹配</span></div><div class="line">grep -E <span class="string">"正则表达式"</span> file</div><div class="line">egrep <span class="string">"正则"</span> file</div><div class="line"></div><div class="line">grep -v	<span class="comment">#反向匹配</span></div><div class="line">grep -c	<span class="comment">#统计匹配行数</span></div><div class="line">grep -n	<span class="comment">#打印出匹配的行号</span></div><div class="line">grep -o	<span class="comment">#唯一匹配</span></div><div class="line">grep -l	<span class="string">"匹配"</span> file1 file2	<span class="comment">#返回匹配的文件名</span></div><div class="line">grep -R	<span class="comment">#递归匹配</span></div><div class="line">grep -i	<span class="comment">#忽略大小写</span></div><div class="line">grep -e <span class="string">"匹配1"</span> -e <span class="string">"匹配2"</span>	<span class="comment">#匹配多个样式</span></div><div class="line">grep -f match.txt file1	<span class="comment">#从match.txt文件读取匹配</span></div><div class="line">grep <span class="string">"匹配"</span> --include=*.&#123;sh,txt&#125; --exclude=*.<span class="built_in">log</span> --exclude-dir=/home/user -r /home	<span class="comment">#包括或排除文件</span></div><div class="line">-A/-B n	<span class="comment">#输出匹配 之后/之前 n行</span></div><div class="line">-c n	<span class="comment">#输出匹配 前后 n行</span></div></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="用cut按列切分文件"><a href="#用cut按列切分文件" class="headerlink" title="用cut按列切分文件"></a>用cut按列切分文件</h2><p><code>cut</code>是一个将文本按列进行切分的小工具，它也可以指定每列定界符。在cut的术语中，每列都是一个字段。<br></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#制表符'\t' 是cut默认的定界符</span></div><div class="line">cut -d<span class="string">' '</span> -f1 1.txt	<span class="comment">#-d指定分隔符，-f打印第几个字段</span></div><div class="line">cut -f1,2,3	<span class="comment">#打印1,2，3列</span></div><div class="line">-c字符；	-b字节；</div><div class="line">cut -c 1-5 1.txt	<span class="comment">#打印1-5字符</span></div><div class="line">cut -c -2 1.txt	<span class="comment">#打印前2个字符</span></div><div class="line">cut -c 3-	<span class="comment">#打印第3个字符到行尾</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="统计特定文件词频"><a href="#统计特定文件词频" class="headerlink" title="统计特定文件词频"></a>统计特定文件词频</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#单词解析可以用 关联数组,正则表达式配合sed,awk,grep等工具来完成</span></div><div class="line"><span class="comment">#关联数组中，将单词作为数组索引，单词次数作为数组值</span></div><div class="line">egrep -o <span class="string">"\b[:alpha:]+\b"</span>	<span class="comment">#匹配单词</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="sed入门"><a href="#sed入门" class="headerlink" title="sed入门"></a>sed入门</h2><p><code>sed</code>是stream editor(流编辑器)的缩写，它是文本处理中非常重要的工具。能够完美地配合正则表达式使用。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#sed - stream editor for filtering and transforming text</span></div><div class="line"><span class="comment">#字符/在sed中最为定界符使用</span></div><div class="line"></div><div class="line"><span class="comment">#替换</span></div><div class="line"><span class="comment">#sed 's/匹配样式/替代字符串/'</span></div><div class="line">sed <span class="string">'s/pattern/repalce/'</span> file	<span class="comment">#替换</span></div><div class="line">sed -i <span class="string">'s/pattern/repalce/'</span> file	<span class="comment">#将替换应用于file</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"1.txt"</span> &gt; 1.txt &amp;&amp; sed <span class="string">'s/txt/haha'</span> 1.txt	<span class="comment">#在输出中用haha替换txt</span></div><div class="line">sed -i <span class="string">'s/txt/haha/'</span> 1.txt	<span class="comment">#将1.txt文件中的txt用haha替换掉</span></div><div class="line"><span class="comment">#-i选项替换原文件</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"hahaha"</span> | sed <span class="string">'s/ha/HA/g'</span>	<span class="comment">#全部替换</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"hahaha"</span>	| sed <span class="string">'s/ha/HA/2g'</span>	<span class="comment">#指定位置替换，从第2处开替换全局</span></div><div class="line"></div><div class="line"><span class="comment">#移除匹配样式的行</span></div><div class="line">sed <span class="string">'/pattern/d</span></div><div class="line"><span class="string">sed '</span>/^$/d<span class="string">'	##移除空白行</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">#在sed中用&amp;标记已匹配字符串</span></div><div class="line"><span class="string">echo "A wonderful goal" | sed '</span>s/\w\+/[&amp;]/g<span class="string">'	#\w\+匹配每一个单词</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">#子串匹配标记\1,\2...</span></div><div class="line"><span class="string">echo "1st 2nd 3rd" | sed '</span>s/\(\w\+\) \(\w\+\) \(\w\+\)/\2 \1 \3/<span class="string">'</span></div><div class="line"><span class="string">2nd 1st 3rd</span></div><div class="line"><span class="string">#将\2和\1交换次序，(),+等在sed中要转义，否则要报错</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">#组合多个表达式</span></div><div class="line"><span class="string">sed '</span>expression1; expression2; ...</div><div class="line"><span class="built_in">echo</span> <span class="string">"aabbcc"</span> | sed <span class="string">'s/a/A/; s/b/B/; s/c/C/g'</span></div><div class="line">AaBbCC</div><div class="line"></div><div class="line"><span class="comment">#双引号 " " 内的特殊符号（如$等），可以保有原本的特性</span></div><div class="line"><span class="comment">#单引号 ' ' 内的特殊字符则仅为一般字符（纯文本）</span></div><div class="line"><span class="comment">#引用</span></div><div class="line">text=hello</div><div class="line"><span class="built_in">echo</span> <span class="string">'hello world'</span> | sed <span class="string">"s/<span class="variable">$text</span>/HELLO/"</span></div><div class="line">HELLO world</div></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="awk入门"><a href="#awk入门" class="headerlink" title="awk入门"></a>awk入门</h2><p><code>awk</code>被设计用于数据流，它可以对列和行进行操作。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#awk ‘begin&#123;print "start"&#125; pattern &#123;command&#125; end&#123;print "end"&#125;’ file</span></div><div class="line">awk <span class="string">'&#123;sum += $1&#125;; &#123;print sum&#125;'</span></div><div class="line"><span class="comment">#awk脚本由:begin块、end块和能使用模式(pattern)匹配的通用语句块 组成</span></div><div class="line"><span class="comment">#3个部分都是可选的</span></div><div class="line"><span class="comment">#awk也可以从stdin中读取内容</span></div><div class="line">cat /etc/passwd | awk -F: <span class="string">'&#123;print $1&#125;'</span>	<span class="comment">#-F指定界定符</span></div><div class="line"></div><div class="line"><span class="comment">#awk中的特殊变量</span></div><div class="line"><span class="comment">#NR：记录数量(number of records)，对应于当前行号</span></div><div class="line"><span class="comment">#NF：字段数量(number of fields)，对应于当前行的字段数</span></div><div class="line"><span class="comment">#$0：执行过程中当前行的文本内容</span></div><div class="line"><span class="comment">#$1,$2...$NF：第1个/2个.../最后一个 字段的内容</span></div><div class="line"><span class="built_in">echo</span> -e <span class="string">"L1 1\nL2 22\nL3 333"</span> | awk <span class="string">'&#123;print NR NF $0 $1 $2&#125;'</span></div><div class="line"><span class="comment"># NR NF $0    $1  $2 $NF=最后一个=$2</span></div><div class="line">  1  2  L1 1  L1  1  1</div><div class="line">  2  2  L2 2  L2  2  2</div><div class="line">  3  2  L3 3  L3  3  3</div><div class="line"></div><div class="line"><span class="comment">#将外部变量传递给awk</span></div><div class="line"><span class="comment">#-v选项可将外部值传递给awk</span></div><div class="line"><span class="comment">#  -v var=val  --assign=var=val</span></div><div class="line">var=<span class="string">'12345'</span></div><div class="line"><span class="built_in">echo</span> | awk -v v1=<span class="variable">$var</span> <span class="string">'&#123;print v1&#125;'</span></div><div class="line"><span class="comment">#多个变量</span></div><div class="line">var1=111; var2=222</div><div class="line"><span class="built_in">echo</span> | awk <span class="string">'&#123;print v1,v2&#125;'</span> v1=<span class="variable">$var1</span> v2=<span class="variable">$var2</span></div><div class="line"><span class="comment">#变量来自文件而非标准输入</span></div><div class="line">awk <span class="string">'&#123;print v1,v2&#125;'</span> v1=<span class="variable">$var1</span> v2=<span class="variable">$var2</span> file</div><div class="line"></div><div class="line"><span class="comment">#用样式对awk进行过滤处理</span></div><div class="line">awk <span class="string">'NR &lt; 3,NR==4'</span> 1.txt	<span class="comment">#行号&lt;5的行</span></div><div class="line">awk <span class="string">'/linux/'</span> 1.txt	<span class="comment">#匹配带有linux的行（可用re）</span></div><div class="line">awk <span class="string">'!/linux/'</span> 1.txt <span class="comment">#!匹配不带linux的行</span></div><div class="line"></div><div class="line"><span class="comment">#设置定界符</span></div><div class="line">awk -F: <span class="string">'&#123;print $1&#125;'</span> /etc/passwd</div><div class="line">awk <span class="string">'&#123;FS=":"&#125; &#123;print $1&#125;'</span> /etc/passwd</div><div class="line">awk <span class="string">'&#123;FS=":"; print $1&#125;'</span> /etc/passwd</div><div class="line"></div><div class="line"><span class="comment">#从awk中读取命令输出，用getline读取行</span></div><div class="line"><span class="built_in">echo</span> | awk <span class="string">'&#123;"grep root /etc/passwd" | getlin out; print out&#125;'</span></div><div class="line">root:x:0:0:root:/root:/bin/bash</div><div class="line"></div><div class="line"><span class="comment">#在awk中使用循环</span></div><div class="line">awk <span class="string">'&#123;for(i=1;i&lt;4;i++) &#123;print $i&#125;&#125;'</span> 2.txt	<span class="comment">#输出第1,2,3列</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="对文件中的行、单词、字符进行迭代"><a href="#对文件中的行、单词、字符进行迭代" class="headerlink" title="对文件中的行、单词、字符进行迭代"></a>对文件中的行、单词、字符进行迭代</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#迭代文件中的每一行</span></div><div class="line"><span class="built_in">echo</span> -e <span class="string">"1\n22\n333"</span> | <span class="keyword">while</span> <span class="built_in">read</span> line;<span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$line</span>;<span class="keyword">done</span></div><div class="line">grep <span class="string">"bash"</span> /etc/passwd | <span class="keyword">while</span> <span class="built_in">read</span> line;<span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$line</span>;<span class="keyword">done</span></div><div class="line"><span class="comment">#1</span></div><div class="line"><span class="comment">#22</span></div><div class="line"><span class="comment">#333</span></div><div class="line"></div><div class="line"><span class="comment">#迭代一行中的每一个单词</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"1 22 333"</span> | <span class="keyword">while</span> <span class="built_in">read</span> line;<span class="keyword">do</span> <span class="keyword">for</span> word <span class="keyword">in</span> <span class="variable">$line</span>;<span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$word</span>;<span class="keyword">done</span>;<span class="keyword">done</span></div><div class="line"><span class="comment">#1</span></div><div class="line"><span class="comment">#22</span></div><div class="line"><span class="comment">#333</span></div><div class="line"></div><div class="line"><span class="comment">#迭代一个单词中的每一个字符</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"abc"</span> | <span class="keyword">while</span> <span class="built_in">read</span> line;</div><div class="line"><span class="keyword">do</span></div><div class="line">	<span class="keyword">for</span> word <span class="keyword">in</span> <span class="variable">$line</span>;</div><div class="line">	<span class="keyword">do</span></div><div class="line">    	<span class="keyword">for</span>((i=0;i&lt;<span class="variable">$&#123;#word&#125;</span>;i++));</div><div class="line">		<span class="keyword">do</span></div><div class="line">        	<span class="built_in">echo</span> <span class="variable">$&#123;word:i:1&#125;</span>;</div><div class="line">		<span class="keyword">done</span>;</div><div class="line">	<span class="keyword">done</span>;</div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="comment">#写成一行</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"abc"</span> | <span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span> <span class="keyword">for</span> word <span class="keyword">in</span> <span class="variable">$line</span>; <span class="keyword">do</span> <span class="keyword">for</span>((i=0;i&lt;<span class="variable">$&#123;#word&#125;</span>;i++)); <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$&#123;word:i:1&#125;</span>; <span class="keyword">done</span>; <span class="keyword">done</span>; <span class="keyword">done</span></div><div class="line"><span class="comment">#a</span></div><div class="line"><span class="comment">#b</span></div><div class="line"><span class="comment">#c</span></div><div class="line"><span class="comment">#$&#123;#word&#125;返回变量word的长度</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="按列合并文件"><a href="#按列合并文件" class="headerlink" title="按列合并文件"></a>按列合并文件</h2><p>可以使用<code>paste</code>命令实现列拼接<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#paste - merge(整合) lines of files</span></div><div class="line"><span class="built_in">echo</span> -e  <span class="string">"1\n2\n3"</span> &gt; 1.txt &amp;&amp; <span class="built_in">echo</span> -e <span class="string">"Line1\nLine2\nLine3"</span> &gt; 2.txt</div><div class="line">paste 1.txt 2.txt</div><div class="line">1	Line1</div><div class="line">2	Line2</div><div class="line">3	Line3</div><div class="line"><span class="comment">#默认定界符是制表符，用-d指定</span></div><div class="line">paste 1.txt 2.txt -d<span class="string">','</span></div></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="打印文件或行中的第n个单词或n列"><a href="#打印文件或行中的第n个单词或n列" class="headerlink" title="打印文件或行中的第n个单词或n列"></a>打印文件或行中的第n个单词或n列</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">awk -F<span class="string">':'</span> <span class="string">'&#123;print $1,$3&#125;'</span> file1</div><div class="line">cut -d<span class="string">':'</span> -f 1,3 file1</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="打印不同行或样式之间的文本"><a href="#打印不同行或样式之间的文本" class="headerlink" title="打印不同行或样式之间的文本"></a>打印不同行或样式之间的文本</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">awk <span class="string">'NR==1,NR==10'</span> /etc/passwd</div><div class="line">awk <span class="string">'NR==1,NR==10'</span> /etc/passwd | awk -F<span class="string">":"</span> <span class="string">'&#123;print $1,$NF&#125;'</span> <span class="comment">#打印特定行内的特定列</span></div><div class="line"></div><div class="line">awk <span class="string">'/start_pattern/, /end_pattern/'</span> file	<span class="comment">#打印start到end之间的内容,可使用re</span></div><div class="line">awk <span class="string">'/root/, /zhang/'</span> /etc/passwd	<span class="comment">#打印root到zhang之间内容</span></div><div class="line">awk <span class="string">'/^ro.?t'</span>/, /bash$/<span class="string">' /etc/pass</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="以逆序形式打印行"><a href="#以逆序形式打印行" class="headerlink" title="以逆序形式打印行"></a>以逆序形式打印行</h2><p>可以使用<code>awk</code>, <code>tac</code>完成。tac就是反过来的cat。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#tac - 反转显示文件中的行，行内的内容无法用tac反向排列</span></div><div class="line">tac 1.txt</div><div class="line">awk <span class="string">'&#123;lifo[NR]=$0; lno=NR&#125; END&#123; for(;lno&gt;-1;lno--) &#123;print lifo[lno]&#125;;&#125;'</span> 1.txt</div></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="解析文本中的电子邮件和URL"><a href="#解析文本中的电子邮件和URL" class="headerlink" title="解析文本中的电子邮件和URL"></a>解析文本中的电子邮件和URL</h2><p>从给定的文件中解析出所需要的文本是我们从事文本处理时的一项任务。</p>
<p>grep, egrep, fgrep - print lines matching a pattern<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#egrep</span></div><div class="line"></div><div class="line"><span class="comment">#匹配一个邮箱地址</span></div><div class="line">egrep -o <span class="string">'[a-zA-Z0-9.]+@[0-9a-zA-Z.]+\.[a-zA-Z]&#123;2,4&#125;'</span> emails.txt</div><div class="line"></div><div class="line"><span class="comment">#匹配一个URL地址</span></div><div class="line">egrep -o <span class="string">"http://[a-zA-Z0-9.]+\.[a-zA-Z]&#123;2,3&#125;"</span> urls.txt</div></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="打印某个样式之前-之后n行"><a href="#打印某个样式之前-之后n行" class="headerlink" title="打印某个样式之前/之后n行"></a>打印某个样式之前/之后n行</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grep <span class="string">"zhang"</span> /etc/passwd -A 5	<span class="comment">#Ater</span></div><div class="line">grep <span class="string">"zhang"</span> /etc/passwd -B 5	<span class="comment">#Before</span></div><div class="line">grep <span class="string">"zhang"</span> /etc/passwd -C 5	<span class="comment">#前后五行都打印</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="在文件中移除包含某个单词的句子"><a href="#在文件中移除包含某个单词的句子" class="headerlink" title="在文件中移除包含某个单词的句子"></a>在文件中移除包含某个单词的句子</h2><p>只要能写出正确的正则表达式(Regular Expression)，那就手到擒来</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed <span class="string">'s/[^.]*handsome boy[^.]*\.//g'</span> file.txt	<span class="comment">#句子以.结束</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="文本切片与参数操作"><a href="#文本切片与参数操作" class="headerlink" title="文本切片与参数操作"></a>文本切片与参数操作</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#替换变量内容中的部分文字</span></div><div class="line">var=<span class="string">"One two three"</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var/t/T&#125;</span>	<span class="comment">#只替换了一个</span></div><div class="line"><span class="comment">#One Two three</span></div><div class="line"></div><div class="line"><span class="comment">#指定字符串起始位置和长度</span></div><div class="line"><span class="comment">#$&#123;变量:开始部分:长度&#125;</span></div><div class="line"><span class="variable">$&#123;vari:start:length&#125;</span></div><div class="line"><span class="built_in">echo</span> &#123;var:0:2&#125;	<span class="comment">#On</span></div><div class="line"><span class="built_in">echo</span> &#123;var:1:6&#125;	<span class="comment">#ne two</span></div><div class="line"></div><div class="line"><span class="comment">#起始字符的索引是0,将最后一个字符索引记为-1</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var:(-1)&#125;</span>	<span class="comment">#e</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var:(-3):3&#125;</span>	<span class="comment">#ree</span></div></pre></td></tr></table></figure>
<p><br><br><br></p>
<h1 id="一团乱麻？没这回事"><a href="#一团乱麻？没这回事" class="headerlink" title="一团乱麻？没这回事"></a>一团乱麻？没这回事</h1><h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><p>本章会研究一些用于解析网站内容、下载数据、发送数据表单以及网站颇为任务自动化之类的实例。我们可以仅用几行脚本就将很多原本需要通过浏览器交互进行的活动管理自动化。通过命令行工具利用HTTP协议所提供的功能，我们可以用脚本解决大部分Web自动化的问题。</p>
<p><br></p>
<h2 id="网站下载"><a href="#网站下载" class="headerlink" title="网站下载"></a>网站下载</h2><p>使用一些命令行下载工具，从给定的URL中下载文件或网页。<br></p>
<p>wget是一个用于文件下载的命令行工具，选项多且用法灵活。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Wget - The non-interactive(非交互式) network downloader</span></div><div class="line"></div><div class="line">wget URL1 URL2...</div><div class="line">wget http://xxx.com/nginx-1.12.0.tag.gz</div><div class="line">wget https://xxx/a.rpm http://xxxx/bb.rpm</div><div class="line"></div><div class="line"><span class="comment">#指定文件名，指定信息输出(wget默认是stdout)</span></div><div class="line">wget http://mirrors.aliyun.com/repo/Centos-7.repo -O aliyun.repo -o ./wget.log</div><div class="line">wget URL -t 5	<span class="comment">#-t，重试次数</span></div><div class="line"></div><div class="line"><span class="comment">#下载限速</span></div><div class="line">wget --<span class="built_in">limit</span>-rate=10m URL	<span class="comment">#下载限速</span></div><div class="line">wget -Q 100m URL	<span class="comment">#指定下载配额</span></div><div class="line"></div><div class="line"><span class="comment">#端点续传</span></div><div class="line"><span class="comment">#wget进行的下载在完成前被中断，从断点开始下载</span></div><div class="line">wget -c URL</div><div class="line"></div><div class="line"><span class="comment">#用cURL下载</span></div><div class="line"><span class="comment">#cURL是一个比wget更强大的高级命令工具</span></div><div class="line"><span class="comment">#和wget不同，curl并不将下载数据写入文件，而是写入stdout，因此必须重定向到文件</span></div><div class="line"></div><div class="line"><span class="comment">#复制或镜像整个网站</span></div><div class="line"><span class="comment">#wget有一个选项可以使其像爬虫一样以递归方式手机网页上所有URL链接，并逐个下载</span></div><div class="line"><span class="comment">#这样一来就可以下载一个网站的所有页面</span></div><div class="line">wget --mirror URL</div><div class="line"><span class="comment">#-m(--mirror) -N -r -l inf --no-remove-listing 的缩写形式。</span></div><div class="line">或 wget -r -N -l DEPTH URL</div><div class="line"><span class="comment">#-r递归下载，-l指定递归深度，-N(timestamp)只获取比本地时间新的文件</span></div><div class="line"></div><div class="line"><span class="comment">#访问需要认证的HTTP或FTP页面</span></div><div class="line">wget --user <span class="string">"username"</span> --password <span class="string">"pass"</span> URL</div><div class="line"><span class="comment">#如未在命令行内输入密码，则会由网页提示手动输入</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="以格式化纯文本下载网页"><a href="#以格式化纯文本下载网页" class="headerlink" title="以格式化纯文本下载网页"></a>以格式化纯文本下载网页</h2><p>网页其实就是包含HTML标记和其他诸如Javascript，CSS等元素的HTML页面。HTML标记是网页的基础，也许需要解析网页来查找特定的内容。<br></p>
<p>links,是一个基于命令行的Web浏览器</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#links - lynx-like alternative character mode WWW browser</span></div><div class="line"></div><div class="line"><span class="comment">#在命令行中浏览一个网页</span></div><div class="line">links www.baidu.com</div><div class="line"></div><div class="line"><span class="comment">#以ASCII形式下载网页</span></div><div class="line">links --dump URL &gt; URL.txt</div><div class="line"></div><div class="line"><span class="comment">#打开本地html文件</span></div><div class="line">links 1.html</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="cURL入门"><a href="#cURL入门" class="headerlink" title="cURL入门"></a>cURL入门</h2><p>cURL支持包括HTTP、HTTPS、FTP在内的众多协议。它还支持POST、cookie、认证、从指定偏移处下载部分文件、参照页(referer)、用户代理字符串、扩展头部(extra header)、限速、文件大小限制、进度条等特性。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#curl - transfer a URL</span></div><div class="line"><span class="comment">#cURL通常将下载文件输出到stdout，将进度信息输出到stderr</span></div><div class="line"><span class="comment">#要想避免显示进度信息，可使用--silent</span></div><div class="line"><span class="comment">#curl可用来下载、发送各种HTTP请求、指定HTTP头部等操作</span></div><div class="line"></div><div class="line">curl URL --silent	<span class="comment">#输出到stdout</span></div><div class="line"></div><div class="line"><span class="comment">#-O写入文件，文件名从URL中解析</span></div><div class="line">curl http://www.baidu.com/index.html -O --silent	<span class="comment">#创建index.html</span></div><div class="line"></div><div class="line"><span class="comment">#-o将数据写入指定文件</span></div><div class="line">curl URL -o baidu.html --progress	<span class="comment">#--progress显示进度条</span></div><div class="line">links baidu.html</div><div class="line"></div><div class="line"><span class="comment">#端点续传</span></div><div class="line"><span class="comment">#和wget不同，cURL包含更高级的下载恢复特性，能够从特定的文件偏移处继续下载</span></div><div class="line"><span class="comment">#curl可以通过指定一个偏移量来下载部分文件</span></div><div class="line">手动：curl URL/file -C offset	<span class="comment">#偏移量以Byte为单位的整数</span></div><div class="line">自动：curl -C -URL	<span class="comment">#自动续传</span></div><div class="line"></div><div class="line"><span class="comment">#用cURL设置参照页字符串, --referer</span></div><div class="line"><span class="comment">#参照页(referer)是位于HTTP头部中的一个字符串，用来标识用户从哪个页面到达当前页面的</span></div><div class="line"><span class="comment">#如果用户点击网页A中某个链接，转到了网页B。那么网页B头部的referer会包含网页A的URL</span></div><div class="line">curl --referer Referer_URL target_URL</div><div class="line">curl --referer http://www.baidu.com http://jianshu.com</div><div class="line"></div><div class="line"><span class="comment">#用cURL设置cookie, --cookie</span></div><div class="line"><span class="comment">#可以用curl来存储HTTP操作过程中使用到的cookie</span></div><div class="line"><span class="comment">#cookie用key=value形式，指定多个用 分号 分隔</span></div><div class="line">curl URL --cookie <span class="string">"user=AAA;name=bbb"</span></div><div class="line">curl URL --cookie-jar cookie.txt	<span class="comment">#将cookie另存为</span></div><div class="line"></div><div class="line"><span class="comment">#用cURL设置用户代理字符串, --user-agent</span></div><div class="line"><span class="comment">#如果不指定代理，一些需要用户代理的网页就无法显示</span></div><div class="line">curl URL --user-agent(-A) <span class="string">"Mozilla"</span></div><div class="line"></div><div class="line"><span class="comment">#用-H "头部信息"传递多个头部信息</span></div><div class="line">curl -H <span class="string">"Host:www.haha.com"</span> -H <span class="string">"Accept-language: en"</span> URL</div><div class="line"></div><div class="line"><span class="comment">#限定cURL可占用的带宽</span></div><div class="line">curl URL --<span class="built_in">limit</span>-rate 10m</div><div class="line"></div><div class="line"><span class="comment">#指定最大下载量</span></div><div class="line">curl URL --max-filesize 大小(Bytes)</div><div class="line"></div><div class="line"><span class="comment">#用cURL进行认证，-u username:password指定用户名和密码</span></div><div class="line">curl -u user:pass URL</div><div class="line">curl -u user URL	<span class="comment">#手动输入密码</span></div><div class="line"></div><div class="line"><span class="comment">#只打印响应头部信息(无数据部分), -I</span></div><div class="line">curl -I URL</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="从命令行访问163邮箱"><a href="#从命令行访问163邮箱" class="headerlink" title="从命令行访问163邮箱"></a>从命令行访问163邮箱</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl -u user http://mail.163.com</div><div class="line"><span class="comment">#手动输入密码</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="制作图片抓取器及下载工具"><a href="#制作图片抓取器及下载工具" class="headerlink" title="制作图片抓取器及下载工具"></a>制作图片抓取器及下载工具</h2><p>可以用脚本解析图像文件并将图片自动下载下来。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">curl -s URL | grep -o <span class="string">"&lt;img src=[^&gt;]*&gt;"</span> | sed <span class="string">'s/&lt;img src=//g; s/&gt;//g'</span> &gt; img.list</div><div class="line"><span class="comment">#匹配图片的URL，可能还需要细化修改</span></div><div class="line"><span class="comment">#不同的URL可能有不同的规则，根据实际情况取出img的URL</span></div><div class="line"></div><div class="line"><span class="comment">#下载图片</span></div><div class="line">wget <span class="variable">$URL</span> 或 curl -s -O <span class="variable">$URL</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="查找网站中的无效链接"><a href="#查找网站中的无效链接" class="headerlink" title="查找网站中的无效链接"></a>查找网站中的无效链接</h2><p>将查找无效链接的工作自动化，那就比纯手动厉害多了！</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">lynx -traversal URL <span class="comment">#会将URL中所有链接生成到reject.dat文件中</span></div><div class="line">sort -u reject.dat | <span class="keyword">while</span> <span class="built_in">read</span> link</div><div class="line"><span class="keyword">do</span></div><div class="line">	output=`curl -I <span class="variable">$link</span> -s | grep <span class="string">"HTTP/.*OK"</span>`</div><div class="line">    <span class="keyword">if</span> [[ -z <span class="variable">$output</span> ]]</div><div class="line">    <span class="keyword">then</span></div><div class="line">    	<span class="built_in">echo</span> <span class="variable">$link</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line"><span class="keyword">done</span> &lt; links.txt</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="跟踪网站变更"><a href="#跟踪网站变更" class="headerlink" title="跟踪网站变更"></a>跟踪网站变更</h2><p>可以编写一个定期运行的变更跟踪器(change tracker)，一旦发生变更，跟踪器便会发出声音或发送提示信息。<br>在不同时间检索网站，然后利用 <code>diff</code> 命令进行比对。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">curl URL --silent -o `date +%F`.html	<span class="comment">#第一次</span></div><div class="line">curl URL --silent -o `date +%F`.html	<span class="comment">#第二次</span></div><div class="line">diff -u 第一次 第二次</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="以POST方式发送网页并读取响应"><a href="#以POST方式发送网页并读取响应" class="headerlink" title="以POST方式发送网页并读取响应"></a>以POST方式发送网页并读取响应</h2><p>POST 和 GET 是HTTP协议中用于发送或检索信息的两种请求类型。<br>在GET请求方式中，利用网页的URL来发送参数(“键-值”)；而POST方式用于提交表单，如提交用户名、密码以及检索登录页面等。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">curl URL -d “postarg=AABBCC” <span class="comment">#-d,http post data</span></div><div class="line">curl URL -d <span class="string">"post1=key1&amp;post2=key2&amp;post3..."</span>	<span class="comment">#指定多个数据</span></div><div class="line"></div><div class="line">wget URL -post-data <span class="string">"post1=key1"</span></div></pre></td></tr></table></figure>
<p><br><br><br></p>
<h1 id="Plan-B"><a href="#Plan-B" class="headerlink" title="Plan B"></a>Plan B</h1><p><br></p>
<h2 id="简介-4"><a href="#简介-4" class="headerlink" title="简介"></a>简介</h2><p>提取快照和备份数据都是重要的工作，我们可以通过shell脚本来实现备份自动化。<br>归档和压缩对于SA来说同样很重要，有多种压缩格式。<br>加密是一种保护数据的方法，为了减少加密数据的大小，文件在加密前通常需要先归档和压缩。</p>
<p><br></p>
<h2 id="用tar归档"><a href="#用tar归档" class="headerlink" title="用tar归档"></a>用tar归档</h2><p><code>tar</code>命令可以用来归档文件(tar archives tar)。可以将多个文件和文件夹打包为单个文件，同时还能保留所有的文件属性。<br>由<code>tar</code>命令创建的文件通常称为tarball。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#归档文件，-c(create file)</span></div><div class="line">tar -cf 1.tar [sources]	<span class="comment">#-f(specify filename)指定文件名</span></div><div class="line"><span class="comment">#文件名必须紧跟在-f之后</span></div><div class="line">tar -cvf txt.tar *.txt	<span class="comment">#-v(verbose)详细信息</span></div><div class="line"></div><div class="line"><span class="comment">#向已归档文件中添加文件，-r</span></div><div class="line">tar -rvf txt.tar *.html</div><div class="line"></div><div class="line"><span class="comment">#列出归档文件中的内容，-t</span></div><div class="line">tar -tf txt.tar	<span class="comment">#列出归档内容</span></div><div class="line">tar -tvf txt.tar	<span class="comment">#列出内容详细信息</span></div><div class="line"></div><div class="line"><span class="comment">#从归档文件中提取文件或文件夹，-x(exact)</span></div><div class="line">tar -xf txt.tar	<span class="comment">#默认提取到当前目录</span></div><div class="line"><span class="comment">#-C指定提取目录</span></div><div class="line">tar -xvf txt.tar -C /dir/path</div><div class="line"><span class="comment">#只提取归档中特定文件</span></div><div class="line">tar -xf txt.tar 1.txt 1.html -C /tmp	<span class="comment">#只会提取1.txt和1.html文件</span></div><div class="line"></div><div class="line"><span class="comment">#在tar中使用stdin和stdout</span></div><div class="line">tar -cvf - *.text | tar -xvf - -C /tmp</div><div class="line"></div><div class="line"><span class="comment">#拼接两个归档文件，-A</span></div><div class="line">tar -Af txt.tar html.tar</div><div class="line">tar -tvf txt.tat	<span class="comment">#验证是否成功</span></div><div class="line"></div><div class="line"><span class="comment">#添加选项，可以将指定的任意文件加入到归档文件中。如果同名文件已存在，不会覆盖源文件，那么结果就是归档中包含了多个同名文件</span></div><div class="line"><span class="comment">#通过检查时间戳来更新对党文件中的内容，-u</span></div><div class="line"><span class="comment">#只有比归档文件中同名文件 更新(newer) 才添加</span></div><div class="line">tar -uvf html.tar 1.html</div><div class="line"></div><div class="line"><span class="comment">#比较归档文件与文件系统中的内容，-d</span></div><div class="line">tar -df txt.tar 1.txt 2.txt</div><div class="line"></div><div class="line"><span class="comment">#从归档文件中删除文件，--delete</span></div><div class="line">tar -f txt.tar --delete 1.txt 2.txt</div><div class="line"></div><div class="line"><span class="comment">#从归档文件中排除部分文件,--exclude</span></div><div class="line">tar -cf all.tar ./* --exclude=<span class="string">"*.html"</span>	<span class="comment">#排除.html文件</span></div><div class="line">tar -cvf txt.tar *.txt --exclude=<span class="string">"1.txt"</span></div><div class="line"></div><div class="line"><span class="comment">#打印总字节数,--totals</span></div><div class="line">tar -cf all.txt ./* --totals</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#压缩tar归档文件，指定不同压缩格式</span></div><div class="line"></div><div class="line"><span class="comment">#-z,	.tar.gz</span></div><div class="line"><span class="comment">#-j,	.tar.bz2</span></div><div class="line"><span class="comment">#--lzma,	.tar.lzma,</span></div><div class="line"><span class="comment">#.tar.lzo</span></div><div class="line">tar -czvf txt.tar.gzip *.txt</div><div class="line">tar -xzvf txt.tar -C /dir/path</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="用cpio归档"><a href="#用cpio归档" class="headerlink" title="用cpio归档"></a>用cpio归档</h2><p><code>cpio</code>是类似于tar的另一种归档格式。它多用于RPM软件包、Linux内核和initramfs文件等。<br>cpio通过stdin获取输入，并将归档写入stdout。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">touch file&#123;1..4&#125;</div><div class="line"></div><div class="line"><span class="built_in">echo</span> file1 file2 file3 file4 | cpio -ov file.cpio</div><div class="line"><span class="comment">#-o指定输出，-v打印归档文件列表</span></div><div class="line"></div><div class="line"><span class="comment">#-i指定输入，-t列出归档中文件</span></div><div class="line">cpio -it &lt; file.cpio</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="用gunzip或gzip压缩"><a href="#用gunzip或gzip压缩" class="headerlink" title="用gunzip或gzip压缩"></a>用gunzip或gzip压缩</h2><p>gzip是GNU/Linux下常用压缩格式。<code>gzip</code>,<code>gunzip</code>都可处理gzip压缩文件类型。<br><code>gzip</code>只能够压缩单个文件，而无法对目录和多个文件进行归档。因此需要先交给<code>tar</code>，然后再用<code>gzip</code>压缩</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">gzip file	<span class="comment">#file.gz，会覆盖原文件</span></div><div class="line">gunzip file.gz	<span class="comment">#file，也会删除原文件</span></div><div class="line"></div><div class="line"><span class="comment">#列出压缩文件的属性信息，-l</span></div><div class="line">gzip -l file.gz</div><div class="line"></div><div class="line"><span class="comment">#指定gzip的压缩级别，--fast或--best</span></div><div class="line">--fast	最低压缩比，最快速度完成</div><div class="line">--best	最高压缩比，最慢速度完成</div><div class="line"></div><div class="line"><span class="comment">#将gzip与归档文件结合，-z</span></div><div class="line">tar -czvf txt.tar.gzip ./*.txt</div><div class="line"><span class="comment">#-a指定从文件扩展名自动判断压缩格式</span></div><div class="line">tar -cavf txt.tar.gzip ./*.txt</div><div class="line"></div><div class="line"><span class="comment">#tar只能从命令行中接收有限个文件，要解决这个问题，可以写一个循环并添加-r选项</span></div><div class="line"></div><div class="line"><span class="comment">#解压缩，-x</span></div><div class="line">tar -xzvf txt.tar.gzip</div><div class="line">tar -xavf txt.tar.gzip -C /dir/path</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="用bunzip或bzip压缩"><a href="#用bunzip或bzip压缩" class="headerlink" title="用bunzip或bzip压缩"></a>用bunzip或bzip压缩</h2><p><code>bzip2</code>通常能够生成比gzip更小(压缩比更高)的文件。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">bzip2 file	<span class="comment">#file.bz2,同理会覆盖原文件</span></div><div class="line">bzip2 file -k	<span class="comment">#保留原文件</span></div><div class="line">bunzip2 file.bz2	<span class="comment">#解压缩</span></div><div class="line">bunzip file.bz2 -k</div><div class="line"></div><div class="line"><span class="comment">#从stdin读入并写到stdout</span></div><div class="line">cat file | bzip2 -c &gt; file.bz2</div><div class="line"></div><div class="line"><span class="comment">#将bzip2与归档文件结合，-j</span></div><div class="line">tar -cvjf 1.tar.bz2 ./1.*</div><div class="line">tar -cavf 1.tar.bz2 ./1.*	<span class="comment">#-a根据文件扩展名自动判断压缩格式</span></div><div class="line">tar -xjvf 1.tar.bz2</div><div class="line">tar -xavf 1.tar.bz2 -C /tmp</div><div class="line"></div><div class="line"><span class="comment">#压缩比</span></div><div class="line"><span class="comment">#从1级(速度最快，压缩率最低)到9级</span></div><div class="line">bzip -9 -k file</div><div class="line"></div><div class="line"><span class="comment">#对成千上万的文件进行归档，需要借助 循环和-r选项</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="lzma压缩"><a href="#lzma压缩" class="headerlink" title="lzma压缩"></a>lzma压缩</h2><p><code>lzma</code>是一个较新的压缩工具，它提供了比gzip或bzip2更好的压缩率。<br>xz, unxz, xzcat, lzma, unlzma, lzcat - Compress or decompress .xz and .lzma files</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">lzma file	<span class="comment">#file.lzma,同样也会删除原文件</span></div><div class="line">lzma file -k 	<span class="comment">#保留原文件</span></div><div class="line">unlzma file.lzma</div><div class="line"></div><div class="line"><span class="comment">#从stdin读入并写入stdout</span></div><div class="line">cat file | lzma -C &gt; file.lzma</div><div class="line"></div><div class="line"><span class="comment">#与tar相结合,--lzma</span></div><div class="line">tar -cvf 1.tar.lzma ./1.* --lzma</div><div class="line">tar -cavf 1.tat.lzma ./1.*	<span class="comment">#自动判断</span></div><div class="line">tar -xvf 1.tar.lzma --lzma</div><div class="line">tar -xavf 1.tar.lzma -C /tmp</div><div class="line"></div><div class="line"><span class="comment">#压缩率</span></div><div class="line"><span class="comment">#从1级到9级(压缩级别最高，速度最慢)</span></div><div class="line"></div><div class="line"><span class="comment">#对成千上万的文件，需要使用循环和-r选项</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="zip归档和压缩"><a href="#zip归档和压缩" class="headerlink" title="zip归档和压缩"></a>zip归档和压缩</h2><p><code>zip</code>在Linux下不如<code>gzip</code>,<code>bzip2</code>那么广泛，但在Internet上的文件通常都采用这种格式。<br>zip - package and compress (archive) files</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">zip file.zip file</div><div class="line">unzip file.zip</div><div class="line"><span class="comment">#与lzma,gzip,bzip2相比，zip完成后不会删除原文件</span></div><div class="line"></div><div class="line"><span class="comment">#对目录和文件进行递归操作,-r</span></div><div class="line">zip -r dir.zip /root/<span class="built_in">test</span> ./file</div><div class="line"></div><div class="line"><span class="comment">#向归档文件中增加内容，-u</span></div><div class="line">zip dir.zip -u newfile</div><div class="line"></div><div class="line"><span class="comment">#从压缩文件中删除内容，-d</span></div><div class="line">zip -d dir.zip file</div><div class="line"></div><div class="line"><span class="comment">#列出归档文件中内容</span></div><div class="line">unzip -l dir.zip</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="超高压缩率的squashfs文件系统"><a href="#超高压缩率的squashfs文件系统" class="headerlink" title="超高压缩率的squashfs文件系统"></a>超高压缩率的squashfs文件系统</h2><p><code>squashfs</code>是一种只读型的超高压缩率文件系统。这种文件系统能够将 2GB-3GB的数据压缩成一个700MB的文件。<br>你有没有想过Linux Live CD是怎样运行的？当Live CD启动后，它会加载一个完整的Linux环境。这就是利用了一种被称为squashfs的只读型压缩文件系统。它将根文件系统保存在一个压缩过的文件系统文件中。这个文件可以使用环回的形式来挂载并对其中的文件进行访问。一次当进程需要某些文件，可以将它们解压，然后载入内存中使用。<br>如果需要构建一个定制的Live OS，或是需要超高压缩率的文件并且无需解压就可以访问文件，那么squashfs的相关知识就能派上用场。要解压个头较大的压缩文件，需要花费不少时间。但如果将文件以环回形式挂载，速度就飞快，因为只有出现访问请求的时候，对应的那部分压缩文件才会被解压缩。而普通的解压缩方式是首先解压缩所有的数据。</p>
<p>环回文件系统就是指那些在文件中而非物理设备中创建的文件系统。比如我们可以创建一个文件，然后把这个文件格式化为我们常见ntfs、exfat或者ext4等文件系统格式，然后把它挂载在一个目录上使用。</p>
<p>如果你有一张Ubuntu CD，可以在CDRom Root/casper/filesystem.squashfs中找到文件.squashfs。<br>squashfs在内部采用了gzip和lzma这类压缩算法。</p>
<p>mksquashfs - tool to create and append to squashfs filesystems</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">yum install squashfs-tools -y</div><div class="line"></div><div class="line"><span class="comment">#创建squashfs文件</span></div><div class="line">mksquashfs <span class="built_in">source</span> compressfile.squashfs</div><div class="line"></div><div class="line">mksquashfs /etc etc.squashfs</div><div class="line"><span class="comment">#/etc(67M) --&gt; etc.suqashfs(18M)</span></div><div class="line"></div><div class="line"><span class="comment">#要挂载squashfs文件，利用环回形式进行挂载</span></div><div class="line">mkdir /mnt/squash</div><div class="line">mount -o loop etc.squashfs /mnt/squash</div><div class="line"><span class="comment">#此处挂载使用etc.squashfs文件系统</span></div><div class="line"><span class="comment">#如果直接查看etc.squashfs，就是一个普通文件，但是挂载以后所有文件都出现了</span></div><div class="line">umount /mnt/squash</div><div class="line"></div><div class="line"><span class="comment">#在创建squashfs文件时排除指定文件，-e</span></div><div class="line">mksquashfs /etc etc.squashfs -e /etc/passwd /etc/shadow /etc/*.txt</div><div class="line"><span class="comment">#在挂载之后就没有相关文件了</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="加密工具与散列"><a href="#加密工具与散列" class="headerlink" title="加密工具与散列"></a>加密工具与散列</h2><p>加密技术主要用于防止数据遭受未经授权的访问。<br>Linux下某些工具用于执行加密和解密，使用加密算法散列值来验证数据完整性。</p>
<p><strong><code>crypt</code>, <code>gpg</code>, <code>base64</code>, <code>md5sum</code>, <code>sha1sum</code>, <code>openssl</code>的用法</strong></p>
<h3 id="ccypt"><a href="#ccypt" class="headerlink" title="ccypt"></a>ccypt</h3><p>ccrypt是为了取代UNIX crypt而设计的，这个实用工具可用于文件和数据流加密及解密。<br>ccrypt - encrypt and decrypt files and streams</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ccrypt 1.txt	<span class="comment">#会要求输入口令(encryption key)</span></div><div class="line"><span class="comment">#之后会生成1.txt.cpt覆盖原文件</span></div><div class="line"></div><div class="line"><span class="comment">#更改key,-x</span></div><div class="line">ccrypt -x 1.txt.cpt	<span class="comment">#输入old key和new key</span></div><div class="line"></div><div class="line"><span class="comment">#解密，-d(--decrypt)</span></div><div class="line">ccrypt -d 1.txt.cpt	<span class="comment">#输入key解密</span></div></pre></td></tr></table></figure>
<h3 id="gpg"><a href="#gpg" class="headerlink" title="gpg"></a>gpg</h3><p>gpg(GNU privacy guard,GNU隐私保护)，是一种应用广泛的加密方案。<br>它采用签名密钥技术保护文件内容，只有经过认证的用户才能访问数据。我们对gpg签名早已耳熟能详。<br>gpg - OpenPGP encryption and signing tool<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#加密，-c(--symmetric)对称加密</span></div><div class="line">gpg -c file	<span class="comment">#会要求输入口令(Passphrase)，生成file.gpg</span></div><div class="line"><span class="comment">#解密</span></div><div class="line">gpg file.gpg</div></pre></td></tr></table></figure></p>
<h3 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h3><p><code>base64</code>是一组类似的编码方案(encoding scheme)，它通过将ASCII字符转换成以64为基数的形式(radix-64 representation)来用ASCII字符串描述二进制数据。base64可用来对 编码和解码 base64字符串。<br>base64 - base64 encode/decode data and print to standard output<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#将文件编码为base64格式</span></div><div class="line">base64 file &gt; outputfile</div><div class="line">cat file | base64 &gt; outputfile</div><div class="line"></div><div class="line"><span class="comment">#解码,-d</span></div><div class="line">base64 -d outputfile &gt; file</div></pre></td></tr></table></figure></p>
<h3 id="md5sum与sha1sum"><a href="#md5sum与sha1sum" class="headerlink" title="md5sum与sha1sum"></a>md5sum与sha1sum</h3><p><code>md5sum</code> 和 <code>sha1sum</code> 都是单向散列算法(unidirecrional hash algorithm)，均无法逆推出原始数据。<br>它们通常用于验证数据完整性或为特定数据生成唯一的密钥，因为通过分析文件内容，它们可以为每个文件生成一个唯一的密钥。</p>
<p>这种类型的散列算法是存储密码的理想方案。密码使用其对应的散列值来存储。如果某个用户需要认证，读取该用户提供的密码并转换成散列值，然后将其与之前存储的散列值进行比对。<br>将密码以明文的形式存储是非常危险的事情，它面临密码泄露的危险。而因为 md5sum和sha1sum 是单向散列算法，所以密码使用散列值存储是很安全的。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">"1.txt"</span> &gt; 1.txt</div><div class="line">md5sum 1.txt	<span class="comment">#生成密钥到stdout</span></div><div class="line"><span class="comment">#39061daa34ca3de20df03a88c52530ea  1.txt</span></div><div class="line"></div><div class="line">sha1sum file	<span class="comment">#生成密钥到stdout</span></div><div class="line"><span class="comment">#659fcbc505db207c03b5c4c0b6981d63286abe21  1.txt</span></div><div class="line"></div><div class="line"><span class="comment">#查看/etc/shadow中密码的散列值</span></div><div class="line">awk <span class="string">'NR==1'</span> /etc/shadow | awk -F: <span class="string">'&#123;print $2&#125;'</span>	<span class="comment">#root密码散列</span></div><div class="line"><span class="comment">#$6$BxpV48gPsjuq6.pF$wE7pUDwtOI.v64kd5folG68yUt2UAQDTUGgKa5Iz69GaupEoRAdCeerP8nRKXo48c4azutUCGhnDgzd1qe8YX0</span></div></pre></td></tr></table></figure>
<h3 id="shadowlike散列-salted散列"><a href="#shadowlike散列-salted散列" class="headerlink" title="shadowlike散列(salted散列)"></a>shadowlike散列(salted散列)</h3><p>shadow密码通常都是salted密码，所谓SALT就是额外的一个字符串，用来起一个混淆的作用，使加密更加不同里被破解。salt由一些随机位组成，被用作密钥生成函数的输入之一，以生成密码的salted散列值。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#/etc/passwd里面的密码散列类型就是salted散列</span></div><div class="line"></div><div class="line"><span class="comment">#查看root密码对应的散列值</span></div><div class="line">head -1 /etc/shadow</div><div class="line">root:<span class="variable">$6</span><span class="variable">$ZlHRCZG2iRwQUXAu</span><span class="variable">$RAEDH97nPdZB2RK20npua6Qf6jB7osatoC99ow3LtPQ6aORdLISYC7</span>/4iTYU162emkQLt4ZafdgjyAeoSB7IU0::0:99999:7:::</div><div class="line"></div><div class="line"><span class="comment">#openssl - OpenSSL command line tool</span></div><div class="line"></div><div class="line"><span class="comment">#shadow密码是使用openssl生成</span></div><div class="line"><span class="comment">#将SALT_STRING替换为随机字符串，同时将pass替换成你想测试的密码</span></div><div class="line">openssl -1 -salt SALT_STRING passwd</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="用rsync备份系统"><a href="#用rsync备份系统" class="headerlink" title="用rsync备份系统"></a>用rsync备份系统</h2><p><code>rsync</code>借助差异计算以及压缩技术来最小化数据传输量。相较于<code>cp</code>命令，它的优势在于使用了高效的差异算法(difference algorithm)。<br>它还支持网络数据传输。在进行复制的同时，rsync会比较源端和目的端的文件，只有当文件有更新是才进行复制。默认情况下，rsync并不会在目的端删除源端已不存在的文件。</p>
<p>rsync - a fast, versatile, remote (and local) file-copying tool<br>inotifywait - wait for changes to files using inotify</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#-a进行归档，-v详细信息</span></div><div class="line">rsync -av <span class="built_in">source</span> destination</div><div class="line">rsync -av /etc /tmp</div><div class="line"></div><div class="line"><span class="comment">#异地cp</span></div><div class="line">rsync -av <span class="built_in">source</span> username@host:PATH</div><div class="line">rsync -av username@host:PATH destination</div><div class="line"><span class="comment">#rsync借助于ssh，可以使用ssh无秘钥认证</span></div><div class="line">rsync -av /etc zhang@192.168.1.11:~</div><div class="line"></div><div class="line"><span class="comment">#-z, --compress  compress file data during the transfer</span></div><div class="line">rsync -avz zhang@192.168.1.11:/etc /tmp</div><div class="line"></div><div class="line"><span class="comment">#注意，路径格式</span></div><div class="line">rsync /etc /tmp	<span class="comment">#整个/etc目录</span></div><div class="line">rsync /etc/ /tmp	<span class="comment">#/etc目录下所有内容</span></div><div class="line"></div><div class="line"><span class="comment">#显示进度，--progress</span></div><div class="line">rsync -avz --progress /etc /tmp</div><div class="line"></div><div class="line"><span class="comment">#排除部分文件，--exclude</span></div><div class="line">rsync -avz /etc /tmp --exclude=/etc/nginx --exclude <span class="string">"*.txt"</span></div><div class="line"></div><div class="line"><span class="comment">#更新rsync时，删除不存在的文件，--delete</span></div><div class="line"><span class="comment">#默认情况下，rsync并不会在目的端删除源端已不存在的文件</span></div><div class="line">rsync -avz /etc zhang@192.168.1.1:~ --delete</div><div class="line"></div><div class="line"><span class="comment">#定期调度</span></div><div class="line">crontab -e</div><div class="line">0 */10 * * * rsync -avz /etc user@host:PATH</div><div class="line"></div><div class="line"><span class="comment">#实时同步，inotifywait+rsync</span></div><div class="line">yum install inotify-tools -y</div><div class="line"></div><div class="line"><span class="comment">#-m(monitor),-r(recursive),-q(--quiet)静默模式，-e(event)</span></div><div class="line"></div><div class="line">vi inotify_rsync.sh</div><div class="line">inotifywait -mrq -e creat,delete,modify,move --exclude <span class="string">"^.*\.filepart$"</span> /etc | <span class="keyword">while</span> <span class="built_in">read</span> file</div><div class="line"><span class="keyword">do</span></div><div class="line">rsync -az --exclude=<span class="string">".*"</span> --exclude=<span class="string">"*.swp"</span> --exclude=<span class="string">".filepart"</span> --delete /etc /tmp &gt; /dev/null 2&gt;<span class="variable">$1</span></div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="用Git备份版本控制"><a href="#用Git备份版本控制" class="headerlink" title="用Git备份版本控制"></a>用Git备份版本控制</h2><p>维护和恢复变更最好的方法是使用版本控制系统。由于代码变更频繁，版本控制系统多用于软件开发和代码维护。<br>Git(GNU it)是有名气也是最高效的版本控制系统。我们可在非编程环境下用Git备份普通文件。</p>
<p>git - the stupid content tracker</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">mkdir /home/zhang/gittest</div><div class="line"><span class="built_in">cd</span> /home/zhang/gittest</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#在源主机中添加用户信息</span></div><div class="line">git config --global user.name <span class="string">"username"</span>	<span class="comment">#设置用户名</span></div><div class="line">git config --global user.email <span class="string">"someone@example.com"</span>	<span class="comment">#设置邮箱</span></div><div class="line"></div><div class="line"><span class="comment">#创建一个空的Git版本库或初始化一个老版本</span></div><div class="line">git init</div><div class="line"></div><div class="line"><span class="comment">#记录变更到版本库</span></div><div class="line">git commit</div><div class="line"></div><div class="line"><span class="comment">#添加远程git目录并同步备份</span></div><div class="line">git remote add origin user@host:/home/zhang/gittest</div><div class="line"></div><div class="line"><span class="comment">#为git跟踪(git tracking)添加或删除文件</span></div><div class="line"><span class="comment">#add,添加内容至索引</span></div><div class="line">git add *</div><div class="line"><span class="comment">#git add *.txt; git add *.ph	#添加部分文件</span></div><div class="line"></div><div class="line"><span class="comment">#删除不需要跟踪的文件和文件夹</span></div><div class="line"><span class="comment">#rm,从工作去和索引删除文件</span></div><div class="line">git rm file</div><div class="line"><span class="comment">#git rm *.txt</span></div><div class="line"></div><div class="line"><span class="comment">#检查点或创建备份点(check point)</span></div><div class="line">git commit -m <span class="string">"Commit Message"</span></div><div class="line"></div><div class="line"><span class="comment">#push,更新远程</span></div><div class="line">git push</div><div class="line"></div><div class="line"><span class="comment">#用Git恢复数据</span></div><div class="line"><span class="comment">#log,显示提交日志</span></div><div class="line">git <span class="built_in">log</span></div><div class="line"></div><div class="line"><span class="comment">#返回之前某个版本或状态</span></div><div class="line">git checkout xxxxxxxx(Commit ID)</div><div class="line"></div><div class="line"><span class="comment">#clone,克隆一个版本库到本地</span></div><div class="line">git <span class="built_in">clone</span> URL</div><div class="line">git <span class="built_in">clone</span> user@host:PATH</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="用dd克隆磁盘"><a href="#用dd克隆磁盘" class="headerlink" title="用dd克隆磁盘"></a>用dd克隆磁盘</h2><p><code>dd</code>命令能用于克隆任何类型的磁盘，如硬盘、闪存、CD、DVD及软盘。<br>可能需要创建所有分区的副本而不仅仅是复制内容，包括硬盘分区、引导记录、分区表等信息。</p>
<p>使用dd的时候，要留意参数的顺序。错误的参数会损毁全部数据。dd基本上算是一个比特流复制器(bitstream duplicator),它可以将来自磁盘的比特流写入文件，也可以将来自文件的比特流写入硬盘。</p>
<p>dd - convert and copy a file</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">dd <span class="keyword">if</span>=<span class="built_in">source</span> of=target bs=block_size count=count</div><div class="line"><span class="comment">#bs块大小，count块数</span></div><div class="line"></div><div class="line">dd <span class="keyword">if</span>=/tmp/centos7.iso of=/dev/sdc</div><div class="line"></div><div class="line"><span class="comment">#/dev/zero是一个字符设备，它总是返回字符'\0'</span></div><div class="line">dd <span class="keyword">if</span>=/dev/zero of=./file bs=10m count=100</div><div class="line"></div><div class="line"><span class="comment">#用环回(loop back)方法可将任何由dd生产的文件镜像进行挂载</span></div><div class="line">mount -o loop file /mnt</div></pre></td></tr></table></figure>
<p><br><br><br></p>
<h1 id="无网不利"><a href="#无网不利" class="headerlink" title="无网不利"></a>无网不利</h1><h2 id="j简介"><a href="#j简介" class="headerlink" title="j简介"></a>j简介</h2><p>网络是计算机系统中重要的部分。我们以Tcp/Ip为协议栈，所有操作都是基于它进行的。</p>
<p>一些使用网络的应用通过打开并连接到防火墙端口进行运作，而有的管理任务可以通过网络进行。</p>
<p>##网络小知识</p>
<p>网络接口(Interface)用来连接网络。在每个系统中，默认都有一个称之为环回接口的lo，这个接口指向当前主机本身。<br>操作系统维护者一个被称为路由表(routing table)的表格，它包含了分组如何转发以及通过网络中的哪些节点转发的消息。<br>metric是路由算法用以确定到达目的地的最佳路径的计量标准，如路径长度。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#显示网络接口、子网掩码等详细信息</span></div><div class="line">ifconfig	<span class="comment">#/sbin/ifconfig</span></div><div class="line"></div><div class="line"><span class="comment">#显示某个特定接口</span></div><div class="line">ifconfig eth0</div><div class="line"></div><div class="line"><span class="comment">#提取IP地址</span></div><div class="line">ifconfig eth0 | egrep -o <span class="string">"inet [^ ]*"</span> | grep -o <span class="string">"[0-9.]*"</span></div><div class="line"></div><div class="line"><span class="comment">#设置网络接口的IP地址和子网掩码</span></div><div class="line">ifconfig eht0 192.168.1.11</div><div class="line">ifconfig eth0 192.168.1.11 netmask 255.255.255.0</div><div class="line"><span class="comment">#远程的时候，千万别乱改IP，不然连不上你就要去机房了</span></div><div class="line"></div><div class="line"><span class="comment">#MAC地址欺骗</span></div><div class="line">ifoconfig eth0 hw ether 11:22:33:44:55:66</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#域名服务器与DNS</span></div><div class="line">cat /etc/resolv.conf</div><div class="line"><span class="comment">#添加域名服务器</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"name 114.114.114.114"</span> &gt;&gt; /etc/resolv.conf</div><div class="line"><span class="comment">#nameserver 114.114.114.114</span></div><div class="line"></div><div class="line"><span class="comment">#一个域名可以分配多个地址，DNS只会返回其中一个</span></div><div class="line"><span class="comment">#要想获得域名所有IP地址，需要使用DNS查找工具</span></div><div class="line"></div><div class="line"><span class="comment">#DNS查找工具</span></div><div class="line">host www.baidu.com</div><div class="line">nslookup www.baidu.com</div><div class="line"></div><div class="line"><span class="comment">#自定义解析</span></div><div class="line">cat /etc/hosts</div><div class="line"><span class="built_in">echo</span> <span class="string">"192.168.1.11 www.zhang.me"</span> &gt;&gt; /etc/hosts</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#设置默认网关，显示路由表信息</span></div><div class="line"><span class="comment">#路由表</span></div><div class="line">route</div><div class="line">route -n	<span class="comment">#以数字形式显示地址</span></div><div class="line"></div><div class="line"><span class="comment">#设置默认网关</span></div><div class="line">route add default gw <span class="variable">$ip</span> <span class="variable">$interface</span></div><div class="line">route add default gw 192.168.1.1 eht0</div><div class="line"></div><div class="line"><span class="comment">#显示分组途经的所有网关地址</span></div><div class="line">traceroute www.baidu.com</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h2><p><code>ping</code>使用 <strong>网际控制报文协议(Internet Control Message Protocol,ICMP)</strong>的echo分组。如果分组能够送达且该主机为活动主机，那它就会发送一条回应。一旦主机不可到达，ping返回错误信息”Destination Host Unreachable”。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ping 192.168.1.1</div><div class="line"></div><div class="line"><span class="comment">#往返时间(Round Trip Time,RTT)</span></div><div class="line"></div><div class="line"><span class="comment">#发送分组数量</span></div><div class="line">ping <span class="variable">$URL</span> -c 6</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="列出网络上所有活动主机"><a href="#列出网络上所有活动主机" class="headerlink" title="列出网络上所有活动主机"></a>列出网络上所有活动主机</h2><p>当涉及大型局域网时，可能需要检查网络上的其他主机的活动状态。<br>一台非活动主机可能是：没有开机；网络连接有问题；主机禁ping；防火墙问题。</p>
<p>当我们要检测ip时，在一个脚本中，每一次<code>ping</code>都是依次执行。即使所有的ip地址都是彼此独立，由于编写的是顺式程序(sequential program)，<code>ping</code>命令也只能按顺序执行。每次执行一个<code>ping</code>命令。都要经历一段延迟——“发送echo分组，并接收或等待回应超时”。</p>
<p>要是处理几百个ip地址的话，这个延时就真不短了。我们可以使用并行方式来加速所有ping命令的执行。<br>可以将<code>ping</code>命令中的循环体放入<strong>( )&amp;</strong> 中，<strong>( )</strong> 使其中的命令可作为子shell来执行，<strong>&amp;</strong> 使之在后台继续运行。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#编写G一个并行方式的ping脚本</span></div><div class="line">fo ip <span class="keyword">in</span> 192.168.1.&#123;1..255&#125;</div><div class="line"><span class="keyword">do</span></div><div class="line">	(</div><div class="line">	ping <span class="variable">$ip</span> -c2 &amp;&gt; /dev/null;</div><div class="line">	<span class="keyword">if</span>[ $? -eq 0 ]</div><div class="line">		<span class="keyword">then</span></div><div class="line">			<span class="built_in">echo</span> <span class="string">"<span class="variable">$ip</span> is alive"</span></div><div class="line">	<span class="keyword">fi</span></div><div class="line">	)&amp;</div><div class="line"><span class="built_in">wait</span></div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="comment">#wait命令是脚本只有在所有子进程或后台进程全部终止或完成后才能结束</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#使用fping,-a显示活动主机，-g生成目标列表,-u显示无法到达主机</span></div><div class="line">fping -a 192.168.0.0/24 -g 2&gt; /dev/null</div><div class="line">fping -a 192.168.0.1 192.168.3.255 -g 2&gt; ./unreach.txt</div><div class="line"><span class="comment">#将unreach主机找出</span></div><div class="line">cat unreach.txt | egrep -o <span class="string">"to [0-9.]+$"</span> | grep -o <span class="string">"[0-9.]*"</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="传输文件"><a href="#传输文件" class="headerlink" title="传输文件"></a>传输文件</h2><p>有很多不同的方法可以在网络节点上传输文件，常见的协议有<strong>FTP, SFTP, RSYNC, SCP</strong>。</p>
<p>通过FTP传输文件可使用<code>lftp</code>命令；<br>通过SSH传输文件可使用<code>sftp</code>；<br>RSYNC使用<code>SSH</code>与<code>rsync</code>命令；<br><code>scp</code>通过SSH进行传输。</p>
<p><br><br>文件传输协议(File Transfer Protocol, FTP)，使用21端口。FTP是明文传输，So…<br>需要远程主机上启用了FTP服务器才能使用FTP。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">lftp user@ftp-host</div><div class="line"><span class="comment">#输入密码后便可以操作如下命令</span></div><div class="line"><span class="built_in">cd</span> -- lcd(本地)</div><div class="line">mkdir</div><div class="line">get filename	<span class="comment">#下载文件</span></div><div class="line">put filename	<span class="comment">#上传文件</span></div><div class="line">quit	<span class="comment">#退出</span></div></pre></td></tr></table></figure></p>
<p><br><br>SFTP(Secure FTP,安全FTP)，运行在SSH连接之上。利用SSH连接模拟FTP接口。<br>它不需要源端运行FTP服务器，不要运行OpenSSH。SFTP是一个交互式命令，提供了命令提示符。</p>
<p>rsync广泛用于网络文件与系统快照的备份。</p>
<p>SCP(Secure Copy,安全复制)，远程文件复制工具。通过SSH加密通过进行传输。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">scp SOURCE DESTINATION</div><div class="line"></div><div class="line">scp /path/file user@host:PATH</div><div class="line">scp usr@host:/dir/file /home/zhang</div><div class="line"><span class="comment">#需要输入密码，可以用SSH无秘钥认证</span></div><div class="line"></div><div class="line"><span class="comment">#-r递归复制,-p保持文件权限和模式</span></div><div class="line">scp -r /etc user@host:/tmp</div><div class="line">scp -rp user@host:/var/www  /var</div></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="SSH无秘钥认证"><a href="#SSH无秘钥认证" class="headerlink" title="SSH无秘钥认证"></a>SSH无秘钥认证</h2><p>特别是在定时任务传输备份文件时，无秘钥认证就很方便了。SSH服务默认在22端口，你可以在配置文件中修改。</p>
<p>具体步骤：</p>
<ol>
<li>创建SSH密钥(公钥和私钥)；</li>
<li>将客户端公钥上传给需要连接的主机，并写入~/.ssh/authorized_keys文件；</li>
<li>修改相关目录和文件权限；</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -t rsa</div><div class="line"><span class="comment">#后续操作默认即可</span></div><div class="line"><span class="comment">#生成~/.ssh/id_rsa.pub和id_rsa</span></div><div class="line"></div><div class="line"><span class="comment">#写入远程主机</span></div><div class="line">ssh user@host <span class="string">"cat &gt;&gt; ~/.ssh/authorized_keys"</span> &lt; ~/.ssh/id_rsa.pub</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="用SSH在远程主机上运行命令"><a href="#用SSH在远程主机上运行命令" class="headerlink" title="用SSH在远程主机上运行命令"></a>用SSH在远程主机上运行命令</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#连接远程主机</span></div><div class="line">ssh user@host</div><div class="line"></div><div class="line"><span class="comment">#非默认端口</span></div><div class="line">ssh user@host -p 2211</div><div class="line"></div><div class="line"><span class="comment">#在远程主机中运行命令</span></div><div class="line">ssh user@host <span class="string">'command'</span></div><div class="line">ssh user@host <span class="string">'cmd1'</span>; <span class="string">'com2'</span>...</div><div class="line"></div><div class="line">ssh user@host <span class="string">'whoami'</span></div><div class="line"></div><div class="line"><span class="comment">#-C压缩功能，当带宽有限时</span></div><div class="line">ssh -C user@host <span class="string">'cmd'</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="在本地挂载远程驱动器"><a href="#在本地挂载远程驱动器" class="headerlink" title="在本地挂载远程驱动器"></a>在本地挂载远程驱动器</h2><p>在执行读写数据操作时，通过本地挂载远程主机文件系统。利用SSH和sshfs来实现这一功能。<br>sshfs是FUSE文件系统的一个扩展，FUSE允许其支持的操作系统像使用本地文件系统一样挂载各类数据。<br><code>sshfs</code>允许将远程文件系统挂载到本地挂载点上。</p>
<p>相当于便捷的NFS，但并不需要搭建NFS服务。</p>
<p>SSHFS - filesystem client based on ssh<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#挂载远程文件到本地</span></div><div class="line">ssh user@host:PATH /mnt/sshfs</div><div class="line"></div><div class="line">umout /mnt/sshfs</div></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="网络流量和端口分析"><a href="#网络流量和端口分析" class="headerlink" title="网络流量和端口分析"></a>网络流量和端口分析</h2><p>应用程序在主机上打开端口，然后与远程主机中打开的端口实现通信。<br>出于安全方面的考虑，必须留意系统中打开及关闭的端口。</p>
<p>恶意软件和rootkit可能会利用特定的端口及服务运行在系统之中，从而进行攻击。<br>通过分析开放端口列表以及运行在端口上的服务，我们便可以分析并检查恶意软件，保证主机安全。</p>
<p>了解及使用各种端口分析工具。</p>
<p>lsof - list open files<br><code>lsof</code>列出系统中开放端口以及运行在端口上的服务的详细信息;</p>
<p>netstat查看开放端口与服务<br><code>netstat</code> - 显示网络连接，路由表，接口状态，伪装连接，网络链路信息和组播成员组;</p>
<p>iftop - display bandwidth usage on an interface by host<br><code>iftop</code> - 展示带宽使用情况；</p>
<p>ifstat - handy utility to read network interface statistics<br><code>ifstat</code> - 展示某时刻网络状态；</p>
<p> nload - displays the current network usage<br><code>nload</code> - 可查看系统总带宽；</p>
<p>nethogs - Net top tool grouping bandwidth per process<br><code>nethogs</code>- 可查看每个进程流量情况；</p>
<p>ethtool - query or control network driver and hardware settings<br><code>ethtool</code> - 检查网卡支持的带宽</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#lsof的每一项都对应着一个打开了特定端口的服务</span></div><div class="line">lsof -i</div><div class="line"></div><div class="line"><span class="comment">#查看开放端口和服务</span></div><div class="line">netstat -nltp</div><div class="line"></div><div class="line"><span class="comment">#查看网络实时状态</span></div><div class="line">iftop</div><div class="line"></div><div class="line"><span class="comment">#查看当前网络状态</span></div><div class="line">ifstat</div><div class="line"></div><div class="line"><span class="comment">#查看系统带宽</span></div><div class="line">nload</div><div class="line"></div><div class="line"><span class="comment">#查看进程流量</span></div><div class="line">nethogs</div></pre></td></tr></table></figure>
<p><br><br><br></p>
<h1 id="当个好管家"><a href="#当个好管家" class="headerlink" title="当个好管家"></a>当个好管家</h1><h2 id="简介-5"><a href="#简介-5" class="headerlink" title="简介"></a>简介</h2><p>操作系统(Operation System,OS)，是由一系列用于不同目的、服务于不同任务的系统软件组成。<br>日志记录(logging)和监视是很重要的，能帮助我们从大量数据中收集信息。</p>
<p>监视系统活动的各种命令，日志技术及其使用方法。</p>
<p><br></p>
<h2 id="统计磁盘使用情况"><a href="#统计磁盘使用情况" class="headerlink" title="统计磁盘使用情况"></a>统计磁盘使用情况</h2><p>磁盘空间是一种有限资源，我们需要了解磁盘的可用空间。</p>
<p><code>df</code>, <code>du</code>, <code>fdisk</code>是Linux中的磁盘管理三板斧<br>df(disk free): 报告文件系统磁盘空间的使用情况;<br>du(disk usage): 报告磁盘空间使用情况; 使用<code>du</code>时，要确保对其遍历的目录和文件拥有适合的读权限。<br>fdisk: Linux分区表操作工具软件。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">du file1	<span class="comment">#默认以字节为单位</span></div><div class="line"></div><div class="line"><span class="comment">#-a,显示目录下所有文件大小</span></div><div class="line">du -a /home/zhang</div><div class="line">du /home/zhang	<span class="comment">#只显示目录大小</span></div><div class="line"></div><div class="line"><span class="comment">#-h,以可读形式打印</span></div><div class="line">du -h /home/zhang</div><div class="line"></div><div class="line"><span class="comment">#-c,显示使用总量</span></div><div class="line">du -c file1 /dir2</div><div class="line">du -c *.txt *.sh</div><div class="line"></div><div class="line"><span class="comment">#-s，打印摘要</span></div><div class="line">du -s /dir</div><div class="line">du -sh /home/zhang</div><div class="line"></div><div class="line"><span class="comment">#-b,-k,-m,-B，用特定单位打印</span></div><div class="line">du -k file1</div><div class="line">du -m file2</div><div class="line"></div><div class="line"><span class="comment">#--exclude,从磁盘统计中排除部分文件</span></div><div class="line">du --exclude=<span class="string">"*.swap"</span> -sh /home/zhang</div><div class="line"></div><div class="line"><span class="comment">#--max-depth,指定最大遍历深度</span></div><div class="line">du -h --max-depth n /dir</div><div class="line">du -h --max-depth=2 /home/zhang</div><div class="line"></div><div class="line"><span class="comment">#-x,将/mnt中所有挂载点排除在磁盘统计之外</span></div><div class="line">du -xh /dir</div><div class="line"></div><div class="line"><span class="comment">#找出目录中最大的文件</span></div><div class="line">du -ak /dir | sort -nrk 1 | head -n 5</div><div class="line"><span class="comment">#此输出包含了目录大小，需要细化</span></div><div class="line"><span class="comment">#利用find替du过滤文件</span></div><div class="line">find /dir -<span class="built_in">type</span> f --<span class="built_in">exec</span> du -ak &#123;&#125; \; | sort -nrk 1 | head</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#df,磁盘可用空间信息</span></div><div class="line">df -h</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="计算命令执行时间"><a href="#计算命令执行时间" class="headerlink" title="计算命令执行时间"></a>计算命令执行时间</h2><p>当测试一个应用程序或比较不同的算法时，程序的执行时间非常重要。所以需要计算命令执行时间。</p>
<p>所有的Unix-Like操作系统都包含time命令，可将time放在需要计算执行时间的命令前。</p>
<blockquote>
<p>time命令有个可执行二进制文件位于/usr/bin/time，还有一个shell built-in命令也叫作time；<br>当运行time时，默认调用的是shell built-in命令。內建time命令选项有限；<br>因此，如果我们需要使用另外的功能，就应该使用/usr/bin/time命令。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#计算命令执行时间</span></div><div class="line">time <span class="built_in">command</span></div><div class="line">time ls</div><div class="line"></div><div class="line"><span class="comment">#real,挂钟时间(wall clock time),命令从开始执行到结束的时间；</span></div><div class="line"><span class="comment">#user,指进程花费在用户模式(user-mode)中的CPU时间。这是唯一用于执行进程所花费的时间；</span></div><div class="line"><span class="comment">#sys，指进程花费在内核模式(in the kernel)中的CPU时间。它代表在内核中执行系统调用所使用的时间。</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#-o,将命令执行时间写入文件</span></div><div class="line">/usr/bin/time -o exetime.txt ls /</div><div class="line"></div><div class="line"><span class="comment">#-a,不影响原文件</span></div><div class="line">/usr/bin/time -a -o exetime.txt ls /home</div><div class="line"></div><div class="line"><span class="comment">#-f,格式化时间输出</span></div><div class="line"><span class="comment">#时间格式字符串</span></div><div class="line"><span class="comment">#real	%e</span></div><div class="line"><span class="comment">#user	%U</span></div><div class="line"><span class="comment">#sys	%S</span></div><div class="line">/usr/bin/time -f <span class="string">"FORMAT STRING"</span> <span class="built_in">command</span></div><div class="line">/usr/bin/time -f <span class="string">"Rtme: %e"</span> -a -o timing.log uname</div><div class="line">/usr/bin/time -f <span class="string">"Rtime: %e\nUtime: %U\nStime: %S"</span> -ao timing.log uname</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="当前登录用户、启动日志、启动故障的相关信息"><a href="#当前登录用户、启动日志、启动故障的相关信息" class="headerlink" title="当前登录用户、启动日志、启动故障的相关信息"></a>当前登录用户、启动日志、启动故障的相关信息</h2><p>收集与操作系统、当前登录用户、主机运行时间、启动故障等相关信息很有用处。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#获取当前登录用户</span></div><div class="line">who	<span class="comment">#显示已经登录的用户</span></div><div class="line">w	<span class="comment">#显示已经登录的用户以及他们在做什么</span></div><div class="line"><span class="comment">#会显示用户使用的伪终端(pseudo TTY)，对应设备文件出现在/dev/pts/n</span></div><div class="line"></div><div class="line"><span class="comment">#列出登录主机的用户列表</span></div><div class="line">users</div><div class="line"></div><div class="line"><span class="comment">#查看系统运行时间</span></div><div class="line">uptime</div><div class="line"></div><div class="line"><span class="comment">#显示用户登录列表</span></div><div class="line">last</div><div class="line"><span class="comment">#获取某个用户登录信息</span></div><div class="line">last zhang</div><div class="line"><span class="comment">#获取重启会话信息</span></div><div class="line">last reboot</div><div class="line"></div><div class="line"><span class="comment">#获取失败的用户登录信息</span></div><div class="line">lastb</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="打印10条最常使用的命令"><a href="#打印10条最常使用的命令" class="headerlink" title="打印10条最常使用的命令"></a>打印10条最常使用的命令</h2><p>终端是用来访问shell的工具，在shell中我们可以输入并执行命令。我们可以找出在shell中运行最多的命令。</p>
<p>~/.bash_history，默认保留1000个最近执行命令。或者<code>history</code>命令。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat .bash_history | sort -n | uniq -c | sorn -nr | head</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="列出占用CPU最多的进程"><a href="#列出占用CPU最多的进程" class="headerlink" title="列出占用CPU最多的进程"></a>列出占用CPU最多的进程</h2><p>CPU时间是一项重要资源，有时需要跟踪占用CPU周期最多的进程。<br>对于需要处理大量请求的服务器来说，CPU是极其重要的资源。通过监视某个时期内CPU的使用情况，可以找出长期占用CPU的进程并对其进行优化，或是调试其他问题。</p>
<p>用<code>ps</code>命令收集系统中进程的详细信息。<br>ps - report a snapshot of the current processes</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#-e,以标准语法显示每个进程</span></div><div class="line">ps -e</div><div class="line">ps -ef</div><div class="line"></div><div class="line"><span class="comment">#ax,以BSD语法显示每个进程</span></div><div class="line">ps ax</div><div class="line">pa axu</div><div class="line"></div><div class="line"><span class="comment">#获取安全信息</span></div><div class="line"><span class="comment">#ps -eo euser,ruser,suser,fuser,f,comm,pcpu,label</span></div><div class="line"></div><div class="line"><span class="comment">#comm显示命令，pcpu显示CPU使用率</span></div><div class="line">ps -eo comm,pcpu</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#监视并计算一小时内CPU使用情况的shell脚本</span></div><div class="line">secs=3600</div><div class="line">unit_time=60</div><div class="line">steps=$((<span class="variable">$secs</span> / <span class="variable">$unit_time</span>))</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"Whatching CPU usage..."</span></div><div class="line"></div><div class="line"><span class="keyword">for</span>((i=0; i&lt;steps; i++))</div><div class="line"><span class="keyword">do</span></div><div class="line">	ps -eo comm,pcpu | tail -n +2 &gt;&gt; /tmp/cpu_usage.$$</div><div class="line">    sleep <span class="variable">$unit_time</span></div><div class="line"><span class="keyword">done</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"CPU eaters: "</span></div><div class="line"></div><div class="line">cat /tmp/cpu_usage.$$ | \</div><div class="line">awk <span class="string">'&#123;process[$1]+=$2&#125;</span></div><div class="line"><span class="string">END&#123;</span></div><div class="line"><span class="string">	for (i in process) &#123;</span></div><div class="line"><span class="string">    	printf("%-20s %s",i,process[i]);</span></div><div class="line"><span class="string">    &#125;</span></div><div class="line"><span class="string">&#125;'</span> | sort -nrk 2 | head</div><div class="line"></div><div class="line"><span class="comment">#tail -n +K，从第K行开始输出。上面输出第一行是 COMAND 和 %CPU</span></div><div class="line"></div><div class="line"><span class="comment">#$1,command; $2,%CPU</span></div><div class="line"><span class="comment">#process[$1]是一个关联函数，相当于arr[command]</span></div><div class="line"><span class="comment">#arr[command]=arr[command]+ $2，计算同一命令的累积时间</span></div><div class="line"><span class="comment">#i指命令，process[i]指命令运行时间</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="用watch监视命令输出"><a href="#用watch监视命令输出" class="headerlink" title="用watch监视命令输出"></a>用watch监视命令输出</h2><p>可能需要在在某段时期内以固定的间隔时间不短监视某个命令的输出。可利用<code>watch</code>命令。</p>
<p>watch - execute a program periodically, showing output fullscreen</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#watch命令可以用来在终端以固定的间隔监视命令输出，默认2秒间隔</span></div><div class="line">watch <span class="built_in">command</span></div><div class="line">watch <span class="string">'command'</span></div><div class="line"></div><div class="line">watch ls</div><div class="line">watch <span class="string">'ls -l'</span></div><div class="line"></div><div class="line"><span class="comment">#-n,指定时间间隔</span></div><div class="line">watch -n 5 <span class="string">'yum update -y'</span></div><div class="line"></div><div class="line"><span class="comment">#-d，突出(highlighting)watch输出中的差异</span></div><div class="line">watch -d -n 1<span class="string">'dd if=/dev/zero of=/tmp/zero.test'</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="对文件及目录访问进行记录"><a href="#对文件及目录访问进行记录" class="headerlink" title="对文件及目录访问进行记录"></a>对文件及目录访问进行记录</h2><p>记录重要文件及目录访问，对于追踪文件和目录的变化很有帮助。<br><code>inotifywait</code>命令可以用来收集有关文件访问的信息。<br><code>inotifywait</code>和<code>rsync</code>用户实时同步哦！</p>
<p>inotifywait - wait for changes to files using inotify</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">yum install -y inotify-tools</div><div class="line"></div><div class="line"><span class="comment">#-q,减少冗余信息</span></div><div class="line">inotifywait -m -r -q -e create,move,delete /dir</div><div class="line">inotifywait -m -r -q -e create,move,modify,delete /home/zhang &gt;&gt; inotifywait.log</div><div class="line"></div><div class="line"><span class="comment">#利用inotifywait检测，rsync同步</span></div><div class="line">inotifywait -mrq -e create,move,modify,delete /dir --exclude=<span class="string">"*.swap"</span> | <span class="keyword">while</span> <span class="built_in">read</span> file</div><div class="line"><span class="keyword">do</span></div><div class="line">rsync -av --exclude=<span class="string">"*.swqp"</span> --delete /dir user@host:PATH &gt; /dev/null 2&gt;&amp;1</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="用logrotate管理日志文件"><a href="#用logrotate管理日志文件" class="headerlink" title="用logrotate管理日志文件"></a>用logrotate管理日志文件</h2><p>日志文件是Linux系统维护中必不可少的组成部分。日志文件可以帮助跟踪系统中多种服务所发生的事件，这有助于排除系统问题。<br>但随着时间推移，日志文件会变得越来越大。因而必须对日志文件进行管理。</p>
<p>我们可以利用一种称为“轮询(rotation)”的技术来限制日志文件的体积。一旦日志文件超过了限定大小，就要对它的内容进行抽取(strip)，同时将日志文件的旧条目归档到文件中。</p>
<p><code>logratate</code>是每一位Linux系统管理员都应该了解的命令。它能够将日志文件大大小限制在给定的SIZE内。<br>logrotate配置文件位于<code>/etc/logrotate.d</code></p>
<p>logrotate ‐ rotates, compresses, and mails system logs</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">vim /etc/logrotated.d/custom</div><div class="line"></div><div class="line">/var/<span class="built_in">log</span>/custom.log &#123;</div><div class="line">	missingok	<span class="comment">#日志文件丢失，则忽略</span></div><div class="line">    notifempty	<span class="comment">#仅当源日志文件非空时才进行轮替</span></div><div class="line">    size 30k	<span class="comment">#限制实施轮替的日志文件大小</span></div><div class="line">    compress	<span class="comment">#压缩旧日志</span></div><div class="line">    weekly	<span class="comment">#轮询时间，daily,weekly,yearly</span></div><div class="line">    rotate 7	<span class="comment">#保留旧日志数量</span></div><div class="line">    create 0600 root root	<span class="comment">#创建的日志文件模式，用户和用户组</span></div><div class="line"><span class="comment">#还有一些其他选项</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="用sys记录日志"><a href="#用sys记录日志" class="headerlink" title="用sys记录日志"></a>用sys记录日志</h2><p>在Linux系统中，在/var/log中创建并写入日志信息的是由被称为syslog的协议处理的。它由守护进程syslogd负责执行。<br>每一个标准应用进程都可以用syslog记录日志信息。</p>
<p>syslog处理/var/log下的多个日志文件。但是当logger发送消息时，它用标记字符串来确定应该纪录到哪一个日志文件中。<br>syslogd使用与日志相关联的TAG来决定应该将其记录到哪一个文件中。<br>可以从<code>/etc/rsyslog.d/</code>目录的配置文件中看到与日志文件相关联的标记字符串。</p>
<p>Linux中一些重要日志文件：</p>
<blockquote>
<p>/var/log/boot.log， 系统启动信息；<br>/var/log/message， 内核启动信息；<br>/var/log/auth.log， 用户认证日志；<br>/var/log/dmesg， 系统启动信息；<br>/var/log/mail.log， 邮件服务器日志。</p>
</blockquote>
<p>logger - a shell command interface to the syslog</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#logger命令，默认记录日志信息到/var/log/messages</span></div><div class="line">logger <span class="string">"test log message to messages"</span></div><div class="line">tail -n 1 /var/<span class="built_in">log</span>/message</div><div class="line"></div><div class="line"><span class="comment">#-t，指定特定TAG</span></div><div class="line">logger -t TAG <span class="string">"test log message to messages"</span></div></pre></td></tr></table></figure>
<p><br><br><br></p>
<h1 id="管理重任"><a href="#管理重任" class="headerlink" title="管理重任"></a>管理重任</h1><h2 id="简介-6"><a href="#简介-6" class="headerlink" title="简介"></a>简介</h2><p>GNU/Linux的生态系统是由运行的程序、服务、连接的设备、文件系统、用户等组成。按照我们需要的方式对整个系统有一个微观并对操作系统进行整体上的管理，这就是系统管理的主要目的。</p>
<h2 id="收集进程信息"><a href="#收集进程信息" class="headerlink" title="收集进程信息"></a>收集进程信息</h2><p>进程是程序运行实例(runing instance)。<br>同一程序的多个实例可以同时运行，但他们的进程ID却互不相同。</p>
<p>进程管理相关的重要命令是：</p>
<ul>
<li><code>top</code>, display Linux processes;</li>
<li><code>ps</code>, report a snapshot of the current processes;</li>
<li><code>pgrep</code>, look up or signal processes based on name and other attributes.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#ps命令</span></div><div class="line"><span class="comment">#-f, 显示更多进程信息</span></div><div class="line">ps -f</div><div class="line"></div><div class="line"><span class="comment">#-e,every; -a,all</span></div><div class="line">ps -ef</div><div class="line">ps -ax</div><div class="line"></div><div class="line"><span class="comment">#-o, 指定想要的列</span></div><div class="line">ps -e -o parameter1,parameter2...</div><div class="line">ps -eo comm,pcpu,pmem</div><div class="line"></div><div class="line"><span class="comment">#pccpu	CPU占用率</span></div><div class="line"><span class="comment">#pid	进程ID</span></div><div class="line"><span class="comment">#ppid	父进程ID</span></div><div class="line"><span class="comment">#pmem	内存使用率</span></div><div class="line"><span class="comment">#comm	命令名</span></div><div class="line"><span class="comment">#cmd	简单命令</span></div><div class="line"><span class="comment">#user	启动进程的用户</span></div><div class="line"><span class="comment">#nice	优先级</span></div><div class="line"><span class="comment">#time	累积的CPU时间</span></div><div class="line"><span class="comment">#etime	进程启动后度过的时间</span></div><div class="line"><span class="comment">#tty	所关联的TTY设备</span></div><div class="line"><span class="comment">#euid	有效用户ID</span></div><div class="line"><span class="comment">#stat	进程状态</span></div><div class="line"></div><div class="line"><span class="comment">#--sort,根据参数对ps输出进行排序</span></div><div class="line"><span class="comment">#+升序，-降序</span></div><div class="line">ps -eo comm,pcpu,pmem --sort -pcpu</div><div class="line">ps -eo comm,pcpu,pmem --sort -pcpu,+pmem</div><div class="line"></div><div class="line"><span class="comment">#-C, 给定命令全名找出PID</span></div><div class="line">ps -C cmd -o comm,pid</div><div class="line"></div><div class="line"><span class="comment">#-u, 指定有效用户列表</span></div><div class="line"><span class="comment">#-U, 指定真实用户列表</span></div><div class="line">ps -u root -U zhang -o user,pcpu</div><div class="line"></div><div class="line"><span class="comment">#-t, 用TTY过滤输出</span></div><div class="line">ps -t TTY1,TTY2...</div><div class="line">ps -t pts/0,pts/1 -ef</div><div class="line"></div><div class="line"><span class="comment">#-L, 显示进程相关信息</span></div><div class="line"><span class="comment">#LWP线程ID， NLWP线程数量</span></div><div class="line">ps -efL</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#pgrep命令, 获得一个特定命令的PID列表</span></div><div class="line"><span class="comment">#它只需要命令的一部分即可</span></div><div class="line">pgrep cmd</div><div class="line">pgre inotif</div><div class="line">pgrep bas</div><div class="line"></div><div class="line"><span class="comment">#-d, 指定定界符</span></div><div class="line">pgrep rsync -d <span class="string">":"</span></div><div class="line"></div><div class="line"><span class="comment">#-u, 指定进程的用户</span></div><div class="line">pgrep -u root,zhang rsync</div><div class="line"></div><div class="line"><span class="comment">#-c, 返回匹配的进程数量</span></div><div class="line">pgrep -c rsync</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#top命令</span></div><div class="line">top</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="杀死进程以及发送响应信息"><a href="#杀死进程以及发送响应信息" class="headerlink" title="杀死进程以及发送响应信息"></a>杀死进程以及发送响应信息</h2><p>在Unix-Like环境中与进程有关的一个重要概念就是信号。<br>信号是一种进程间通信机制，它用来中断运行的进程以执行某些操作。终止程序也是通过使用信号技术来实现的。</p>
<p>像<code>ctrl+C</code>,<code>ctrl+Z</code>这种作业都属于信号。</p>
<ul>
<li><code>kill</code> 命令可用来向进程发送信号;</li>
<li><code>trap</code> 命令用来处理所接收的信号;</li>
<li><code>killall</code> 以名字方式来杀死进程.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#列出所有可用信号</span></div><div class="line"><span class="built_in">kill</span> -l</div><div class="line"></div><div class="line"><span class="comment">#-s, 发送信号</span></div><div class="line"><span class="comment">#信号名称和信号数都可以</span></div><div class="line"><span class="built_in">kill</span> -信号数 PID</div><div class="line"><span class="built_in">kill</span> -s SIGNAL PID</div><div class="line"></div><div class="line"><span class="comment">#常用信号</span></div><div class="line"><span class="comment">#SIGHUP 1 --对控制进程或终端进行挂起检测(hangup detection);</span></div><div class="line"><span class="comment">#SIGINT 2 --当按下ctrl+c时发送该信号;</span></div><div class="line"><span class="comment">#SIGKILL 9 --强行杀死进程;</span></div><div class="line"><span class="comment">#SIGTERM 15 --终止进程;</span></div><div class="line"><span class="comment">#SIGTSTP 20 --当按下crtl+z时发送该信号.</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#killall, 通过命令名终止进程</span></div><div class="line">killall -s SIGNAL PName</div><div class="line">killall -信号数 PName</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#trap, 捕捉并响应信号</span></div><div class="line"><span class="built_in">trap</span> <span class="string">'signal-handler-func'</span> SIGNAL LIST</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="which-whereis-file-whatis与平均负载"><a href="#which-whereis-file-whatis与平均负载" class="headerlink" title="which, whereis, file, whatis与平均负载"></a>which, whereis, file, whatis与平均负载</h2><p><code>which</code> hows the full path of (shell) commands。找出某个命令的位置;<br><code>whereis</code> locate the binary, source, and manual page files for a command。不仅返回命令路径，还能打印命令手册的位置以及命令源代码路径;<br><code>file</code> determine file type。用来确定文件类型;<br><code>whatis</code> display manual page descriptions。输出简短描述信息;<br>平均负载(load average),是系统运行总负载量的一个重要参数。它指明了系统中可运行进程总量的平均值。平均负载由三个值来指定，第一个指明1分钟内的平均值，第二个指明5分钟内的平均值，第三个指明15分钟内的平均值。</p>
<ul>
<li>单核CPU，类似于单车道，负载在 0.00-1.00 之间正常；</li>
<li>多核CPU，类似于多车道，负载在 核数*(0.00-1.00) 之间正常；</li>
<li>安全的系统负载，单核应该在 0.7 以下；</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#查看平均负载</span></div><div class="line">uptime</div><div class="line">cat /proc/loadavg</div><div class="line"><span class="comment">#0.00 0.01 0.05 1/355 44955</span></div><div class="line"><span class="comment">#分母355表示系统进程总数, 分子表示正在运行的进程数, 最后一个数字表示最近运行进程ID</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="向用户终端发送消息"><a href="#向用户终端发送消息" class="headerlink" title="向用户终端发送消息"></a>向用户终端发送消息</h2><p>系统管理员可能需要向网络中所有主机上的所有用户或特定用户的终端发送消息。<br>`wallrsync -av –exclude=”*.s命令用来向所有当前登录用户的终端写入消息。</p>
<p>在Linux系统中，终端是作为设备存在的。因此那些打开的终端在<code>dev/pts/</code>中都会与对应的设备节点文件。向特定设备写入数据将会在对应的终端显示出消息。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">"It's just a test"</span> | wall</div><div class="line"></div><div class="line"><span class="comment">#查看用户对应的/dev/pts/, 并向某一个用户终端发送信息</span></div><div class="line">ll /dev/pts | awk <span class="string">'&#123;print $3,$6&#125;'</span></div><div class="line"><span class="built_in">echo</span><span class="string">"Haha"</span> &gt; /dev/pts/[1,2,3...]</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="收集系统信息"><a href="#收集系统信息" class="headerlink" title="收集系统信息"></a>收集系统信息</h2><p>包括主机名、内核版本、Linux发行版本、CPU信息、内存信息、磁盘分区信息等。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#主机名</span></div><div class="line">hostname</div><div class="line">uname -n</div><div class="line"></div><div class="line"><span class="comment">#内核版本，架构</span></div><div class="line">uname -r</div><div class="line">uname -m</div><div class="line">uname -a</div><div class="line"></div><div class="line"><span class="comment">#Linux发行版本</span></div><div class="line">cat /etc/redhat-release</div><div class="line"></div><div class="line"><span class="comment">#CPU相关信息</span></div><div class="line">lscpu</div><div class="line">cat /proc/cpuinfo</div><div class="line">cat /proc/cpuinfo | grep <span class="string">'model name'</span></div><div class="line"></div><div class="line"><span class="comment">#内存详细信息</span></div><div class="line">free -h</div><div class="line">cat /proc/meminfo</div><div class="line"></div><div class="line"><span class="comment">#分区信息</span></div><div class="line">cat /proc/partitions</div><div class="line">fdisk -l</div><div class="line"></div><div class="line"><span class="comment">#系统详细信息</span></div><div class="line">lshw</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="用-proc收集信息"><a href="#用-proc收集信息" class="headerlink" title="用/proc收集信息"></a>用/proc收集信息</h2><p>在GNU/Linux操作系统中，/proc是一个位于内存中的伪文件系统(in-memory pseudo filesystem)。<br>它的引用是为了提供一个可以从用户空间(user space)读取系统参数的接口。</p>
<p>可以对<code>/proc</code>中的文件和子目录进行<code>cat</code>来获取信息，所有内容都是易读的格式化文本。</p>
<blockquote>
<p>/proc/下的数字目录，包含了对应进程的相关信息；<br>/proc/environ，包含于进程相关联的环境变量；<br>/proc/cwd，是一个到进程工作目录的符号链接；<br>/proc/fbcat，包含了由进程所使用的文件描述符。</p>
</blockquote>
<p><br></p>
<h2 id="用cron进行调度"><a href="#用cron进行调度" class="headerlink" title="用cron进行调度"></a>用cron进行调度</h2><p>GNU/Linux系统包含了各种用于调度任务的工具。cron就是其中之一，它通过守护进程crond使得任务能够以固定的时间间隔在系统后台自动运行。<br>cron利用的是一个被称为“cron表(cron table)”的文件，这个文件中存储了需要执行的脚本或命令的调度列表以及执行时间。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">crontab -e</div><div class="line"><span class="comment">#* * * * * cmd</span></div><div class="line"><span class="comment">#分钟(0-59)</span></div><div class="line"><span class="comment">#小时(0-23)</span></div><div class="line"><span class="comment">#天(1-31)</span></div><div class="line"><span class="comment">#月(1-12)</span></div><div class="line"><span class="comment">#工作日(0-7)，0和7都代表周天</span></div><div class="line"><span class="comment">#命令</span></div><div class="line"></div><div class="line"><span class="comment">#*号,所有值</span></div><div class="line"><span class="comment">#,号,范围。1,3,5,7,9</span></div><div class="line"><span class="comment">#-号,连续范文。1-10</span></div><div class="line"><span class="comment">#/号,*/10;0-8/20</span></div><div class="line"></div><div class="line"><span class="comment">#栗子</span></div><div class="line">* 0-6 * * * /home/zhang/test.sh</div><div class="line">1,3,5,7,9 * * * * /home/zhang/test.sh</div><div class="line">*/5 * * * * /home/zhang/test.sh</div><div class="line"></div><div class="line"><span class="comment">#-l,查看cron表</span></div><div class="line">crontab -l</div><div class="line"></div><div class="line"><span class="comment">#-r,移除cron表</span></div><div class="line">crontab -r</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="用户管理常用命令"><a href="#用户管理常用命令" class="headerlink" title="用户管理常用命令"></a>用户管理常用命令</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#添加用户</span></div><div class="line">userall</div><div class="line"></div><div class="line"><span class="comment">#删除用户</span></div><div class="line">userdel</div><div class="line">--remove-all-file删除与用户相关的所有文件</div><div class="line"></div><div class="line"><span class="comment">#修改shell</span></div><div class="line">chsh</div><div class="line"></div><div class="line"><span class="comment">#修改用户属性</span></div><div class="line">usermod</div><div class="line"></div><div class="line"><span class="comment">#修改密码过期时间</span></div><div class="line">chage</div><div class="line"></div><div class="line"><span class="comment">#修改密码</span></div><div class="line">passwd</div><div class="line"></div><div class="line"><span class="comment">#登录到一个新组</span></div><div class="line">newgrp</div><div class="line"></div><div class="line"><span class="comment">#添加、删除组</span></div><div class="line">groupadd</div><div class="line">groupdel</div><div class="line"></div><div class="line"><span class="comment">#指纹</span></div><div class="line">finger</div></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/09/13/song/" rel="next" title="歌词摘抄">
                <i class="fa fa-chevron-left"></i> 歌词摘抄
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/11/06/Love-at-First-Sight/" rel="prev" title="Love at First Sight">
                Love at First Sight <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/images/touxiang.jpg"
              alt="Zhang21" />
          
            <p class="site-author-name" itemprop="name">Zhang21</p>
            <p class="site-description motion-element" itemprop="description">踏踏实实谋发展</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/f13278e94ecb" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-circle-o"></i>简书</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/Zhang21" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:elite_zhang21@163.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://instagram.com/Zhang21_" target="_blank" title="Instagram">
                  
                    <i class="fa fa-fw fa-instagram"></i>Instagram</a>
              </span>
            
          
        </div>

        
        

        
        
<br>
<!--�����������������ⲿ����,auto=1��ʾ�Զ�����-->
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=411315632&auto=0&height=66"></iframe>


        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#小试牛刀"><span class="nav-number">1.</span> <span class="nav-text">小试牛刀</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">1.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#终端打印"><span class="nav-number">1.2.</span> <span class="nav-text">终端打印</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#玩转变量和环境变量"><span class="nav-number">1.3.</span> <span class="nav-text">玩转变量和环境变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通过shell进行数学运算"><span class="nav-number">1.4.</span> <span class="nav-text">通过shell进行数学运算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文件描述符重定向"><span class="nav-number">1.5.</span> <span class="nav-text">文件描述符重定向</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数组和关联数组"><span class="nav-number">1.6.</span> <span class="nav-text">数组和关联数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#别名"><span class="nav-number">1.7.</span> <span class="nav-text">别名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取、设置日期和延时"><span class="nav-number">1.8.</span> <span class="nav-text">获取、设置日期和延时</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#调试脚本"><span class="nav-number">1.9.</span> <span class="nav-text">调试脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#函数和参数"><span class="nav-number">1.10.</span> <span class="nav-text">函数和参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#读取命令序列输出"><span class="nav-number">1.11.</span> <span class="nav-text">读取命令序列输出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#读取字符"><span class="nav-number">1.12.</span> <span class="nav-text">读取字符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字段分隔符和迭代器"><span class="nav-number">1.13.</span> <span class="nav-text">字段分隔符和迭代器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#比较与测试"><span class="nav-number">1.14.</span> <span class="nav-text">比较与测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#命令之乐"><span class="nav-number">2.</span> <span class="nav-text">命令之乐</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介-1"><span class="nav-number">2.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用cat进行拼接"><span class="nav-number">2.2.</span> <span class="nav-text">用cat进行拼接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#录制与回放终端会话"><span class="nav-number">2.3.</span> <span class="nav-text">录制与回放终端会话</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文件查找与文件列表"><span class="nav-number">2.4.</span> <span class="nav-text">文件查找与文件列表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#玩转xargs"><span class="nav-number">2.5.</span> <span class="nav-text">玩转xargs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用tr进行转换"><span class="nav-number">2.6.</span> <span class="nav-text">用tr进行转换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#校验和-与-核实文件完整性"><span class="nav-number">2.7.</span> <span class="nav-text">校验和 与 核实文件完整性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#排序、单一、重复"><span class="nav-number">2.8.</span> <span class="nav-text">排序、单一、重复</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#临时文件命名、随机数"><span class="nav-number">2.9.</span> <span class="nav-text">临时文件命名、随机数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分割文件和数据"><span class="nav-number">2.10.</span> <span class="nav-text">分割文件和数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#根据扩展名切分文件名"><span class="nav-number">2.11.</span> <span class="nav-text">根据扩展名切分文件名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#批量重命名和移动"><span class="nav-number">2.12.</span> <span class="nav-text">批量重命名和移动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#拼写检查与词典操作"><span class="nav-number">2.13.</span> <span class="nav-text">拼写检查与词典操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#交互输入自动化"><span class="nav-number">2.14.</span> <span class="nav-text">交互输入自动化</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#以文件之名"><span class="nav-number">3.</span> <span class="nav-text">以文件之名</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介-2"><span class="nav-number">3.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#生成任意大小的文件"><span class="nav-number">3.2.</span> <span class="nav-text">生成任意大小的文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文本文件的交集与差集"><span class="nav-number">3.3.</span> <span class="nav-text">文本文件的交集与差集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查找并删除重复文件"><span class="nav-number">3.4.</span> <span class="nav-text">查找并删除重复文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建长路径目录"><span class="nav-number">3.5.</span> <span class="nav-text">创建长路径目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文件权限、所有权和粘滞位"><span class="nav-number">3.6.</span> <span class="nav-text">文件权限、所有权和粘滞位</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建不可修改文件"><span class="nav-number">3.7.</span> <span class="nav-text">创建不可修改文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#批量生成空白文件"><span class="nav-number">3.8.</span> <span class="nav-text">批量生成空白文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查找符号链接及其指向目标"><span class="nav-number">3.9.</span> <span class="nav-text">查找符号链接及其指向目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#列举文件类型统计信息"><span class="nav-number">3.10.</span> <span class="nav-text">列举文件类型统计信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#环回文件与挂载"><span class="nav-number">3.11.</span> <span class="nav-text">环回文件与挂载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#生成ISO文件以及混合ISO"><span class="nav-number">3.12.</span> <span class="nav-text">生成ISO文件以及混合ISO</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查找文件差异并进行修补"><span class="nav-number">3.13.</span> <span class="nav-text">查找文件差异并进行修补</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#head与tail"><span class="nav-number">3.14.</span> <span class="nav-text">head与tail</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#只列出目录的其他方法"><span class="nav-number">3.15.</span> <span class="nav-text">只列出目录的其他方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pushd和popd"><span class="nav-number">3.16.</span> <span class="nav-text">pushd和popd</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#统计文件的行数、单词数、字符数"><span class="nav-number">3.17.</span> <span class="nav-text">统计文件的行数、单词数、字符数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#目录树"><span class="nav-number">3.18.</span> <span class="nav-text">目录树</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#让文本飞"><span class="nav-number">4.</span> <span class="nav-text">让文本飞</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介-3"><span class="nav-number">4.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#正则表达式"><span class="nav-number">4.2.</span> <span class="nav-text">正则表达式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用grep在文件中搜索文本"><span class="nav-number">4.3.</span> <span class="nav-text">用grep在文件中搜索文本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用cut按列切分文件"><span class="nav-number">4.4.</span> <span class="nav-text">用cut按列切分文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#统计特定文件词频"><span class="nav-number">4.5.</span> <span class="nav-text">统计特定文件词频</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sed入门"><span class="nav-number">4.6.</span> <span class="nav-text">sed入门</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#awk入门"><span class="nav-number">4.7.</span> <span class="nav-text">awk入门</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#对文件中的行、单词、字符进行迭代"><span class="nav-number">4.8.</span> <span class="nav-text">对文件中的行、单词、字符进行迭代</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#按列合并文件"><span class="nav-number">4.9.</span> <span class="nav-text">按列合并文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打印文件或行中的第n个单词或n列"><span class="nav-number">4.10.</span> <span class="nav-text">打印文件或行中的第n个单词或n列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打印不同行或样式之间的文本"><span class="nav-number">4.11.</span> <span class="nav-text">打印不同行或样式之间的文本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#以逆序形式打印行"><span class="nav-number">4.12.</span> <span class="nav-text">以逆序形式打印行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解析文本中的电子邮件和URL"><span class="nav-number">4.13.</span> <span class="nav-text">解析文本中的电子邮件和URL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打印某个样式之前-之后n行"><span class="nav-number">4.14.</span> <span class="nav-text">打印某个样式之前/之后n行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在文件中移除包含某个单词的句子"><span class="nav-number">4.15.</span> <span class="nav-text">在文件中移除包含某个单词的句子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文本切片与参数操作"><span class="nav-number">4.16.</span> <span class="nav-text">文本切片与参数操作</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#一团乱麻？没这回事"><span class="nav-number">5.</span> <span class="nav-text">一团乱麻？没这回事</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#入门"><span class="nav-number">5.1.</span> <span class="nav-text">入门</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网站下载"><span class="nav-number">5.2.</span> <span class="nav-text">网站下载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#以格式化纯文本下载网页"><span class="nav-number">5.3.</span> <span class="nav-text">以格式化纯文本下载网页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cURL入门"><span class="nav-number">5.4.</span> <span class="nav-text">cURL入门</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#从命令行访问163邮箱"><span class="nav-number">5.5.</span> <span class="nav-text">从命令行访问163邮箱</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#制作图片抓取器及下载工具"><span class="nav-number">5.6.</span> <span class="nav-text">制作图片抓取器及下载工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查找网站中的无效链接"><span class="nav-number">5.7.</span> <span class="nav-text">查找网站中的无效链接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#跟踪网站变更"><span class="nav-number">5.8.</span> <span class="nav-text">跟踪网站变更</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#以POST方式发送网页并读取响应"><span class="nav-number">5.9.</span> <span class="nav-text">以POST方式发送网页并读取响应</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Plan-B"><span class="nav-number">6.</span> <span class="nav-text">Plan B</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介-4"><span class="nav-number">6.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用tar归档"><span class="nav-number">6.2.</span> <span class="nav-text">用tar归档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用cpio归档"><span class="nav-number">6.3.</span> <span class="nav-text">用cpio归档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用gunzip或gzip压缩"><span class="nav-number">6.4.</span> <span class="nav-text">用gunzip或gzip压缩</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用bunzip或bzip压缩"><span class="nav-number">6.5.</span> <span class="nav-text">用bunzip或bzip压缩</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lzma压缩"><span class="nav-number">6.6.</span> <span class="nav-text">lzma压缩</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zip归档和压缩"><span class="nav-number">6.7.</span> <span class="nav-text">zip归档和压缩</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#超高压缩率的squashfs文件系统"><span class="nav-number">6.8.</span> <span class="nav-text">超高压缩率的squashfs文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#加密工具与散列"><span class="nav-number">6.9.</span> <span class="nav-text">加密工具与散列</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ccypt"><span class="nav-number">6.9.1.</span> <span class="nav-text">ccypt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gpg"><span class="nav-number">6.9.2.</span> <span class="nav-text">gpg</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#base64"><span class="nav-number">6.9.3.</span> <span class="nav-text">base64</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#md5sum与sha1sum"><span class="nav-number">6.9.4.</span> <span class="nav-text">md5sum与sha1sum</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shadowlike散列-salted散列"><span class="nav-number">6.9.5.</span> <span class="nav-text">shadowlike散列(salted散列)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用rsync备份系统"><span class="nav-number">6.10.</span> <span class="nav-text">用rsync备份系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用Git备份版本控制"><span class="nav-number">6.11.</span> <span class="nav-text">用Git备份版本控制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用dd克隆磁盘"><span class="nav-number">6.12.</span> <span class="nav-text">用dd克隆磁盘</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#无网不利"><span class="nav-number">7.</span> <span class="nav-text">无网不利</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#j简介"><span class="nav-number">7.1.</span> <span class="nav-text">j简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ping"><span class="nav-number">7.2.</span> <span class="nav-text">ping</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#列出网络上所有活动主机"><span class="nav-number">7.3.</span> <span class="nav-text">列出网络上所有活动主机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#传输文件"><span class="nav-number">7.4.</span> <span class="nav-text">传输文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSH无秘钥认证"><span class="nav-number">7.5.</span> <span class="nav-text">SSH无秘钥认证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用SSH在远程主机上运行命令"><span class="nav-number">7.6.</span> <span class="nav-text">用SSH在远程主机上运行命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在本地挂载远程驱动器"><span class="nav-number">7.7.</span> <span class="nav-text">在本地挂载远程驱动器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网络流量和端口分析"><span class="nav-number">7.8.</span> <span class="nav-text">网络流量和端口分析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#当个好管家"><span class="nav-number">8.</span> <span class="nav-text">当个好管家</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介-5"><span class="nav-number">8.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#统计磁盘使用情况"><span class="nav-number">8.2.</span> <span class="nav-text">统计磁盘使用情况</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#计算命令执行时间"><span class="nav-number">8.3.</span> <span class="nav-text">计算命令执行时间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#当前登录用户、启动日志、启动故障的相关信息"><span class="nav-number">8.4.</span> <span class="nav-text">当前登录用户、启动日志、启动故障的相关信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打印10条最常使用的命令"><span class="nav-number">8.5.</span> <span class="nav-text">打印10条最常使用的命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#列出占用CPU最多的进程"><span class="nav-number">8.6.</span> <span class="nav-text">列出占用CPU最多的进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用watch监视命令输出"><span class="nav-number">8.7.</span> <span class="nav-text">用watch监视命令输出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#对文件及目录访问进行记录"><span class="nav-number">8.8.</span> <span class="nav-text">对文件及目录访问进行记录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用logrotate管理日志文件"><span class="nav-number">8.9.</span> <span class="nav-text">用logrotate管理日志文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用sys记录日志"><span class="nav-number">8.10.</span> <span class="nav-text">用sys记录日志</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#管理重任"><span class="nav-number">9.</span> <span class="nav-text">管理重任</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介-6"><span class="nav-number">9.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#收集进程信息"><span class="nav-number">9.2.</span> <span class="nav-text">收集进程信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#杀死进程以及发送响应信息"><span class="nav-number">9.3.</span> <span class="nav-text">杀死进程以及发送响应信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#which-whereis-file-whatis与平均负载"><span class="nav-number">9.4.</span> <span class="nav-text">which, whereis, file, whatis与平均负载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#向用户终端发送消息"><span class="nav-number">9.5.</span> <span class="nav-text">向用户终端发送消息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#收集系统信息"><span class="nav-number">9.6.</span> <span class="nav-text">收集系统信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用-proc收集信息"><span class="nav-number">9.7.</span> <span class="nav-text">用/proc收集信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用cron进行调度"><span class="nav-number">9.8.</span> <span class="nav-text">用cron进行调度</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用户管理常用命令"><span class="nav-number">9.9.</span> <span class="nav-text">用户管理常用命令</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhang21</span>

<!--字数统计-->
  <div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count"> 字数: 56.3k</span>
</div>


  
</div>



<!--

  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.2</div>

-->


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  

    
      <script id="dsq-count-scr" src="https://Zhang21.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://zhang21.github.io/2017/10/24/LinuxShell脚本攻略/';
          this.page.identifier = '2017/10/24/LinuxShell脚本攻略/';
          this.page.title = 'LinuxShell脚本攻略';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://Zhang21.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->





  

  

  

  
  


  

  

</body>
</html>
