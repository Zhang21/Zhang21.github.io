<!DOCTYPE html>




<html class="theme-next muse" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Zabbix," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="参考： Zabbix官方网站Zabbix中文文档Zabbix-repo仓库: http://repo.zabbix.com , 阿里云镜像: https://mirrors.aliyun.com/zabbix/zabbix/ . 环境： CentOS7x86_64, Zabbix 3.4。">
<meta name="keywords" content="Zabbix">
<meta property="og:type" content="article">
<meta property="og:title" content="Zabbix">
<meta property="og:url" content="https://zhang21.github.io/2017/11/14/Zabbix/index.html">
<meta property="og:site_name" content="风继续吹">
<meta property="og:description" content="参考： Zabbix官方网站Zabbix中文文档Zabbix-repo仓库: http://repo.zabbix.com , 阿里云镜像: https://mirrors.aliyun.com/zabbix/zabbix/ . 环境： CentOS7x86_64, Zabbix 3.4。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://zhang21.github.io/images/zabbix_database.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix_conf.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix_me.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/dashboard.jpg">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix_menu.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix-agent.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/user.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/Useifseverity.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/host.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/create-item.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/upload.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/create-trigger.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/create-email.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/create-action.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/create-template.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/mass-update.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/remotecommand.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/MACRO.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/mysql01.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/mysql02.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/mysql03.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix_master.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix_mongodb1.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix_mongodb2.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix_mongodb3.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix_web_import_mongodb1.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix_web_import_mongodb2.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix_web_import_mongodb3.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix_web_import_mongodb4.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix_web_import_mongodb5.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/mongodb_27018.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/mongodb_27018_02.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/mongodb_27018_03.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/mongodb_27018_04.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/mongodb_27018_05.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/mongodb_27018_06.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix-master_php-fpm.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/zabbix-master_php-fpm2.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/nginx_status.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/custom_memorypercent.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/custom_memorypercent2.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/custom_memorypercent3.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/custom_memorypercent4.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/custom_memorypercent5.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/custom_memorypercent6.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/custom_disk1.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/custom_disk2.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/custom_disk3.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/custom_disk4.png">
<meta property="og:image" content="https://zhang21.github.io/images/MongoDB/checkmongod.png">
<meta property="og:image" content="https://zhang21.github.io/images/MongoDB/checkmongod2.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/jq01.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/jq02.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/jq03.jpg">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/userparameter.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/userparameter02.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/userparameter03.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/SDK.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/SDK02.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/SDK03.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/SDK04.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/SDK05.jpg">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/SDK06.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/SDK07.png">
<meta property="og:image" content="https://zhang21.github.io/images/Zabbix/action.png">
<meta property="og:updated_time" content="2018-02-24T11:03:55.440Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zabbix">
<meta name="twitter:description" content="参考： Zabbix官方网站Zabbix中文文档Zabbix-repo仓库: http://repo.zabbix.com , 阿里云镜像: https://mirrors.aliyun.com/zabbix/zabbix/ . 环境： CentOS7x86_64, Zabbix 3.4。">
<meta name="twitter:image" content="https://zhang21.github.io/images/zabbix_database.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.2',
    sidebar: {"position":"left","display":"hide","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://zhang21.github.io/2017/11/14/Zabbix/"/>





  <title>Zabbix | 风继续吹</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">风继续吹</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Yesterday, you said tomorrow!</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhang21.github.io/2017/11/14/Zabbix/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang21">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/leslie.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风继续吹">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Zabbix</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-14T10:18:09+08:00">
                2017-11-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/14/Zabbix/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/14/Zabbix/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  20,000
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>参考：</p>
<p><a href="https://www.zabbix.com/" target="_blank" rel="noopener">Zabbix官方网站</a><br><a href="https://www.zabbix.com/documentation/3.4/zh/manual/" target="_blank" rel="noopener">Zabbix中文文档</a><br>Zabbix-repo仓库: <a href="http://repo.zabbix.com" target="_blank" rel="noopener">http://repo.zabbix.com</a> , 阿里云镜像: <a href="https://mirrors.aliyun.com/zabbix/zabbix/" target="_blank" rel="noopener">https://mirrors.aliyun.com/zabbix/zabbix/</a> .</p>
<p>环境：</p>
<p>CentOS7x86_64, Zabbix 3.4。</p>
<p><br><br><br><br><a id="more"></a></p>
<hr>
<p><br></p>
<h1 id="Zabbix简介"><a href="#Zabbix简介" class="headerlink" title="Zabbix简介"></a>Zabbix简介</h1><p>Zabbix （音同 zæbix），是由 Alexei Vladishev 开发的一种网络监视、管理系统，基于 Server-Client 架构。Zabbix 的授权是属于 GPLv2。<br>Zabbix可用于监视各种网络服务、服务器和网络机器等状态。是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。<br>Zabbix也可经由SNMP、TCP、ICMP、SSH等对目标进行监视。</p>
<p><br></p>
<h2 id="Zabbix的系统构成"><a href="#Zabbix的系统构成" class="headerlink" title="Zabbix的系统构成"></a>Zabbix的系统构成</h2><p>Zabbix系统由以下各独立模块组成：</p>
<ul>
<li>Zabbix Server，服务端(以C开发)。Server端通过收集SNMP和Agent发送的数据，写入数据库，再通过PHP+Apache在Web端展示；</li>
<li>Zabbix Agent，客户端(基本支持所有操作系统)，并将监控主机数据发送给Server；</li>
<li>Zabbix Frontend，Web管理端(以PHP和JavaScript构成)；</li>
<li>Zabbix Proxy(可选组件)。用于分布式监控。</li>
</ul>
<p><br></p>
<h2 id="Zabbix的特点"><a href="#Zabbix的特点" class="headerlink" title="Zabbix的特点"></a>Zabbix的特点</h2><p>Zabbix是一个高度集成的网络监控解决方案，一个简单的安装包中提供多样性功能。</p>
<ul>
<li>数据收集；</li>
<li>灵活的阀值(触发器)定义；</li>
<li>高度可配置化的告警；</li>
<li>实现图表绘制；</li>
<li>Web监控功能；</li>
<li>丰富的可视化选项；</li>
<li>历史数据存储；</li>
<li>配置简单；</li>
<li>使用模板；</li>
<li>网络发现；</li>
<li>Zabbix API；</li>
<li>权限管理系统；</li>
<li>功能强大并易于扩展的监控代理。</li>
</ul>
<p><br><br><br></p>
<hr>
<h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p>Zabbix的常用术语含义。</p>
<p><strong>主机(host)：</strong></p>
<p>一台你想监控的网络设备，用IP或域名表示。主机名不能使用中文创建，会报错。</p>
<p><strong>主机组(host group):</strong><br>主机的逻辑组，它包含主机和模板。组名可以使用中文。</p>
<p><strong>监控项(item):</strong><br>你想要接收的主机的特定数据，一个度量数据。</p>
<p><strong>触发器(trigger):</strong><br>一个被用于定义问题阀值和评估监控项接收到的数据的逻辑表达式。</p>
<p><strong>事件(event):</strong><br>单次发生的需要注意的事情。</p>
<p><strong>异常(problem):</strong><br>一个处在异常状态的触发器。</p>
<p><strong>动作(action):</strong><br>一个对事件作出反应的预定义的操作。</p>
<p><strong>升级(escalation):</strong><br>一个在动作内执行操作的自定义场景。</p>
<p><strong>媒介(media):</strong><br>发送报警通知的手段。</p>
<p><strong>通知(notification):</strong><br>利用已选择的媒体途径把事情相关信息发送给用户。</p>
<p><strong>远程命令(remote command):</strong><br>预先定义好的，满足一定条件后，可在被监控主机上自动执行的命令。</p>
<p><strong>模板(template):</strong><br>一组可以被应用到一个或多个主机上的实体的集合。</p>
<p><strong>应用(application):</strong><br>一组监控项组成的逻辑分组。</p>
<p><strong>Web场景(Web scenario):</strong><br>利用一个或多个HTTP请求来检查网站的可用性。</p>
<p><strong>前端(frontend):</strong><br>Zabbix提供的Web界面。</p>
<p><strong>Zabbix API:</strong><br>Zabbix API允许你使用JSON RPC协议来创建、更新和获取Zabbix对象信息或执行任何其他的自定义的任务。</p>
<p><strong>Zabbix server:</strong><br>Zabbix软件监控的核心程序，主要功能是与Zabbix proxies和agent进行交互、触发器计算、发送告警通知，并将数据集中保存等。</p>
<p><strong>Zabbix agent:</strong><br>部署在监控对象上，能够主动监控本地资源和应用。</p>
<p><strong>Zabbix proxy:</strong><br>帮助Zabbix server收集数据，分担Zabbix server的负载。</p>
<p><br><br><br></p>
<hr>
<h1 id="Zabbix进程"><a href="#Zabbix进程" class="headerlink" title="Zabbix进程"></a>Zabbix进程</h1><h2 id="Agent"><a href="#Agent" class="headerlink" title="Agent"></a>Agent</h2><p>zabbix agent部署在监控的目标上，主动监测本地的资源和应用（硬件驱动，内存，处理器统计等）。<br>zabbix agent手机本地的操作信息并将数据报告给zabbix server用于进一步处理。</p>
<p>zabbix agent有被动(passive)和主动(active)两种检查方式。</p>
<p><br></p>
<h2 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h2><p>zabbix server是zabbix软件的核心程序。它通过轮询和捕获数据，计算是否满足触发器条件，向用户发送通知。<br>它是zabbix监控代理和Proxy代理报告系统可用性和完整性数据的核心组件。zabbix server自身可以通过简单远程检查网络服务(如Web服务器和邮件服务器)。</p>
<p>server是一个包含了被存储了所有配置，统计方面的和可操作数据的中央仓库，它是监控系统问题升级以致于激活警告管理器的zabbix中的实体。</p>
<p>基本的zabbix server分三个不同的组件：<strong>zabbix server，web前端，数据库存储</strong>。<br>zabbix的所有配置信息都存储在服务器和web前端进行交互的数据库中。</p>
<p>zabbix server进程是以守护进程（Daemon）运行的。</p>
<p><br></p>
<h2 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h2><p>zabbix proxy是一个可以从一个或多个受监控的设备设备收集监控数据，并将信息发送到zabbix server的进程，基本上是代表server工作。<br>所有收集的数据都在本地进行缓存，然后传送到proxy所属的zabbix server。</p>
<p>zabbix proxy是完成远程区域、分支机构、没有本地管理员的网络的集中监控的理想解决方案。</p>
<p>zabbix proxy需要使用独立的数据库，以守护进程的方式运行。</p>
<p><br></p>
<h2 id="Java-gateway"><a href="#Java-gateway" class="headerlink" title="Java gateway"></a>Java gateway</h2><p>zabbix守护进程原生支持监控JMX程序，它被称为zabbix java gateway。zabbix gateway是用Java语言写成。</p>
<p>要查得一台主机特定的JMX计数器值，zabbix server向zabbix java gateway发送请求，后者使用JMX管理API去请求远程的有关应用。应用不许额外安装软件，只需要启动时在命令行指定 <code>-Dcom.sun.management.jmxremote</code>即可（是在java程序）。</p>
<p>每个zabbix server或zabbix agent只能配置一个java gateway。</p>
<p><br></p>
<h2 id="Sender"><a href="#Sender" class="headerlink" title="Sender"></a>Sender</h2><p>zabbix sender是一种命令行应用，它可以将性能数据发送到zabbix server进行处理。该应用通常用在长时间运行的用户脚本，用于定期发送可用性和性能数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">zabbix_sender -z zabbix -s &quot;xxx&quot; -k db.connections -0 43</div><div class="line"></div><div class="line">-z :server主机</div><div class="line">-s :受监控主机的技术名称</div><div class="line">-k :监控项的键</div><div class="line">-o :要发送的值</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="Get"><a href="#Get" class="headerlink" title="Get"></a>Get</h2><p>zabbix get也是一种命令行应用，用于与zabbix agent进行通信，并从agent那里获取所需的信息。<br>该应用通常被用于zabbix agent故障排除</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">zabbix_get -s $host -p xxx -k system.cpu.load[all,avg15]</div><div class="line"></div><div class="line">-s  --host</div><div class="line">-p --port</div><div class="line">-I --source-address</div><div class="line">-k --key</div><div class="line">-h --help</div><div class="line">-V --version</div></pre></td></tr></table></figure>
<p><br><br><br></p>
<hr>
<h1 id="安装Zabbix"><a href="#安装Zabbix" class="headerlink" title="安装Zabbix"></a>安装Zabbix</h1><h2 id="Zabbix安装要求"><a href="#Zabbix安装要求" class="headerlink" title="Zabbix安装要求"></a>Zabbix安装要求</h2><p><strong>硬件：</strong></p>
<ul>
<li>内存，最小128MB；</li>
<li>磁盘，最小256MB；</li>
<li>CPU，可能需要大量CPU资源；</li>
<li>SMS(短信)通知服务，串行通讯口(serial communication port)和串口GSM调制解调器(serial GSM modem)。可选项。</li>
</ul>
<p><strong>支持平台：</strong></p>
<ul>
<li>Linux;</li>
<li>IBM AIX;</li>
<li>FreeBSD;</li>
<li>NetBSD;</li>
<li>OpenBSD;</li>
<li>Mac OS X;</li>
<li>Solaris;</li>
<li>Windows(Only Agent).</li>
</ul>
<p><strong>软件：</strong><br>Zabbix基于Apache Web服务器、领先的数据库引擎和PHP脚本语言进行构建。</p>
<p><strong>数据库管理系统：</strong></p>
<ul>
<li>MySQL 5.0.3 及以上；</li>
<li>Oracle 10g 及以上；</li>
<li>PostgreSQL 8.1 及以上；</li>
<li>SQLite 3.5及以上；</li>
<li>IBM DB2 9.7 及以上。</li>
</ul>
<p><strong>前端：</strong></p>
<ul>
<li>Apache 1.3.12 及以上；</li>
<li>PHP 5.4.0及以上；</li>
</ul>
<p><strong>PHP-Extension:</strong></p>
<table>
<thead>
<tr>
<th>软件</th>
<th>版本</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>gd</td>
<td>2.0及以上</td>
<td>PHP GD扩展包必须支持PNG图片</td>
</tr>
<tr>
<td>bcmatch</td>
<td></td>
<td>php-bcmatch</td>
</tr>
<tr>
<td>ctype</td>
<td></td>
<td>php-ctype</td>
</tr>
<tr>
<td>libXML</td>
<td>2.6.15及以上</td>
<td>php-xml</td>
</tr>
<tr>
<td>xmlreader</td>
<td></td>
<td>php-xmlreader</td>
</tr>
<tr>
<td>xmlwrite</td>
<td></td>
<td>php-xmlwriter</td>
</tr>
<tr>
<td>session</td>
<td></td>
<td>php-session</td>
</tr>
<tr>
<td>sockets</td>
<td></td>
<td>php-net-socket</td>
</tr>
<tr>
<td>mbstring</td>
<td></td>
<td>php-mbstring</td>
</tr>
<tr>
<td>gettext</td>
<td></td>
<td>php-gettext</td>
</tr>
<tr>
<td>ldap</td>
<td></td>
<td>php-ldap</td>
</tr>
<tr>
<td>mysqli</td>
<td></td>
<td>使用MySQL作为Zabbix后端数据库所需的组件</td>
</tr>
<tr>
<td>pgsql</td>
<td></td>
<td>使用PostgreSQL作为Zabbix后端数据库所需的组件</td>
</tr>
<tr>
<td>sqlite3</td>
<td></td>
<td>使用SQLite作为Zabbix后端数据库所需的组件</td>
</tr>
</tbody>
</table>
<p><strong>客户端浏览器：</strong><br>必须启用Cookie和JavaScript功能。</p>
<p><strong>服务器：</strong></p>
<table>
<thead>
<tr>
<th>要求</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>OpenlPMI</td>
<td>支持IPMI功能所需组件</td>
<td></td>
</tr>
<tr>
<td>libssh2</td>
<td>支持SSH功能</td>
<td></td>
</tr>
<tr>
<td>fping</td>
<td>支持ICMP ping功能</td>
<td></td>
</tr>
<tr>
<td>libcurl</td>
<td>支持Web监控，VMware监控及SMTP认证</td>
<td></td>
</tr>
<tr>
<td>libiksemel</td>
<td>支持Jabber功能</td>
<td></td>
</tr>
<tr>
<td>libxml2</td>
<td>支持VMware监控</td>
<td></td>
</tr>
<tr>
<td>net-snmp</td>
<td>支持SNMP监控</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Java网关：</strong><br>Java gateway编译和运行在Java 1.6 及以上版本。</p>
<p><strong>数据库容量：</strong><br>Zabbix配置数据需要使用固定的磁盘空间，而这个空间不会过多增长。</p>
<p>Zabbix数据库容量主要依赖于以下参数：</p>
<ul>
<li>每秒处理值的数量(Number of processed values per second);</li>
<li>历史(History)数据的回收清理设置(Housekeeper);</li>
<li>趋势(Trends)数据的回收清理设置(Housekeeper);</li>
<li>事件(Events)数据的回收清理设置(Housekeeper)。</li>
</ul>
<p><strong>时钟同步：</strong><br>对于Zabbix稳定运行而言，服务获取精确的系统时间是非常重要的。对于所有运行Zabbix组件的系统，强烈建议这些系统的时间保持同步。<br><code>ntpd</code>是一个临幸的用于同步主机和其他服务器之间的时间的后台程序。</p>
<p><br></p>
<h2 id="安装、启动、配置Zabbix"><a href="#安装、启动、配置Zabbix" class="headerlink" title="安装、启动、配置Zabbix"></a>安装、启动、配置Zabbix</h2><p>Zabbix-repo仓库：<a href="repo.zabbix.com">repo.zabbix.com</a><br>该仓库服务器同时提供<code>yum</code>和<code>apt</code>源码库。</p>
<h3 id="配置源码库"><a href="#配置源码库" class="headerlink" title="配置源码库"></a>配置源码库</h3><p><strong>1. 从官方下载源码库</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#rpm -ivh http://repo.zabbix.com/zabbix/$version/rhel/7/$arch/$zabbix-release.rpm</span></div><div class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-1.el7.centos.noarch.rpm</div><div class="line"></div><div class="line"><span class="comment">#阿里云镜像</span></div><div class="line"><span class="comment">#rpm -ivh http://mirrors.aliyun.com/zabbix/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-1.el7.noarch.rpm</span></div><div class="line"></div><div class="line"><span class="comment">#镜像失效的话自己去官网找</span></div></pre></td></tr></table></figure>
<p><strong>2. 手动配置zabbix.repo</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vim /etc/yum.repos.d/zabbix.repo</div><div class="line"></div><div class="line">[zabbix]</div><div class="line">name=Zabbix-Repo</div><div class="line">baseurl=http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/</div><div class="line">gpgcheck=0</div><div class="line"><span class="built_in">enable</span>=1</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="安装Zabbix部署包"><a href="#安装Zabbix部署包" class="headerlink" title="安装Zabbix部署包"></a>安装Zabbix部署包</h3><p>使用MySQL数据库安装Zabbix Server、Web前端：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y zabbix-server-mysql zabbix-get</div></pre></td></tr></table></figure></p>
<p><strong>注意：此处Zabbix数据库使用MySQL，请自行安装MySQL。</strong></p>
<p>安装Zabbix Agent：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y zabbix-agent</div></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="安装初始化数据库"><a href="#安装初始化数据库" class="headerlink" title="安装初始化数据库"></a>安装初始化数据库</h3><p>查看刚刚安装的 <strong>zabbix-server-mysql</strong>：<br>解压得到的sql脚本<code>create.sql</code>只会在对应的数据库中初始化zabbix所需要的数据库表，但是不会创建zabbix数据库。所以后面我们还需要手动创建<code>zabbix</code>数据库。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">rpm -ql zabbix-server-mysql</div><div class="line"></div><div class="line"><span class="built_in">cd</span> /usr/share/doc/zabbix-server-mysql-3.x.xx/</div><div class="line"></div><div class="line"><span class="comment">#有一个create.sql.gz的压缩文件</span></div><div class="line">gunzip create.sql.gz</div><div class="line"><span class="comment">#得到create.sql</span></div></pre></td></tr></table></figure></p>
<p><strong>在MySQL中创建zabbix数据库：</strong><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">msyql -uxxx -p</div><div class="line"></div><div class="line">mysql&gt;CREATE DATABASE <span class="string">'zabbix'</span> DEFAULT CHARACTER SET <span class="string">'utf8'</span>;</div><div class="line">mysql&gt;SHOW DATABASES;</div><div class="line">mysql&gt;GRANT ALL ON zabbix.* TO <span class="string">'zabbix'</span>@<span class="string">'localhost'</span> identified by <span class="string">'zabbix'</span>;</div><div class="line">mysql&gt;FLUSH PRIVILEGES;</div><div class="line"></div><div class="line"><span class="comment">#导入sql脚本</span></div><div class="line">mysql -uroot -p -Dzabbix &lt; ./create.sql</div><div class="line"></div><div class="line">USE zabbix;</div><div class="line">SHOW TABLES;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#mysql限制IP</span></div><div class="line">vim /etc/my.cnf</div><div class="line"></div><div class="line">[mysqld]</div><div class="line"><span class="built_in">bind</span>-address=127.0.0.1</div></pre></td></tr></table></figure></p>
<p><br><br><img src="/images/zabbix_database.png" alt="zabbix-database alt=&quot;zabbix-database&quot;"></p>
<p><br></p>
<h3 id="配置zabbix-server并启动"><a href="#配置zabbix-server并启动" class="headerlink" title="配置zabbix server并启动"></a>配置zabbix server并启动</h3><p>编辑zabbix server配置文件：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">vim /etc/zabbix/zabbix_server.conf</div><div class="line"></div><div class="line"><span class="comment">#常会修改的参数</span></div><div class="line"></div><div class="line"><span class="comment">#数据库配置</span></div><div class="line">DBHost=localhost</div><div class="line">DBName=zabbix</div><div class="line">DBUser=zabbix</div><div class="line">DBPassword=zabbix</div><div class="line">DBPort=3306</div><div class="line">DBSocket=/var/lib/mysql/mysql.sock</div><div class="line"></div><div class="line"><span class="comment">#服务监听端口</span></div><div class="line">ListenPort=10051</div><div class="line"></div><div class="line"><span class="comment">#服务端源IP</span></div><div class="line">SourceIP=</div><div class="line"></div><div class="line"><span class="comment">#日志记录方式，file使用指定文件作为日志文件，system将日志发往syslog，console将日志发送控制台</span></div><div class="line">LogType=file</div><div class="line">LogFile=/var/<span class="built_in">log</span>/zabbix/zabbix_server.log</div></pre></td></tr></table></figure></p>
<p>启动zabbix服务端：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">systemctl start zabbix-server</div><div class="line"></div><div class="line"><span class="comment">#此处可能由于没有关闭SELinux而报错</span></div><div class="line">tail /var/<span class="built_in">log</span>/zabbix/zabbix_server.log</div><div class="line">cannot <span class="built_in">set</span> resource <span class="built_in">limit</span>: [13] Permission denied</div><div class="line"></div><div class="line"><span class="comment">#关闭SELinux</span></div><div class="line">setenforce=0</div><div class="line"></div><div class="line">vim /etc/selinux/config</div><div class="line">SELINUX=disabled</div><div class="line"></div><div class="line"><span class="comment">#查看zabbix-server默认监听的10051端口</span></div><div class="line">netstat -nltp</div></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="安装zabbix-web"><a href="#安装zabbix-web" class="headerlink" title="安装zabbix web"></a>安装zabbix web</h3><p>zabbix web可以安装在单独的主机上，只要能连接到zabbix database所在数据库就行。但为了方便，都安装在了server上。</p>
<p>zabbix web需要LAMP环境：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#可能需要自己配置PHP remi源，注意PHP及扩展版本问题</span></div><div class="line">yum install -y httpd php php-mysql php-mbstring php-gd php-bcmatch php-ldap php-xml</div><div class="line"></div><div class="line"><span class="comment">#指定php版本</span></div><div class="line"><span class="comment">#yum --enablerepo=remi-php56 install php-mysql php-mbstring php-gd php-bcmatch php-ldap php-xml</span></div></pre></td></tr></table></figure></p>
<p>安装zabbix web所需的两个包：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">yum install -y zabbix-web zabbix-web-mysql</div><div class="line"><span class="comment">#此处默认使用php5.4</span></div><div class="line"><span class="comment">#因为我的环境是php5.6,会报错</span></div><div class="line"><span class="comment">#此时就需要指定php版本来安装</span></div><div class="line">yum --enablerepo=remi-php56 install zabbix-web zabbix-web-mysql</div><div class="line"></div><div class="line"></div><div class="line">rpm -ql zabbix-web</div><div class="line"><span class="comment">#zabbix-web位于/usr/share/zabbix/</span></div></pre></td></tr></table></figure></p>
<h3 id="编辑zabbix的前端Apach-PHP配置文件"><a href="#编辑zabbix的前端Apach-PHP配置文件" class="headerlink" title="编辑zabbix的前端Apach-PHP配置文件"></a>编辑zabbix的前端Apach-PHP配置文件</h3><p>zabbix前端的Apache配置文件位于 /etc/httpd/conf.d/zabbix.conf:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">vim /etc/httpd/conf.d/zabbix.conf</div><div class="line"></div><div class="line"><span class="comment">#需修改时区</span></div><div class="line">php_value max_execution_time 300</div><div class="line">php_value memory_limit 128M</div><div class="line">php_value post_max_size 16M</div><div class="line">php_value upload_max_filesize 2M</div><div class="line">php_value max_input_time 300</div><div class="line">php_value always_populate_raw_post_data -1</div><div class="line">php_value date.timezone Asia/Shanghai</div><div class="line"></div><div class="line"><span class="comment">#建议顺便修改/etc/php.ini的时区</span></div><div class="line">vim /etc/php.ini</div><div class="line"></div><div class="line">date.timezone = Asia/Shanghai</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#添加httpd的虚拟主机访问zabbix web</span></div><div class="line">&lt;VirtualHost IP:80&gt;</div><div class="line">servername zabbix.me</div><div class="line">documentroot /usr/share/zabbix</div><div class="line"></div><div class="line">默认数据</div><div class="line"></div><div class="line">&lt;/VirtualHost&gt;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#开启httpd服务</span></div><div class="line">systemctl start httpd</div></pre></td></tr></table></figure></p>
<p><br><br><img src="/images/Zabbix/zabbix_conf.png" alt="/etc/httpd/conf.d/zabbix.conf"></p>
<p><br><br>添加hosts后就可以利用域名访问zabbix-web端了。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> -e <span class="string">"192.168.1.9 \t zabbix.me"</span> &gt;&gt; /etc/hosts</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="在web端配置zabbix"><a href="#在web端配置zabbix" class="headerlink" title="在web端配置zabbix"></a>在web端配置zabbix</h3><p>在浏览器访问 <a href="http://zabbix.me" target="_blank" rel="noopener">http://zabbix.me</a> 初始化zabbix配置。<br>配置好后就需要用账号密码进行登录zabbix-web端dashboard。</p>
<p>默认用户名是：admin，密码是配置文件里面设置的。<br><img src="/images/Zabbix/zabbix_me.png" alt="登录zabbix Dashboard"></p>
<p><br></p>
<p>登录进Dashboard后，可修改语言为中文。</p>
<p><img src="/images/Zabbix/dashboard.jpg" alt="Dashboard"></p>
<p><br></p>
<p><strong>如果你的Zabbix无法看到中文选项，那么可能需要如下操作：</strong><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /usr/share/zabbix/include/locales.inc.php</div><div class="line"></div><div class="line"><span class="comment">#修改</span></div><div class="line"><span class="string">'zh_CN'</span> =&gt; [<span class="string">'name'</span> =&gt; _(<span class="string">'Chinese (zh_CN)'</span>),     <span class="string">'display'</span> =&gt; <span class="literal">true</span>],</div></pre></td></tr></table></figure></p>
<p><strong>如果又遇到中文乱码的问题，则可以从windows中挑选一些好看的中文字体，将对应字体文件放置到zabbix web的字体目录中。</strong><br>windows中字体后缀.TTF，Linux中为.ttf。注意修改大小写。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/share/zabbix/fonts</div><div class="line"><span class="comment">#只有一个默认字体 graphfont.ttf</span></div><div class="line"><span class="comment">#将新字体放置到此目录下</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#修改配置文件中对应字体名称</span></div><div class="line">vim /usr/share/zabbix/include/define.inc.php</div><div class="line"></div><div class="line"><span class="comment">#将默认字体名字修改为字体目录下 你需要的字体名</span></div><div class="line">define(<span class="string">'ZBX_FONT_NAME'</span>, <span class="string">'graphfont'</span>);</div><div class="line">define(<span class="string">'ZBX_GRAPH_FONT_NAME'</span>,           <span class="string">'graphfont'</span>); // font file name</div><div class="line"></div><div class="line"><span class="comment">#栗子，如perpetua字图PER.ttf</span></div><div class="line">define(<span class="string">'ZBX_FONT_NAME'</span>, <span class="string">'PER'</span>);</div><div class="line">define(<span class="string">'ZBX_GRAPH_FONT_NAME'</span>,           <span class="string">'PER'</span>); // font file name</div></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>图形显示乱码，同样是用以上方法。在windowss上找一个中文字体上传到zabbix字体目录，并修改配置文件就可以了。</strong></p>
<p><br></p>
<p>Zabbix Web界面菜单：</p>
<p><img src="/images/Zabbix/zabbix_menu.png" alt="zabbix菜单"></p>
<p><br></p>
<ul>
<li>管理菜单，用于管理zabbix自身及zabbix相关设置；</li>
<li>配置菜单，用于配置监控相关设置；</li>
<li>报表菜单，为管理员生成一段时间内的监控统计信息；</li>
<li>检测中菜单，用于查看被监控的相关数据；</li>
<li>资产记录菜单，查看被监控的主机有哪些，以及相关的资产信息。</li>
</ul>
<p><br></p>
<h2 id="安装zabbix-agent"><a href="#安装zabbix-agent" class="headerlink" title="安装zabbix agent"></a>安装zabbix agent</h2><p>Agent端安装也非常方便，直接在Client上安装两个包即可。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">#配置zabbix源</span></div><div class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-1.el7.centos.noarch.rpm</div><div class="line"></div><div class="line"><span class="comment">#aliyun镜像</span></div><div class="line"><span class="comment">#rpm -ivh http://mirrors.aliyun.com/zabbix/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-1.el7.noarch.rpm</span></div><div class="line"></div><div class="line"><span class="comment">#安装</span></div><div class="line">yum install -y zabbix-agent zabbix-sender</div><div class="line"></div><div class="line">rpm -ql zabbix-agent</div><div class="line"><span class="comment">#/etc/zabbix/zabbix_agentd.conf</span></div></pre></td></tr></table></figure>
<p>zabbix的“主动模式”与“被动模式”都在<code>/etc/zabbix/zabbix_agentd.conf</code>中定义。<br>配置最常用的agent端：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">vim /etc/zabbix/zabbix_agentd.conf</div><div class="line"></div><div class="line"><span class="comment">####GENERAL PARAMETERS 通用配置</span></div><div class="line">PidFile=</div><div class="line">LogFile=</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">####Passive checks related 被动模式配置</span></div><div class="line"><span class="comment">#指定允许哪台服务器拉取本机数据</span></div><div class="line">Server=</div><div class="line"><span class="comment">#指定agent端工作于被动模式时监听的端口号</span></div><div class="line">ListenPort=10050(默认)</div><div class="line"><span class="comment">#指定agent端工作与被动模式时所监听的IP地址</span></div><div class="line">ListenIP=0.0.0.0(默认)</div><div class="line"><span class="comment">#指定预生成的agent进程数量</span></div><div class="line">StartAgents=</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">####Active checks related</span></div><div class="line"><span class="comment">#agent工作于主动模式时，将消息推送到哪台Server上</span></div><div class="line">ServerActive=IP1,IP2...</div><div class="line"><span class="comment">#指定当前主机主机名，Server端通过对应的主机名识别主机</span></div><div class="line">Hostname=</div><div class="line"><span class="comment">#指明agent端每隔多少秒将采集的数据发往Server端</span></div><div class="line">RefreshActiveChecks=</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#栗子</span></div><div class="line">Server=192.168.1.9</div><div class="line">ServerActive=192.168.1.9</div><div class="line">Hostname=zabbix.me</div></pre></td></tr></table></figure></p>
<p><br><br><strong>启动zabbix-agent</strong><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">systemctl zabbix-agent start</div><div class="line"></div><div class="line"><span class="comment">#查看状态,默认端口10050</span></div><div class="line">netstat -nltp</div></pre></td></tr></table></figure></p>
<p><img src="/images/Zabbix/zabbix-agent.png" alt="zabbix-agent状态"></p>
<p><br><br><br></p>
<hr>
<h1 id="快速开始zabbix-web菜单"><a href="#快速开始zabbix-web菜单" class="headerlink" title="快速开始zabbix-web菜单"></a>快速开始zabbix-web菜单</h1><p>zabbix-web界面中包含有<strong>监测中、资产记录、报表、配置、管理</strong>五项菜单。</p>
<p><br></p>
<h2 id="登录和配置用户"><a href="#登录和配置用户" class="headerlink" title="登录和配置用户"></a>登录和配置用户</h2><p>在浏览器输入 <a href="zabbix.me">zabbix.me</a> (修改hosts)，登录zabbix-web后台。</p>
<p>默认用户名：<strong>Admin</strong>，密码：<strong>zabbix</strong>。它是超级管理员。</p>
<p>为了防止暴力破解和词典攻击，连续尝试五次登录失败，zabbix界面将暂停30秒。</p>
<p><br></p>
<p>可以通过<strong>管理(Management)</strong>菜单下的<strong>用户(User)</strong>，新建、查看、管理用户信息。</p>
<p>zabbix在安装后自定义了两个用户：</p>
<ul>
<li>Admin用户是zabbix的超级管理员，拥有所有权限；</li>
<li>Guest用户是一个特殊的默认用户。如果你没有登录，你访问zabbix的时候其实就是“guest”权限。guest默认没有任何权限。</li>
</ul>
<p>你可以创建一个用户(user)并将其加入特定的用户组(Group)以提升用户权限。<br><img src="/images/Zabbix/user.png" alt="新建用户"></p>
<p>可以仅用用户信息里面-报警媒介里面，自定义严重性的报警。只有勾选部分的报警信息才会发送过来。这也很棒！</p>
<p>如果存在严重性则使用：</p>
<ul>
<li style="list-style: none"><input type="checkbox"> Not classified</li>
<li style="list-style: none"><input type="checkbox"> Information</li>
<li style="list-style: none"><input type="checkbox"> Warning</li>
<li style="list-style: none"><input type="checkbox"> Average</li>
<li style="list-style: none"><input type="checkbox"> High</li>
<li style="list-style: none"><input type="checkbox"> Disaster</li>
</ul>
<p><img src="/images/Zabbix/Useifseverity.png" alt="Use if severity"></p>
<p><br><br><br></p>
<h2 id="新建主机"><a href="#新建主机" class="headerlink" title="新建主机"></a>新建主机</h2><p>zabbix中的主机(host)是一个你想要监控的网络实体(物理的、虚拟的)。对于主机的定义非常灵活。它可以是一台物理服务器，一个网络交换机，一个虚拟机或一些应用。</p>
<p><br><br>可以通过<strong>配置(Configuration)</strong>菜单下的<strong>主机(Host)</strong>，查看已配置主机相关信息。<br>默认有一个“Zabbix Server”的定义好的主机。</p>
<p>点击<strong>创建主机(Create host)</strong>后，填写对应的主机名称、添加对应的主机群组，zabbix-agent的IP地址和端口，以及其它信息。</p>
<p><img src="/images/Zabbix/host.png" alt="创建主机"></p>
<p><br><br><br></p>
<h2 id="新建监控项"><a href="#新建监控项" class="headerlink" title="新建监控项"></a>新建监控项</h2><p>监控项是zabbix中获得数据的基础。没有监控项，就没有数据。因为一个主机中只有监控项定义了”单一的指标“或者”需要获得的数据“。</p>
<p><br><br>可以通过<strong>配置(Configuration)</strong>菜单下的<strong>主机(Item)</strong>，找到需要配置<strong>监控项(Item)</strong>的主机，然后创建监控项。<br>主机默认是没有定义任何监控项的。</p>
<p>填写对应的监控名称、类型、键值、主机接口、信息类型等等信息。<br><img src="/images/Zabbix/create-item.png" alt="添加监控项"></p>
<p><br><br>可在<strong>监控(Monitoring)</strong>菜单中<strong>最新数据(Latest data)</strong>查看之前定义的监控项和获得的值。<br>还可选择以<strong>图形(Graph)</strong>或<strong>值</strong>来查看监控项的相关信息。<br><img src="/images/Zabbix/upload.png" alt="upload监控信息"></p>
<p>同样也还以在Zabbix-Server端获得数据信息：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#zabbix_get -s $ip -k $value</span></div><div class="line">zabbix_get -s 192.168.1.9 -k system.cpu.load</div></pre></td></tr></table></figure></p>
<p><br><br><br></p>
<h2 id="新建触发器"><a href="#新建触发器" class="headerlink" title="新建触发器"></a>新建触发器</h2><p>监控项只用于收集数据。如果要自动评估收到的数据，我们则需要定义触发器(trigger)。<br>触发器包含了一个表达式，这个表达式定义了数据的可接受的阈值级别。</p>
<p>如果收到的数据超过了定义好的级别，触发器将被<strong>触发</strong>，或者进入<strong>异常状态</strong>(problem)。<br>从而引起我们的注意，让我们知道有问题发生。如果数据再次恢复到合理范围，触发器将会转到<strong>正常状态</strong>(OK)。</p>
<p><br></p>
<p>可以通过<strong>配置(Configuration)</strong>菜单下的<strong>主机(Hosts)</strong>选项，找到某主机的<strong>触发器(Triggers)</strong>创建触发器。</p>
<p>填写对应的触发器名称、表达式、描述等信息。<br><img src="/images/Zabbix/create-trigger.png" alt="创建触发器"></p>
<p><br><br><br></p>
<h2 id="获取问题通知"><a href="#获取问题通知" class="headerlink" title="获取问题通知"></a>获取问题通知</h2><p>当监控项收集了数据后，触发器会根据异常状态触发报警。根据一些报警机制，它也会通知我们一些重要的事情，而不是直接在zabbix-web端进行查看。<br>这就是<strong>通知(Notification)</strong>的功能。<br><strong>E-mail</strong>是最常用的异常通知发送方式。当然还有<strong>SMS（短信），脚本</strong>等媒体类型。</p>
<p><br></p>
<p>可以通过<strong>管理(Administration)</strong>菜单中的<strong>报警媒体类型(Media types)</strong>，点击预定义媒体类型列表中的Email，来配置Email。<br><img src="/images/Zabbix/create-email.png" alt="创建Email通知"></p>
<p>为了建立一个通知，我们需要在<strong>配置</strong>菜单下<strong>动作</strong>中，创建<strong>动作(Create action)</strong>。<br><img src="/images/Zabbix/create-action.png" alt="创建动作"></p>
<p>一旦满足了触发器的条件，变回触发执行动作。如收到E-mail等…</p>
<p><br><br><br></p>
<h2 id="新建模板"><a href="#新建模板" class="headerlink" title="新建模板"></a>新建模板</h2><p>如果我们配置上前台主机，一些自动化操作会带来更多便利性。没错，<strong>模板(templates)</strong>功能就可以实现。<br>模板允许对有用的监控项、触发器和其他对象进行分组，只需要一步就可以对监控主机应用模板，已达到反复重用的目的。</p>
<p>当一个模板链接到一个主机后，主机会继承这个模板中的所有对象。简单而言，一组预先定义好的检查会被快速应用到主机上。</p>
<p>Zabbix为各种操作系统、设备以及应用准备好了一些预定义的模板。你可以快速部署使用他们。<br><strong>但是请注意，一些模板需要根据你的实际情况和使用环境进行适当俄调整。</strong> 比如，一些检查项是不需要的，一些轮询周期过于频繁等。</p>
<p><br><br>在<strong>配置</strong>菜单下的<strong>模板(Templates)</strong>下，点击<strong>创建模板(Create template)</strong>。填写对应的模板名称，群组等信息。<br><img src="/images/Zabbix/create-template.png" alt="创建模板"></p>
<p>创建模板完毕后，可将模板链接到主机。之后，模板及其所有对象被添加到了主机。</p>
<p><br><br><br></p>
<hr>
<h1 id="配置-Configuration"><a href="#配置-Configuration" class="headerlink" title="配置(Configuration)"></a>配置(Configuration)</h1><p><br></p>
<h2 id="主机和主机组-Hosts-and-groups"><a href="#主机和主机组-Hosts-and-groups" class="headerlink" title="主机和主机组(Hosts and groups)"></a>主机和主机组(Hosts and groups)</h2><p>一般来讲，zabbix主机是指你希望监控的那些设备。如服务器、工作站、交换机等。<br>创建主机是使用zabbix过程的首要任务。</p>
<p>我们可以把主机组想象成项目组。根据不同的功能将主机划分到主机组是非常重要的，这样可以对以后创建的用户和用户组在定义权限的时候，不用给他们zabbix admin权限，而只需要根据主机组(项目组)给予用户和用户组对应项目(主机组)的权限即可。<br>这样很大程度上方便了Zabbix监控多个项目，也利于管理。同样，报警的时候也只会收到权限内的相关报警信息。</p>
<p><br></p>
<h3 id="配置一台主机"><a href="#配置一台主机" class="headerlink" title="配置一台主机"></a>配置一台主机</h3><p>配置–主机–创建主机–填写相关参数信息。</p>
<p>可以在已经存在的主机上使用 <strong>Clone</strong>或<strong>Full Clone</strong>创建一个新主机。</p>
<blockquote>
<p>Clone将保留所有的主机参数和模板链接；<br>Full Clone将额外保留指数实体(应用集、监控项、触发器、视图、规则、Web场景)。</p>
</blockquote>
<p><strong>新建主机下：</strong></p>
<ol>
<li>主机(Host)：包含了通用的主机属性；</li>
<li>模板(Template)：允许将模板链接诶到主机，所有实体将从模板继承；</li>
<li>IPMI：包含IPMI管理属性；</li>
<li>宏(Macros)：允许定义主机级别的<strong>用户宏</strong>；</li>
<li>主机资产记录(Host inventory)：允许为主机收工输入库存信息；</li>
<li>允许你请求与主机的加密的连接。</li>
</ol>
<p><br></p>
<h3 id="资产管理-Inventory"><a href="#资产管理-Inventory" class="headerlink" title="资产管理(Inventory)"></a>资产管理(Inventory)</h3><p>你可以将联网设备的资产信息保存在zabbix里。<br>资产信息实在配置主机时人工录入建立的资产信息数据，或者通过使用某些自动填充选项完成的录入。</p>
<p><strong>构建资产库：</strong></p>
<ul>
<li>手动模式： 在配置一台主机的时候，手动输入资产信息；</li>
<li>自动模式： 在配置主机的时候，选择自动。</li>
</ul>
<p>之后便可以在<strong>资产记录</strong>菜单中的<strong>概述，主机</strong>项中查看相关信息。</p>
<p><br></p>
<h3 id="批量更新-Mass-update"><a href="#批量更新-Mass-update" class="headerlink" title="批量更新(Mass update)"></a>批量更新(Mass update)</h3><p>有时候可能需要一次更改多个主机的某些属性，使用<strong>批量更新(mass update)</strong>功能来代替打开每个主机进行编辑。</p>
<p><img src="/images/Zabbix/mass-update.png" alt="批量更新"></p>
<p>可批量处理<strong>主机、模板、IPMI、资产、加密</strong>相关信息。</p>
<p><br><br><br></p>
<h2 id="监控项-Items"><a href="#监控项-Items" class="headerlink" title="监控项(Items)"></a>监控项(Items)</h2><p><strong>监控项</strong>是从主机收集的数据信息。<br>配置主机后，需要添加一些监控项以开始获取数据。快速添加多个监控项的一种方法是将预定义的模板附加到主机。</p>
<p>在单个监控项中，可指定从主机收集哪些数据信息。<br>为此，可使用<strong>监控项key</strong>。 如<strong>system.cpu.load</strong>将收集处理器负载的数据。<br>要给 key 指定更过参数，请在后面添加<strong>方括号[]</strong>。 如<strong>system.cpu.load[avg5]</strong>， 返回最近5分钟的CPU负载平均值。</p>
<p><br></p>
<h3 id="创建一个监控项"><a href="#创建一个监控项" class="headerlink" title="创建一个监控项"></a>创建一个监控项</h3><p>可在主机中新建一个监控项。<br>不支持的监控项：如果由于某种原因无法检索该值，则该监控项可能不被支持。这些监控项仍然以固定的间隔重新检查。</p>
<p><strong>监控项的key:</strong></p>
<ol>
<li>key名称允许使用字符： 0-9a-zA-Z_-.</li>
<li>key参数，用 逗,号 分隔： xxx[par1,par2…]</li>
<li>key参数也可以为空，此时使用默认值： key</li>
<li>key参数带引号，则允许任何Unicode字符，如果包含双引号则需要 \反斜杠 转义</li>
<li>key参数是一个数组，它需要包含在方括号中</li>
</ol>
<p><br></p>
<p><strong>自定义间隔(Custom intervals)</strong></p>
<p>创建关于监控项的自定义时间规则。<br>灵活间隔被设计为重新定义默认监控项的的更新间隔，但调度间隔用于指定独立执行的检查计划。</p>
<p><strong>灵活的间隔(Flexible intervals)：</strong>允许重定义特定时间段的默认间隔。</p>
<ul>
<li>间隔(Interval)： 指定时间段的更新间隔；</li>
<li>期间(Period)： 灵活间隔有效的时间段；</li>
<li>举个栗子： 60(interval), 1-7,00-24(period)。监控项每隔60s检查一次。</li>
</ul>
<p><br></p>
<p><strong>调度间隔(Scheduling intervals)：</strong>用于在特定时间检查监控项。</p>
<p>调度间隔定义为， <code>md&lt;filter&gt;wd&lt;filter&gt;h&lt;filter&gt;m&lt;filter&gt;s&lt;filter&gt;</code>。</p>
<ul>
<li>md: month days(1-31)</li>
<li>wd: week days(1-7)</li>
<li>h:  hours(0-23)</li>
<li>m:  minutes(0-59)</li>
<li>s:  seconds(0-58)</li>
<li><filter>: 指定其前缀的值—-[from-to/step]。</filter></li>
</ul>
<p>其实类似于Linux中定时任务的写法，只不过这里把单位(md,wd,h,m,s)写在了数值的前面。</p>
<p>举个栗子：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">md1-15	<span class="comment">#1-15号</span></div><div class="line"></div><div class="line">wd3	<span class="comment">#星期三</span></div><div class="line"></div><div class="line">h0-12	<span class="comment">#上半天</span></div><div class="line"></div><div class="line">m1,3,5,7,9	<span class="comment">#每个1,3,5,7,9分钟</span></div><div class="line"></div><div class="line">s/10	<span class="comment">#每个10s</span></div><div class="line"></div><div class="line"><span class="comment">#组合体</span></div><div class="line">wd1-5h9-18m/10	<span class="comment">#每个工作日的上班时间每个10分钟</span></div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="监控项类型-Items-type"><a href="#监控项类型-Items-type" class="headerlink" title="监控项类型(Items type)"></a>监控项类型(Items type)</h3><p>监控项类型包含从系统获取数据的多种方式。每个监控项类型都有一组自己支持的监控项key和所需的参数。</p>
<p>zabbix提供的监控项类型：</p>
<ol>
<li>zabbix代理检查(agent checks)</li>
<li>SNMP代理检查</li>
<li>SNMP traps</li>
<li>IPMI检查</li>
<li>简单检查(simple checks)</li>
<li>VMware监控(monitoring)</li>
<li>日志文件监控</li>
<li>计算监控项(Calculated items)</li>
<li>zabbix内部检查(internal checks)</li>
<li>SSH检查</li>
<li>Telnet检查</li>
<li>外部检查(External checks)</li>
<li>汇总检查(Aggregate checks)</li>
<li>捕捉器监控项(Trapper items)</li>
<li>JMX监控</li>
<li>ODBC监控</li>
</ol>
<p><br></p>
<p><strong>zabbix代理(zabbix agent)：</strong><br>这些检查与zabbix代理进行通信实现数据的采集。</p>
<ol>
<li>zabbix agent-passive： 被动模式，Server向Agent索要数据；</li>
<li>zabbix agent-active： 主动模式，Agent主动上报数据给Server。</li>
</ol>
<p>可支持的监控项，可在新建监控项是在键值里面查看。</p>
<p><br></p>
<p><strong>SNMP代理(SNMP agent)：</strong></p>
<p>在启用SNMP的设备(如打印机，交换机，路由器…)上使用SNMP监控，为了能够监控SNMP代理在这些设备上提供的数据，zabbix服务器初始化配置时必须具有SNMP支持。<br>仅通过UDP协议执行SNMP检查。</p>
<p><strong>配置SNMP监控：</strong></p>
<ol>
<li>使用SNMP接口为设备创建一个主机；</li>
<li>找出要监控项目的SNMP字符串；</li>
<li>创建一个监控项。</li>
</ol>
<p><br></p>
<p><strong>IPMI检查：</strong></p>
<p>你可以在zabbix中监控 <strong>智能平台管理接口(IPMI)</strong> 设备的运行状况和可用性。<br>要执行IPMI检查，zabbix服务器必须首先配置IPMI支持。</p>
<p><br></p>
<p><strong>简单检查：</strong></p>
<p>简单检查通常用于远程无代理监控服务。</p>
<p><br></p>
<p><strong>日志文件监控：</strong></p>
<p>zabbix可用于集中监控和分析 具有/不具有 日志转动能力的日志文件。<br>当日志文件包含某些字符串或字符串模式时，通知信息可用于警告用户。</p>
<p><br></p>
<p><strong>计算监控项：</strong></p>
<p>计算监控项是创建虚拟数据源的一种方式。这些值将根据算术表达式定期计算。所有计算都由Server完成。</p>
<p><br><br><strong>内部检查：</strong><br>内部检查可以监控zabbix的内部检查。即Server或Agent Server的运行情况。</p>
<p><br><br><strong>SSH检查：</strong></p>
<p>运行SSH检查是作为无代理监控的，SSH检查不需要zabbix代理。<br>执行SSH检查zabbix服务器必须初始化配置为SSH2支持。</p>
<p>SSH检查提供两种身份验证方法，一种是用户/密码，另一种是基于密钥文件。</p>
<p>zabbix SSH 密钥配置:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">vim /etc/zabbix/zabbix_server.conf</div><div class="line"></div><div class="line"><span class="comment">#SSHKeyLocation=</span></div><div class="line">SSHKeyLocation=/home/zabbix/.ssh</div><div class="line"></div><div class="line">usermod -m -d /home/zabbix zabbix</div><div class="line">chown zabbix:zabbix /home/zabbix</div><div class="line">chmod 700 /home/zabbix</div><div class="line"><span class="built_in">cd</span> /home/zabbix &amp;&amp; su zabbix</div><div class="line"></div><div class="line">ssh-keygen -t rsa</div></pre></td></tr></table></figure>
<p><br></p>
<p><strong>外部检查：</strong></p>
<p>外部检查是由zabbix Server通过运行shell脚本或二进制的检查。<br>外部检查不需要再被监控的主机上运行任何代理。</p>
<p><br></p>
<p><strong>汇总检查：</strong></p>
<p>在汇总检查中，zabbix通过直接从数据库中查询监控信息，然后进行信息聚合。<br>聚合检查不需要再被监控的主机上运行任何代理。</p>
<p><br></p>
<p><strong>捕捉器监控项：</strong></p>
<p>捕捉器监控项接收传入的数据，而不是查询它。对于想要推送到zabbix的任何数据都是适用的。</p>
<p>要使用捕捉器监控项，需要在zabbix中建立一个捕捉器监控项，将数据送给zabbix。</p>
<p><br></p>
<p><strong>JMX监控项：</strong></p>
<p>JMX监控可用于监视Java应用程序的JMX计数器。<br>JMX监视器以zabbix守护进程方式运行，名为zabbix java gateway。</p>
<p><br></p>
<p><strong>ODBC监控：</strong></p>
<p>ODBC监控对应于zabbix web管理端中的数据库监控器监控项类型。<br>ODBC是用于访问 数据库管理系统(DBMS) 的C语言中间件API。</p>
<p>zabbix可以查询ODBC支持的任何数据库。为了实现监控，zabbix不直接连接到数据库，而是使用ODBC中设置的ODBC接口和驱动。<br>该功能允许为多个目的更加有效地监控不同的数据库。</p>
<p><br></p>
<h3 id="历史与趋势-history-and-trends"><a href="#历史与趋势-history-and-trends" class="headerlink" title="历史与趋势(history and trends)"></a>历史与趋势(history and trends)</h3><p>历史与趋势是zabbix中存储数据的两种方式。<br>历史保持每个收集的值，而趋势是每小时的平均信息。</p>
<p>建议保持的历史数据尽可能少，但可以保留更多的趋势数据。</p>
<p><br></p>
<h3 id="用户自定义参数-user-parameter"><a href="#用户自定义参数-user-parameter" class="headerlink" title="用户自定义参数(user parameter)"></a>用户自定义参数(user parameter)</h3><p>有时你想运行一个代理检查，但它不是zabbix预定义的。这时就能用到<strong>用户参数</strong>。<br>用户参数是由zabbix代理之星的命令，最多可以返回512KB的数据。<br><strong>key</strong> 是唯一的。</p>
<p>用户参数用法：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">UserParameter=&lt;key&gt;,&lt;<span class="built_in">command</span>&gt;</div><div class="line"></div><div class="line"><span class="comment">#栗子</span></div><div class="line">UserParameter=ping,<span class="built_in">echo</span> 1</div><div class="line"><span class="comment">#使用ping键为一个监控项返回 1</span></div><div class="line"></div><div class="line"><span class="comment">#复杂栗子</span></div><div class="line">UserParameter=mysql.ping,mysqladmin -uroot -ppwd ping | grep -c <span class="string">'alive'</span></div><div class="line"><span class="comment">#mysqld状态为alive返回1，否则0</span></div><div class="line"></div><div class="line"><span class="comment">#灵活的用户参数</span></div><div class="line">UserParameter=key[*],<span class="built_in">command</span></div><div class="line"><span class="comment">#[*]定义该key接受括号内的参数</span></div><div class="line"></div><div class="line"><span class="comment">#栗子</span></div><div class="line">UserParameter=ping[*],<span class="built_in">echo</span> <span class="variable">$1</span></div><div class="line"></div><div class="line">UserParameter=mysql.ping[*],mysqladmin -u<span class="variable">$1</span> -p<span class="variable">$2</span> ping | grep -c <span class="string">'alive'</span></div><div class="line"><span class="comment">#mysql.ping[zabbix,passwd]</span></div><div class="line"></div><div class="line">UserParameter=wc[*],grep -c <span class="string">"<span class="variable">$2</span>"</span> <span class="variable">$1</span></div><div class="line"><span class="comment">#wc[/etc/passwd,root]</span></div></pre></td></tr></table></figure>
<p><br><br><strong>用户自定义参数扩展zabbix代理：</strong><br>是将key添加到被监控的主机哦！<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#编写命令--SQL查询总数</span></div><div class="line">mysqladmin -uxxx -pxxx status | cut -f4 -d<span class="string">":"</span> | cut -f1 -d<span class="string">"S"</span></div><div class="line"></div><div class="line"><span class="comment">#将命令添加到zabbix_agentd.conf</span></div><div class="line">vim /etc/zabbix/zabbix_agentd.conf</div><div class="line"></div><div class="line"><span class="comment">#找到如下字段</span></div><div class="line"><span class="comment">### Option: UserParameter</span></div><div class="line">UserParameter=mysql.totalquery,mysqladmin -uroot -pxxx status | cut -f4 -d<span class="string">":"</span> | cut -f1 -d<span class="string">"S"</span></div><div class="line"><span class="comment">#mysql.totalquery这个key是唯一的标识符</span></div><div class="line"></div><div class="line"><span class="comment">#测试此参数</span></div><div class="line"><span class="comment">##测试参数可用与否很重要哈</span></div><div class="line">zabbix_agentd -t mysql.totalquery</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#重启zabbix-agent，将重新加载配置</span></div><div class="line">zabbix_get -s <span class="variable">$host</span> -k mysql.totalquery</div></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="可加载模块-loadable-modules"><a href="#可加载模块-loadable-modules" class="headerlink" title="可加载模块(loadable modules)"></a>可加载模块(loadable modules)</h3><p>可加载模块提供了一种关于zabbix性能扩展的选项。</p>
<p>可加载模块基本上只zabbix守护程序使用的共享库，并在启动时加载。<br>可加载模块具有很多优点，卓越的性能和可实现任何逻辑的能力，更重要的是使用和共享了zabbix模块的开发能力。</p>
<p><br></p>
<h3 id="windows性能计数器-windows-perfomance-counter"><a href="#windows性能计数器-windows-perfomance-counter" class="headerlink" title="windows性能计数器(windows perfomance counter)"></a>windows性能计数器(windows perfomance counter)</h3><p>使用perf_counter[]key有效的监控windows性能计数器</p>
<p><br></p>
<h3 id="批量更新-mass-update"><a href="#批量更新-mass-update" class="headerlink" title="批量更新(mass update)"></a>批量更新(mass update)</h3><p>使用批量更新功能，可一次更改多个监控属性。</p>
<p><br></p>
<h3 id="值映射-value-mapping"><a href="#值映射-value-mapping" class="headerlink" title="值映射(value mapping)"></a>值映射(value mapping)</h3><p>对于接收值更人性化的表示，可以使用包含数值和字符串之间的映射的<strong>值映射</strong>。</p>
<p>如：</p>
<ul>
<li>0 —&gt; error</li>
<li>1 —&gt; true</li>
<li>F —&gt; Full</li>
<li>D —&gt; Differential</li>
<li>I —&gt; Incremental</li>
<li>…</li>
</ul>
<p><br></p>
<h3 id="应用集-Application"><a href="#应用集-Application" class="headerlink" title="应用集(Application)"></a>应用集(Application)</h3><p><strong>应用集</strong>对逻辑组中的监控项进行分组。</p>
<p>如，对MongoDB的可用性，空间，负载，慢查询，执行命令…，可归于 MongoDB应用于中。</p>
<p><br></p>
<h3 id="队列-queue"><a href="#队列-queue" class="headerlink" title="队列(queue)"></a>队列(queue)</h3><p><strong>队列</strong>显示正在等待刷新的监控项。<br>队列只是一个逻辑表达的数据。</p>
<p>队列显示的统计信息是zabbix服务器性能是否健康的指标。<br>在 管理–队列 下对去队列。</p>
<p><br></p>
<h3 id="值缓存-value-cache"><a href="#值缓存-value-cache" class="headerlink" title="值缓存(value cache)"></a>值缓存(value cache)</h3><p>为了计算触发表达式，以及让计算/聚合监控项和一些宏更快，zabbix服务器支持值的缓存选项。</p>
<p>在内存中的缓存可用于访问历史数据，而不用之间调用数据库。如果缓存中不存在历史值，则从数据库请求缺少的值，并相应地跟新缓存。</p>
<p>要启用值缓存功能，修改zabbix_server.conf中可选的ValueCacheSize参数。</p>
<p><br><br><br></p>
<h2 id="触发器-Trigger"><a href="#触发器-Trigger" class="headerlink" title="触发器(Trigger)"></a>触发器(Trigger)</h2><p>触发器是评估有项目采集的数据并表示当前系统状况的逻辑表达式。<br>触发器表达式允许定义一个什么状况的数据是“可接受”的阈值。如果超过了可接受状态，则触发器会被触发。</p>
<p><br></p>
<h3 id="配置一个触发器-configuring-a-trigger"><a href="#配置一个触发器-configuring-a-trigger" class="headerlink" title="配置一个触发器(configuring a trigger)"></a>配置一个触发器(configuring a trigger)</h3><p>在主机里面配置触发器。</p>
<p><br></p>
<h3 id="触发器表达式-trigger-expression"><a href="#触发器表达式-trigger-expression" class="headerlink" title="触发器表达式(trigger expression)"></a>触发器表达式(trigger expression)</h3><p>一个简单有效的表达式看起来像：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;&lt;server&gt;:&lt;key&gt;.&lt;<span class="keyword">function</span>&gt;(&lt;parameter&gt;)&#125;&lt;operator&gt;&lt;constant&gt;</div><div class="line"></div><div class="line"><span class="comment">#如</span></div><div class="line">&#123;192.168.1.7:agent.ping.time()&#125;=0</div></pre></td></tr></table></figure>
<p><strong>函数参数(function parameters)：</strong></p>
<p>大多数数字型的函数接受秒数来作为参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#600s内所有值的总和</div><div class="line">sum(600)</div><div class="line"></div><div class="line">#随后5个值总和</div><div class="line">sum(#5)</div><div class="line"></div><div class="line">avg()</div><div class="line">count()</div><div class="line">last()</div><div class="line">min()</div><div class="line">max()</div><div class="line"></div><div class="line">#5m 可被 300s 代替</div><div class="line">#1k 代表 1024bytes</div></pre></td></tr></table></figure>
<p><strong>运算符(operators)：</strong></p>
<table>
<thead>
<tr>
<th>优先级</th>
<th>运算符</th>
<th>定义</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>-</td>
<td>负号(minus)</td>
</tr>
<tr>
<td>2</td>
<td>not</td>
<td>逻辑非(NOT)</td>
</tr>
<tr>
<td>3</td>
<td>*, /</td>
<td>乘，除</td>
</tr>
<tr>
<td>4</td>
<td>+, -</td>
<td>加，减</td>
</tr>
<tr>
<td>5</td>
<td>&lt;, &lt;=, &gt;, &gt;=</td>
<td>-</td>
</tr>
<tr>
<td>6</td>
<td>=, &lt;&gt;</td>
<td>相等，不等于</td>
</tr>
<tr>
<td>7</td>
<td>and</td>
<td>逻辑与</td>
</tr>
<tr>
<td>8</td>
<td>or</td>
<td>逻辑或</td>
</tr>
</tbody>
</table>
<p><strong>触发器示例：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;www.zabbix.com:system.cpu.load[all,avg1].last()&#125;&gt;5</div><div class="line"></div><div class="line">&#123;www.zabbix.com:system.cpu.load[all,avg1].last()&#125;&gt;5 or &#123;www.zabbix.com:system.cpu.load[all,avg1].min(10m)&#125;&gt;2</div><div class="line"></div><div class="line">&#123;www.zabbix.com:net.if.in[eth0,bytes].min(5m)&#125;&gt;100k</div><div class="line"></div><div class="line">&#123;<span class="variable">$url1</span>:net.tcp.service[smtp].last()&#125;=0 and &#123;<span class="variable">$url2</span>:net.tcp.service[smtp].last()&#125;=0</div><div class="line"></div><div class="line">&#123;<span class="variable">$host</span>:icmpping.count(30m,0)&#125;&gt;5</div><div class="line"></div><div class="line">&#123;<span class="variable">$host</span>:system.cpu.load[all,avg1].min(5m)&#125;&gt;2 and &#123;<span class="variable">$hsot</span>:system.cpu.load[all,avg1].time()&#125;&gt;000000 and &#123;<span class="variable">$host</span>:system.cpu.load[all,avg1].time)()&#125;&lt;060000</div><div class="line"></div><div class="line">...</div></pre></td></tr></table></figure>
<p><strong>滞后(Hysteresis):</strong></p>
<p>有时候需要一个触发器状态OK和PROBLEM之间的间隔，而不是简单的阈值。</p>
<p>要做到这一点，我们首先定义一个PROBLEM事件的触发器表达式，然后为OK选择 ‘Recovery expression’，并未OK事件书如不同的表达式</p>
<p>如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#Problem expression</div><div class="line">&#123;server:temp.last()&#125;&gt;20</div><div class="line"></div><div class="line">#Recovery expression</div><div class="line">&#123;server:temp.last()&#125;&lt;=15</div><div class="line"></div><div class="line">#两者之间便有了几个滞后值</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="触发器依赖-trigger-dependency"><a href="#触发器依赖-trigger-dependency" class="headerlink" title="触发器依赖(trigger dependency)"></a>触发器依赖(trigger dependency)</h3><p>有时候，一台主机的可用性取决于另一台主机。如一台路由器后的上网设备。<br>这就是主机之间某些依赖关系可能有用的地方，依赖关系设置的通知可能会被抑制，而只发送根本问题的通知。</p>
<p>zabbix中触发器的依赖，一个触发器可能有多个依赖于它的触发器。</p>
<p>路由器和路由器后的Server同时宕机，如果有依赖关系，则zabbix不会执行服务器的触发动作。<br>值得注意的是，如果触发器所依赖的触发器被禁用，则次触发器的事件和动作将不会被抑制。</p>
<p><br></p>
<h3 id="批量更新"><a href="#批量更新" class="headerlink" title="批量更新"></a>批量更新</h3><p>使用批量更新，可一次更改一些触发器的某些属性。</p>
<p><br></p>
<h3 id="触发器严重性-trigger-severity"><a href="#触发器严重性-trigger-severity" class="headerlink" title="触发器严重性(trigger severity)"></a>触发器严重性(trigger severity)</h3><p>触发器严重性定义了触发器的重要程度:</p>
<ol>
<li>未分类(not classified), 灰色</li>
<li>信息(information), 淡蓝</li>
<li>警告(warning), 黄色</li>
<li>一般严重(average), 橙色</li>
<li>严重(High), 淡红</li>
<li>灾难(disaster), 红色</li>
</ol>
<p><br></p>
<h3 id="自定义触发器严重性-customising-trigger"><a href="#自定义触发器严重性-customising-trigger" class="headerlink" title="自定义触发器严重性(customising trigger)"></a>自定义触发器严重性(customising trigger)</h3><p>在 管理 – 一般 – 触发器严重性，里面自定义触发器严重性。</p>
<p><br></p>
<h3 id="预测触发功能-predictive-trigger-function"><a href="#预测触发功能-predictive-trigger-function" class="headerlink" title="预测触发功能(predictive trigger function)"></a>预测触发功能(predictive trigger function)</h3><p>有时候有即将到来的问题的迹象。可以发现这些迹象，以便提前采取行动，以减小影响。</p>
<p>zabbix具有基于历史数据预测受监视系统的未来行为的工具，这些工具通过预测触发功能实现。</p>
<p><br></p>
<h3 id="事件标签-event-tag"><a href="#事件标签-event-tag" class="headerlink" title="事件标签(event tag)"></a>事件标签(event tag)</h3><p>在zabbix中可以自定义事件标签，在触发器级别上定义事件标签。在事件标签定以后，相应的新事件被标记为时间标签数据。<br>在拥有自定义时间标签的情况下，可以变得更加灵活。</p>
<p>例如：</p>
<ol>
<li>识别日志文件中的问题并单独关闭他们；</li>
<li>用它来过滤通知；</li>
<li>查看前端的事件标签信息；</li>
<li>从项目值中提取的信息作为标签值；</li>
<li>在通知中更好地识别问题；</li>
<li>通过使用模板级别的标签来建华配置任务；</li>
<li>使用低级别发现的标签创建触发器。</li>
</ol>
<p><br><br><br></p>
<h2 id="事件-Events"><a href="#事件-Events" class="headerlink" title="事件(Events)"></a>事件(Events)</h2><p>zabbix可以生成一下几种类型的事件：</p>
<ol>
<li>trigger events-触发器事件；</li>
<li>discovery events-发现事件；</li>
<li>auto registration events-自动注册事件；</li>
<li>internal events-内部事件；</li>
</ol>
<p>事件以时间戳，并可以发送Email等基础动作。<br>在 监控-问题 里面查看信息信息。</p>
<p><br></p>
<h3 id="触发器事件生成-trigger-events-generation"><a href="#触发器事件生成-trigger-events-generation" class="headerlink" title="触发器事件生成(trigger events generation)"></a>触发器事件生成(trigger events generation)</h3><p>触发器状态的变化是事件最常见和最重要的来源。每次触发器的状态改变时，都会生成一个事件。<br>改时间包含了触发器状态变更的详细信息、发生时间以及信息的状态。</p>
<p>触发器会创建两种类型的事件：问题(problem)和正常(OK)</p>
<p><br></p>
<h3 id="手动关闭问题事件-manual-closing-of-problems"><a href="#手动关闭问题事件-manual-closing-of-problems" class="headerlink" title="手动关闭问题事件(manual closing of problems)"></a>手动关闭问题事件(manual closing of problems)</h3><p>当触发器状态从“问题(problem)”变成“正常(OK)”时，很难判断是通过触发器表达式的方式解决。这时就需要手动解决。</p>
<p>只有在触发器中启用 “允许手动关闭” 选项，问题事件才可以被手动关闭。</p>
<p><br></p>
<h3 id="其他事件来源-other-event-source"><a href="#其他事件来源-other-event-source" class="headerlink" title="其他事件来源(other event source)"></a>其他事件来源(other event source)</h3><p>zabbix定期扫描网络发现规则中定义的IP范围，可以为每个规则单独配置检查频率。一旦发现主机或服务，就会生成一个发现事件。</p>
<p>zabbix可以生成以下事件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Service Up/Down</div><div class="line">Host Up/Down</div><div class="line">Service Discovered/Lost</div><div class="line">Host Discovered/Lost</div></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="事件关联-event-correlation"><a href="#事件关联-event-correlation" class="headerlink" title="事件关联(event correlation)"></a>事件关联(event correlation)</h2><p>通常，在zabbix中正常事件会关闭所有的问题事件，但在某些情况下需要更细致的方法。可以根据<strong>事件标签</strong>关联问题事件。<br>如，当监控日志文件时，在日志文件中想要发现某些问题，并将它们单独关闭，而不是一起关闭。</p>
<p><br><br><br></p>
<h2 id="可视化-visualisation"><a href="#可视化-visualisation" class="headerlink" title="可视化(visualisation)"></a>可视化(visualisation)</h2><h3 id="图形-graphs"><a href="#图形-graphs" class="headerlink" title="图形(graphs)"></a>图形(graphs)</h3><p>大量的监控数据被采集到zabbix中，如果能用可视化的表现形式来查看，那就直观和容易多了。</p>
<p>zabbix为用户提供了如下图形：</p>
<ol>
<li>监控项数据的内置简单图形 “simple graphs”；</li>
<li>创建更复杂的自定义图形 “customised graphs”；</li>
<li>特定图形 “ad-hosc graphs”快速访问几个监控项的数据比较。</li>
</ol>
<p><strong>简单图形(simple graphs)：</strong><br>zabbix提供的简单图形，用来可视化显示监控项采集到的数据。并不需要配置就可以查看。</p>
<p>通过 监控-最新数据-图形 来展示图形。</p>
<p><strong>自定义图形(customised graphs)：</strong><br>自定义图形，提供定制功能。这就有点厉害了。这个是手动配置的。<br>可以为单个主机、多个主机、单个模板、多个模板创建自定义图形。</p>
<p>在 配置-主机-图形-创建图形 里编辑图形属性；<br>图形编辑后可点击预览。</p>
<p><strong>特设图形(ad-hoc graphs)：</strong><br>简单图形和自定义图形都不允许快速创建多个监控项目数据的比较图形，工作量小且没有维护。</p>
<p>在 检测-最新数据-旋转监控项前复选框-显示数据图(显示堆叠数据图) 下， 里面也包含了 正常和层积 的图形风格。</p>
<p><br></p>
<h3 id="拓扑图-networking-maps"><a href="#拓扑图-networking-maps" class="headerlink" title="拓扑图(networking maps)"></a>拓扑图(networking maps)</h3><p>运维人员如果想要了解网络环境的基础设施状况，可以在zabbix中创建网络拓扑图。</p>
<p><strong>配置拓扑图(configurating network maps):</strong></p>
<p>在 监控-拓扑图 下，可以创建拓扑图。点击拓扑图中的 构造函数 选项，来打开编辑区域。<br>然后在编辑区域中添加元素和链接元素。</p>
<p><strong>链接指示器(link indicators):</strong><br>可以为网络拓扑图中的元素之间的链接分配一些触发器，当这些触发器状况为“Problem”时，可以在链接上体现出来。<br>如果多个触发器进入”Problem”状态，则严重程度最高的将决定链接的颜色和样式。</p>
<p><br></p>
<h3 id="聚合图形-screen"><a href="#聚合图形-screen" class="headerlink" title="聚合图形(screen)"></a>聚合图形(screen)</h3><p>在zabbix的聚合图形页面上，你可把各种来源的信息聚集到一起，一边在单个屏幕上快速查看。<br>在 监测-图形聚合 下，对其进行创建、配置、管理和查看。</p>
<p>基本上，聚合图形是一个表格，你选择把每个表格有多少单元格以及其中要显示的元素。<br>元素如下：</p>
<ul>
<li>简单图形；</li>
<li>简单图形原型；</li>
<li>用户自定义图形；</li>
<li>自定义图形原型；</li>
<li>拓扑图；</li>
<li>其他聚合图形；</li>
<li>纯文本信息；</li>
<li>服务器信息；</li>
<li>触发器信息；</li>
<li>主机/主机组信息；</li>
<li>系统状态；</li>
<li>数据概述；</li>
<li>时钟；</li>
<li>事件历史；</li>
<li>动作历史；</li>
<li>URL。</li>
</ul>
<p><br></p>
<h3 id="幻灯片演示-slide-shows"><a href="#幻灯片演示-slide-shows" class="headerlink" title="幻灯片演示(slide shows)"></a>幻灯片演示(slide shows)</h3><p>在幻灯片演示中，可以配置多个聚合图形以设定的间隔逐个显示。<br>在 监测-聚合图形-幻灯片演示 下。</p>
<p><br><br><br></p>
<h2 id="模板-template"><a href="#模板-template" class="headerlink" title="模板(template)"></a>模板(template)</h2><p>模板是可以方便地应用于多个主机的一组实体。</p>
<p><strong>配置模板(configuring a template)：</strong><br>配置模板需要首先通过定义一些参数来创建模板，然后添加实例。<br>在 配置-模板-创建模板</p>
<p><strong>链接模板(linking)：</strong><br>链接是将模板应用于主机的过程，之后主机将拥有模板的所有实体。</p>
<p><strong>嵌套(nesting)：</strong><br>嵌套是一种包含一个或多个其它模板的模板方式。<br>可以在一个嵌套模板中奖一些模板链接在一起。</p>
<p>嵌套的好处在于，您只需要讲一个模板链接到主机，并且主机会自动继承链接的模板的所有实体。</p>
<p><br><br><br></p>
<h2 id="事件通知-notifications-upon-events"><a href="#事件通知-notifications-upon-events" class="headerlink" title="事件通知(notifications upon events)"></a>事件通知(notifications upon events)</h2><p>当配置了一些项目和触发器，并且由于触发器改变状态，现在正在发生一些事件，之后就要考虑 action。<br>发送通知是zabbix提供的主要操作之一。</p>
<p>为了能够发送和接收通知，必须：</p>
<ol>
<li>定义一些media；</li>
<li>配置action，向指定的media发送消息。</li>
</ol>
<p>action由condition和operation组成。当条件满足是，执行操作。<br>操作主要是 <strong>发送消息</strong>和<strong>执行远程命令</strong>。</p>
<p><br></p>
<h3 id="media类型"><a href="#media类型" class="headerlink" title="media类型"></a>media类型</h3><p>媒体是zabbix中发送通知和警报的传送通道。</p>
<p><strong>E-mail:</strong></p>
<p>在 管理-媒体类型 下，配置Email。</p>
<p><strong>SMS：</strong></p>
<p>zabbix支持使用连接到zabbix-server的串行端口的串行GSM调制解调器发送SMS消息。</p>
<p>确保：</p>
<ul>
<li>串行设备的速度(在Linux下通常为/dev/ttyS0) 与 GSM调制解调器的速度相匹配。zabbix没有设置串行链路的速度，它使用默认设置。</li>
<li>zabbix用户对串行设备有读写访问权限。</li>
<li>GSM调制解调器输入PIN码，并在电源复位后保留PIN码。或者在SIM卡上禁用PIN。</li>
</ul>
<p>管理-媒体类型下<br>要为用户分配电话号码：管理-用户-报警媒介，添加报警媒介(如电话号码等)</p>
<p><strong>Jabber：</strong></p>
<p>zabbix支持发送jabber消息。</p>
<p><strong>Ez Texting：</strong></p>
<p>可以使用 zabbix技术合作伙伴 Ez Texting发送信息。</p>
<p><strong>脚本：</strong></p>
<p>警报脚本在zabbix服务器上执行，这些脚本位于服务器配置文件中定义的目录中(AlertScriptsPath)。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">cat /etc/zabbix/zabbix_server.conf</div><div class="line"></div><div class="line">AlertScriptsPath=/usr/lib/zabbix/alertscripts</div><div class="line"></div><div class="line"></div><div class="line">#创建报警脚本</div><div class="line">vim /usr/lib/zabbix/alertscripts/zabbix_test.sh</div><div class="line"></div><div class="line">#!/bin/bash</div><div class="line">to=$1</div><div class="line">subject=$2</div><div class="line">body=$3</div><div class="line"></div><div class="line"></div><div class="line">#可以同时给多个用户发送，用空格隔开</div><div class="line">cat &lt;&lt;EOF | mail -s &quot;$subject&quot; &quot;to&quot;</div><div class="line">$body</div><div class="line">EOF</div></pre></td></tr></table></figure></p>
<p>然后我们在创建脚本媒体的时候，写入相关参数。</p>
<p><br></p>
<h3 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h3><p>可以根据所有支持的类型的时间定义操作：</p>
<ul>
<li>触发事件：当trigger的状态从OK转到Problem或回转时；</li>
<li>发现事件；</li>
<li>自动注册事件；</li>
<li>内部事件；</li>
</ul>
<p>配置-动作-创建动作</p>
<h4 id="条件-condition"><a href="#条件-condition" class="headerlink" title="条件(condition)"></a>条件(condition)</h4><p>只有在事件与定义的条件匹配的情况下才执行操作。</p>
<p>注意运算类型：似与非似</p>
<h4 id="操作-operation"><a href="#操作-operation" class="headerlink" title="操作(operation)"></a>操作(operation)</h4><p>操作：发送信息，执行远程命令。</p>
<h5 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h5><h5 id="远程命令"><a href="#远程命令" class="headerlink" title="远程命令"></a>远程命令</h5><p>(不支持在zabbix-agent上执行远程命令，需要在zabbix-server到代理的命令才能直接连接。远程命令限制255字符，可以将过个命令放置于新行上来执行过个命令。及时目标主机处于维护状态，也会执行远程命令).</p>
<p>配置-动作-操作，在操作细节中修改操作类型为远程命令。</p>
<p>在Zabbix代理（自定义脚本）上执行的那些远程命令必须首先在相应的命令中启用 zabbix_agentd.conf.确保 EnableRemoteCommands 参数设置为 1 并取消注释。 如果更改此参数，请重新启动代理守护程序。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">vim /etc/zabbix/zabbix_agentd.conf</div><div class="line"></div><div class="line"></div><div class="line">EnableRemoteCommands=1</div><div class="line"></div><div class="line"></div><div class="line"><span class="built_in">cd</span> /usr/lib/zabbix/alertscripts</div><div class="line"><span class="comment">#或修改zabbix-server.conf中的文件位置</span></div><div class="line">vi sendmail.sh</div><div class="line"></div><div class="line"></div><div class="line">chown zabbix.zabbix ./sendmail.sh &amp;&amp; chmod a+x ./sendmail.sh</div></pre></td></tr></table></figure>
<p>接下来在动作中选择为执行远程命令，并在相应位置输入命令。</p>
<p><img src="/images/Zabbix/remotecommand.png" alt=""></p>
<p>支持自定义脚本、SSH、Telnet等方式。</p>
<p><strong>在信息中使用宏(using macros in messages)：</strong><br>在消息主题和消息文本中，可使用宏来更有效的问题报告。</p>
<p><strong>恢复操作(recovery operation):</strong><br>恢复操作允许在问题解决时通知我们。<br>恢复操作支持消息和远程命令。</p>
<p><br><br><br></p>
<h2 id="宏-macros"><a href="#宏-macros" class="headerlink" title="宏(macros)"></a>宏(macros)</h2><p>官方支持的宏的完整列表：<a href="https://www.zabbix.com/documentation/3.4/manual/appendix/macros/supported_by_location" target="_blank" rel="noopener">https://www.zabbix.com/documentation/3.4/manual/appendix/macros/supported_by_location</a></p>
<p>zabbix支持许多在多种情况下使用的宏。宏是一个变量，由如下特殊语法标识。</p>
<p>宏类似于全局变量，宏是特别有用的，特别是在报警动作中。对于不同的细节加上特定的宏，能够使报警信息更加详细。</p>
<p><code>{MACRO}</code></p>
<p>根据在上下文汇总，宏解析为一个特殊的值。有效地使用宏可以节省时间，并使zabbix更加高效。</p>
<p>宏可以在监控项键值参数中使用。宏只能用在监控项键值参数的一部分中。<br>如<code>item.key[server_{HOST.HOST}_local]</code> 。</p>
<p><img src="/images/Zabbix/MACRO.png" alt="宏"></p>
<p><br></p>
<h3 id="宏函数-macro-function"><a href="#宏函数-macro-function" class="headerlink" title="宏函数(macro function)"></a>宏函数(macro function)</h3><p>宏函数能提供自定义宏值的功能。</p>
<p>宏函数语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;&lt;macro&gt;.&lt;func&gt;(&lt;params&gt;)&#125;</div><div class="line"></div><div class="line">#&lt;macro&gt;, 要定义的宏</div><div class="line">#&lt;func&gt;, 要应用的函数</div><div class="line">#&lt;params&gt;, 以逗号分隔的函数参数列表</div><div class="line"></div><div class="line">#栗子</div><div class="line">&#123;&#123;ITEM.VALUE&#125;.regsub&#123;pattern, output&#125;&#125;</div></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="用户宏-user-macro"><a href="#用户宏-user-macro" class="headerlink" title="用户宏(user macro)"></a>用户宏(user macro)</h3><p>除了支持开箱即用的宏之外，zabbix还支持更灵活的用户宏。</p>
<p>用户宏可在全局、模板和主机级别进行定义。有一个特殊语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;$MACRO&#125;</div></pre></td></tr></table></figure></p>
<p>用户宏可用于：</p>
<ul>
<li>监控项名称；</li>
<li>监控项键值参数；</li>
<li>触发器名称和描述；</li>
<li>触发器表达式参数和常量；</li>
<li>许多其他位置。</li>
</ul>
<h3 id="自动发现宏-LLD"><a href="#自动发现宏-LLD" class="headerlink" title="自动发现宏(LLD)"></a>自动发现宏(LLD)</h3><p>有一种自动发现(LLD)函数中使用的宏类型，可用于创建监控项、触发器和图形原型。然后，当发现真实的文件系统、网络接口等，这些宏将替换为真实的值，并且以这些值来创建真实的监控项、触发器和图形。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;#MACRO&#125;</div></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="用户和用户组-user-and-group"><a href="#用户和用户组-user-and-group" class="headerlink" title="用户和用户组(user and group)"></a>用户和用户组(user and group)</h2><p>zabbix中所有用户都通过web前端去访问zabbix应用程序。并为每一个用户分配唯一的登录名和密码，被加密储存于zabbix数据库中。</p>
<p><strong>配置用户(configuring user)</strong><br>管理-用户，创建和管理用户。</p>
<p><strong>权限(permission)</strong><br>可定义相应的用户类型，如用户，管理员和超级管理员。</p>
<p><strong>用户组(groups)</strong><br>管理-用户组，创建和配置用户组。</p>
<p><br><br><br></p>
<hr>
<h1 id="服务监控-service-monitoring"><a href="#服务监控-service-monitoring" class="headerlink" title="服务监控(service monitoring)"></a>服务监控(service monitoring)</h1><p>服务监控，旨在帮助那些想要高级业务监控的人。<br>在很多情况下，我们关注的不是底层细节，而是提供的可用性服务。</p>
<p>服务是分层表示监控数据。</p>
<blockquote>
<p>IT</p>
<blockquote>
<p>Workstations</p>
<blockquote>
<p>workstation1<br>workstation2</p>
</blockquote>
<p>Services</p>
</blockquote>
</blockquote>
<p>配置-服务，最高节点的服务是’root’。<br>你可以通过添加低级服务节点和各个节点服务创建下层层次结构。</p>
<p><br></p>
<hr>
<p><br></p>
<h1 id="Web监控-web-monitoring"><a href="#Web监控-web-monitoring" class="headerlink" title="Web监控(web monitoring)"></a>Web监控(web monitoring)</h1><p>配置-主机-web监测，创建或修改web监测信息。<br>可使用zabbix检查几个网站可用性方面。(zabbix中包含libcurl库才行)</p>
<p>要使用web监控，需要定义web场景。包括一个或多个HTTP请求或步骤。Zabbix-Server根据预定义的命令周期性的执行这些步骤。</p>
<p>Web监测中的<strong>要求的字段(required string)</strong>支持正则表达式，所以这对于检索页面信息很有用。这个真的很有用！</p>
<p>所有web场景会收集下列数据：</p>
<ul>
<li>整个场景中所有步骤的平均下载速度；</li>
<li>失败的步骤数量；</li>
<li>最后一次错误信息</li>
</ul>
<p>web场景的所有步骤，都会收集下列数据：</p>
<ul>
<li>平均下载速度；</li>
<li>响应时间</li>
<li>HTTP状态吗</li>
</ul>
<p><br></p>
<h2 id="Web监控项-web-monitoring-items"><a href="#Web监控项-web-monitoring-items" class="headerlink" title="Web监控项(web monitoring items)"></a>Web监控项(web monitoring items)</h2><p>在创建web场景时，会自动添加一些新监控项进行监控。</p>
<p>创建场景后，zabbix会自动添加以下监控项进行监控，将它们链接到所选的应用程序。</p>
<ul>
<li>场景<scenario>的下载速度；</scenario></li>
<li>场景<scenario>的失败步骤；</scenario></li>
<li>场景<scenario>的最后一个错误消息；</scenario></li>
</ul>
<p><br></p>
<p><strong>举个栗子：</strong><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">##创建Web监测</span></div><div class="line"><span class="comment">#配置-主机-Web监测-创建web监测</span></div><div class="line"></div><div class="line">URL：web.zabbix.me/monitor.php</div><div class="line">要求的状态码：200</div><div class="line">超时：20s</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">##创建web监测触发器</span></div><div class="line"><span class="comment">#配置-主机-触发器-创建触发器</span></div><div class="line"></div><div class="line">严重性：一般严重</div><div class="line"><span class="comment">#触发条件：状态码!=200</span></div><div class="line">表达式：N&lt;&gt;200</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">##创建触发报警对应的动作</span></div><div class="line"><span class="comment">#配置-动作-创建动作</span></div><div class="line"></div><div class="line"><span class="comment">#触发条件</span></div><div class="line">触发器示警度=一般严重 or 触发器=web.zabbix.me</div><div class="line"></div><div class="line"><span class="comment">#操作：发送Email</span></div><div class="line">发送给zabbix administrator用户群组</div><div class="line">仅送到Email</div><div class="line">默认信息/自定义信息</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">##在媒体类型中定义Email相关信息</span></div><div class="line"><span class="comment">#管理-报警媒体类型-Email</span></div><div class="line"></div><div class="line">SMTP服务器：smtp.xxx.com</div><div class="line">smtp端口：465</div><div class="line">SMTP电邮：发件人Email</div><div class="line">安全链接：SSL/TLS</div><div class="line">认证：Usernameand passwd</div><div class="line">用户名：xxx</div><div class="line">密码： xxx</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">##接下来就可以测试接收报警Email了</span></div></pre></td></tr></table></figure></p>
<p><br><br><br></p>
<hr>
<h1 id="虚拟机监控-VM-monitoring"><a href="#虚拟机监控-VM-monitoring" class="headerlink" title="虚拟机监控(VM monitoring)"></a>虚拟机监控(VM monitoring)</h1><p>zabbix支持对VMware的监控，使用low-levle-discovery(LLD)自动发现VMware hypervisors和虚拟机，并根据事先定义的主机原型，为这些虚拟机建立主机，添加监控。</p>
<p>zabbix中提供了几个模板，可以直接用来解控VMware vCenter 或 ESX hypervisor。</p>
<p><br><br>虚拟机监控分为两个步骤：</p>
<ul>
<li>首先，zabbix是通过VMware collector进程来监控虚拟机。这些进程通过SOAP协议从VMware服务获取必要的信息，对其进行预处理并储存到zabbix-server共享内存中；</li>
<li>然后，zabbix-pollers通过zabbix简单检查VMware keys来检索这些数据。</li>
</ul>
<p>要使虚拟机监控正常工作，需要libxml2库和libcurl库的支持。</p>
<blockquote>
<p>配置-自动发现-创建自动发现<br>配置-主机-自动发现</p>
</blockquote>
<p><br><br><br></p>
<hr>
<h1 id="维护-maintenance"><a href="#维护-maintenance" class="headerlink" title="维护(maintenance)"></a>维护(maintenance)</h1><p>可在zabbix中为主机和主机组定义维护周期。<br>有两种维护类型：“继续对目标进行监控数据的收集” 和 “停止对目标进行监控数据的收集”</p>
<p>要在维护期间正常接收问题通知，必须在动作配置中的选项中取消选择暂停操作。<br>为了确保定期维护按照预期的时间进行，需要对zabbix的所有部分使用通用时区。</p>
<blockquote>
<p>配置-维护-创建维护期</p>
</blockquote>
<p>维护期的主机显示的是橙色背景！</p>
<p><br><br><br></p>
<hr>
<h1 id="事件确认-event-acknowledgment"><a href="#事件确认-event-acknowledgment" class="headerlink" title="事件确认(event acknowledgment)"></a>事件确认(event acknowledgment)</h1><p>zabbix中的问题事件可以由用户确认。</p>
<p>如果用户获得了有关问题时间的通知，可以访问zabbix前端，从时间导航到确认屏幕并确认问题。<br>当他们确认时，可输入评论或其他一些相关描述。<br>这样其他系统用户同样的问题，他们便会立即看到是否已被解决和目前的评论。</p>
<p>以这种方式，可以更协调的进行解决多个系统用户的问题的工作流程。</p>
<p>要确认事件，用户必须至少要有对相应触发器的读取权限。</p>
<p><br><br>在Dashboard下，在出现的问题里，点击确认，进入确认事件。<br>也可在监控-问题下查看问题详细信息。</p>
<p><br><br><br></p>
<hr>
<h1 id="配置导出-导入-Configuration-export-import"><a href="#配置导出-导入-Configuration-export-import" class="headerlink" title="配置导出/导入(Configuration export/import)"></a>配置导出/导入(Configuration export/import)</h1><p>zabbix导入/导出功能，使得可以在一个zabbix系统与另一个zabbix系统之间交换各种配置实体。<br>类似于数据库的导入导出。即也可以对zabbix做备份。</p>
<p>可导出/导入的对象有：主机组； 模板； 主机； 拓扑； 图片； 聚合图形； 值映射。</p>
<p>数据也可导出：</p>
<ul>
<li>XML - 在前端</li>
<li>XML or JSON - 在zabbix API</li>
</ul>
<p>导出的详细信息：</p>
<ul>
<li>所有支持的元素都导出到一个文件中；</li>
<li>不导出从连链接模板继承的主机和模板实体；</li>
<li>由低级别发现创建的实体依赖于他们的任何实体不会导出。</li>
</ul>
<p>导入详细信息：</p>
<ul>
<li>第一次遇到错误停止导入；</li>
<li>导入支持XML和JSON文件；</li>
<li>使用“删除缺失”选项导入主机/模板时，导入的XML文件中不存在主机/模板宏也将被删除。</li>
</ul>
<p><br><br><br></p>
<hr>
<h1 id="将Zabbix展现在Nginx上"><a href="#将Zabbix展现在Nginx上" class="headerlink" title="将Zabbix展现在Nginx上"></a>将Zabbix展现在Nginx上</h1><p>毕竟现在Nginx用的多，那就把Apache换成Nginx吧！</p>
<p>Nginx仓库:<a href="http://nginx.org/packages/" target="_blank" rel="noopener">http://nginx.org/packages/</a></p>
<p>自己安装Nginx:</p>
<ol>
<li>下载<code>nginx-release-xx.rmp</code>仓库源来安装；</li>
<li>手动创建<code>/etc/yum.repo.d/nginx.repo</code>；</li>
<li>直接下载<code>ngix.rpm</code>来安装；</li>
<li>直接下载源码来安装。</li>
</ol>
<p>相较于Apache，Nginx也只是配置个server就行了。优化什么的自己弄。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">vim /etc/nginx/conf.d/zabbix.conf</div><div class="line"></div><div class="line">server &#123;</div><div class="line">	listen 80;</div><div class="line">    server_name zabbix.me;</div><div class="line">    root /usr/share/zabbix;</div><div class="line"></div><div class="line">    access_log  /var/<span class="built_in">log</span>/nginx/zabbix.access.log  main;</div><div class="line"></div><div class="line">	allow 127.0.0.1;</div><div class="line">	allow Your-IP;</div><div class="line">    deny all;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">    	<span class="keyword">if</span> (!-f <span class="variable">$request_filename</span>) &#123;</div><div class="line">        	rewrite ^([^\?]+)$ /index.php?1=<span class="variable">$1</span> last;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ \.php$ &#123;</div><div class="line">    	root /usr/share/zabbix;</div><div class="line">        fastcgi_pass 127.0.0.1:9000;</div><div class="line">        fastcgi_index index.php;</div><div class="line">        fastcgi_param SCRIPT_FILENAME <span class="variable">$document_root</span>/<span class="variable">$fastcgi_script_name</span>;</div><div class="line">        include fastcgi_params;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">nginx -t</div><div class="line">systemctl start nginx</div></pre></td></tr></table></figure></p>
<p>下载就可以正常访问<code>zabbix-web</code>端了!</p>
<p><br><br><br></p>
<hr>
<h1 id="Zabbix监控"><a href="#Zabbix监控" class="headerlink" title="Zabbix监控"></a>Zabbix监控</h1><p>Zabbix自带的templates基本涵盖了大部分监控信息。</p>
<p>大部分操作系统：</p>
<ul>
<li>OS Linux;</li>
<li>OS AIx;</li>
<li>OS FreeBSD;</li>
<li>OS Solaris;</li>
<li>OS Windows;</li>
<li>…</li>
</ul>
<p>大部分服务：</p>
<ul>
<li>CPU;</li>
<li>Filesystems;</li>
<li>HTTP/HTTPS service;</li>
<li>Memory;</li>
<li>Network interfaces;</li>
<li>Processes;</li>
<li>Secutity;</li>
<li>Zabbix server/agent/Proxy;</li>
<li>SMTP,POP,SSH,NTP, service;</li>
<li>ICMP Ping;</li>
<li>SNMP;</li>
<li>…</li>
</ul>
<p>虚拟机：</p>
<ul>
<li>VM VMware;</li>
<li>VM WMware Hypervisor;</li>
<li>…</li>
</ul>
<p>网络设备：</p>
<ul>
<li>Cisco;</li>
<li>Huawei;</li>
<li>TPLink;</li>
<li>HP;</li>
<li>…</li>
</ul>
<p><br><br>除了Zabbix自带的templates，你还可以下载templates并导入zabbix-server。</p>
<p>例如PHP-FPM, MongoDB, Apache, Nginx, Redis等额外软件的监控就需要下载额外templates。</p>
<p><br><br><br></p>
<h2 id="监控MySQL"><a href="#监控MySQL" class="headerlink" title="监控MySQL"></a>监控MySQL</h2><h3 id="使用Zabbix自带模板监控MySQL"><a href="#使用Zabbix自带模板监控MySQL" class="headerlink" title="使用Zabbix自带模板监控MySQL"></a>使用Zabbix自带模板监控MySQL</h3><p>Zabbix默认带有MySQL的监控和模板，所以无需再去下载。不过需要配置用户，密码，主机，端口等信息。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">vim /etc/zabbix/zabbix-agentd.d/userparameter_mysql.conf</div><div class="line"></div><div class="line"><span class="comment">#For all the following commands HOME should be set to the directory that has .my.cnf file with password information.</span></div><div class="line"><span class="comment">#这句话叫我们新建一个带有mysql密码信息的.my.cnf文件</span></div><div class="line"><span class="comment">#并把此配置文件里面的HOME改为.my.cnf所的在目录</span></div><div class="line"><span class="comment">#.my.cnf文件里面的用户要对MySQL数据库有权限才行，没有权限请记得加</span></div><div class="line"></div><div class="line">[mysql]</div><div class="line">host=localhost</div><div class="line">user=zabbix</div><div class="line">password=zabiix</div><div class="line">socket=/var/lib/mysql/mysql.sock</div><div class="line"></div><div class="line">[mysqladmin]</div><div class="line">host=localhost</div><div class="line">user=root</div><div class="line">password=password</div><div class="line">socket=/var/lib/mysql/mysql.sock</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#测试</span></div><div class="line">zabbix_get -s 127.0.0.1 -k mysql.ping</div><div class="line"><span class="comment">#1</span></div></pre></td></tr></table></figure>
<p><br><br><br></p>
<h3 id="使用Percona插件监控MySQL"><a href="#使用Percona插件监控MySQL" class="headerlink" title="使用Percona插件监控MySQL"></a>使用Percona插件监控MySQL</h3><p>Zabbix默认带有MySQL的监控和模板，所以无需再去下载。不过需要配置用户，密码，主机，端口等信息。<br>但是Zabbix自带的MySQL监控太简陋了。<br>所以使用Percona提供的模板及监控。</p>
<p><br></p>
<p>Percona Monitoring Plugins-URL:  <a href="https://www.percona.com/downloads/percona-monitoring-plugins/LATEST/" target="_blank" rel="noopener">https://www.percona.com/downloads/percona-monitoring-plugins/LATEST/</a><br>Percona Monitoring Plugins for Zabbix- Instructions:  <a href="https://www.percona.com/doc/percona-monitoring-plugins/LATEST/zabbix/index.html" target="_blank" rel="noopener">https://www.percona.com/doc/percona-monitoring-plugins/LATEST/zabbix/index.html</a></p>
<p>此插件地址需要我们选择Percona-Version和Software平台。</p>
<p><img src="/images/Zabbix/mysql01.png" alt="Percona Monitoring Plugins"></p>
<p>选择平台后，我们只需安装zabbix的rpm包就好：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#安装rpm包</span></div><div class="line">yum install -y https://www.percona.com/downloads/percona-monitoring-plugins/percona-monitoring-plugins-1.1.7/binary/redhat/7/x86_64/percona-zabbix-templates-1.1.7-2.noarch.rpm</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#安装软件</span></div><div class="line"><span class="comment">#注意php版本问题</span></div><div class="line">yum install -y percona-zabbix-templates</div><div class="line"></div><div class="line">ls /var/lib/zabbix/percona</div><div class="line"><span class="comment">#scripts目录有.sh脚本文件</span></div><div class="line"><span class="comment">#templates目录有配置文件和模板文件</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#复制配置文件</span></div><div class="line">cp /var/lib/zabbix/percona/templates/userparameter_percona_mysql.conf /etc/zabbix/zabbix_agentd.d/</div><div class="line"><span class="comment">#我看了一下，这个配置文件和zabbix自带的MySQL配置文件一样</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#添加MySQL的相关信息</span></div><div class="line">vim /var/lib/zabbix/percona/scripts/ss_get_mysql_stats.php</div><div class="line"></div><div class="line"><span class="variable">$mysql_user</span> = <span class="string">'root'</span>;</div><div class="line"><span class="variable">$mysql_pass</span> = <span class="string">'password'</span>;</div><div class="line"><span class="variable">$mysql_port</span> = 3306;</div><div class="line"><span class="variable">$mysql_socket</span> = <span class="string">'/var/lib/mysql/mysql.sock'</span>;</div><div class="line"><span class="variable">$mysql_flags</span> = 0;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#测试脚本</span></div><div class="line">/var/lib/zabbix/percona/scripts/get_mysql_stats_wrapper.sh gg</div><div class="line"><span class="comment">#10</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#创建.my.cnf文件</span></div><div class="line">vim /etc/zabbix/zabbix_agentd.d/.my.cnf</div><div class="line"></div><div class="line">[mysql]</div><div class="line">host=localhost</div><div class="line">user=root</div><div class="line">password=password</div><div class="line">socket=/var/lib/mysql/mysql.sock</div><div class="line"></div><div class="line">[mysqladmin]</div><div class="line">host=localhost</div><div class="line">user=root</div><div class="line">password=password</div><div class="line">socket=/var/lib/mysql/mysql.sock</div><div class="line"></div><div class="line">[client]</div><div class="line">host=localhost</div><div class="line">user=root</div><div class="line">password=password</div><div class="line">socker=/var/lib/mysql/mysql.sock</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#重启服务</span></div><div class="line">systemctl restart zabbix-agent</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#测试</span></div><div class="line">sudo -u zabbix -H /var/lib/zabbix/percona/scripts/get_mysql_stats_wrapper.sh running-slave</div><div class="line"><span class="comment">#0/1</span></div></pre></td></tr></table></figure>
<p>导入模板，模板文件位于：<code>/var/lib/zabbix/percona/templates/zabbix_agent_template_percona_mysql_server_ht_2.0.9-sver1.1.7.xml</code></p>
<p>但我直接导入模板时报错——标签无效 “/zabbix_export/date”: “YYYY-MM-DDThh:mm:ssZ” 预计。<br>此模板需要先导入Zabbix2.4后再导出，然后再导入到Zabbix3.4。太麻烦。<br><img src="/images/Zabbix/mysql02.png" alt="导入percona模板"></p>
<p>所以需要下载修改过的模板： <a href="http://jaminzhang.github.io/soft-conf/Zabbix/zbx_percona_mysql_template.xml" target="_blank" rel="noopener">http://jaminzhang.github.io/soft-conf/Zabbix/zbx_percona_mysql_template.xml</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget http://jaminzhang.github.io/soft-conf/Zabbix/zbx_percona_mysql_template.xml</div></pre></td></tr></table></figure>
<p>下载之后导入模板，然后链接主机。<br>链接之后可以部分监控可能显示不支持的。</p>
<p>如：Received value [rm: 无法删除”/tmp/localhost-mysql_cacti_stats.txt”: 不允许的操作0] is not suitable for value type [Numeric (float)]<br>没有权限。<br><img src="/images/Zabbix/mysql03.png" alt=""></p>
<p>解决办法：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /tmp</div><div class="line">chown -R zabbix:zabbix localhost-mysql_cacti_stats.txt</div><div class="line"></div><div class="line">systemcet restart zabbix-agent</div></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="监控MongoDB"><a href="#监控MongoDB" class="headerlink" title="监控MongoDB"></a>监控MongoDB</h2><p><strong>感谢大神：</strong></p>
<ul>
<li>MongoDB-templates: <a href="https://share.zabbix.com/databases/mongodb/mongodb-for-zabbix-3-2" target="_blank" rel="noopener">https://share.zabbix.com/databases/mongodb/mongodb-for-zabbix-3-2</a> ;</li>
<li>GitHub: <a href="https://github.com/oscm/zabbix/tree/master/mongodb" target="_blank" rel="noopener">https://github.com/oscm/zabbix/tree/master/mongodb</a></li>
<li>此github-repo中还包含了<code>Oracle</code>, <code>php-fpm</code>, <code>postfix</code>, <code>redis</code>, <code>Nginx</code>。可参看README.md来配置zabbix对它们的监控。</li>
</ul>
<p><br></p>
<p><img src="/images/Zabbix/zabbix_master.png" alt="./master"></p>
<p><br></p>
<h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><p><strong>1. 在zabbix-agent安装<code>jq</code></strong><br>jq - Command-line JSON processor;</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y jq</div></pre></td></tr></table></figure>
<p><br><br><strong>2. 在zabbix-agent的MongoDB中创建用于监控的账号</strong><br>创建用于读取MongoDB相关信息的账户及其权限。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">mongo</div><div class="line"></div><div class="line">&gt;use admin</div><div class="line"></div><div class="line">&gt;db.createUser(</div><div class="line">  &#123;</div><div class="line">	user:<span class="string">'zabbix'</span>,</div><div class="line">	<span class="built_in">pwd</span>:<span class="string">'zabbix'</span>,</div><div class="line">	roles:[&#123;</div><div class="line">		role:<span class="string">'clusterMonitor'</span>,</div><div class="line">		db:<span class="string">'admin'</span>&#125;]</div><div class="line">  &#125;</div><div class="line">)</div></pre></td></tr></table></figure>
<p><br><br><strong>3. 在agent下载github仓库的MongoDB模板等文件</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">wget https://codeload.github.com/oscm/zabbix/zip/master -O master.zip</div><div class="line"><span class="comment">#这里面不仅仅有mongodb，还有redis,php等。</span></div><div class="line"><span class="comment">#我们只需要进入mongodb目录就好</span></div><div class="line"></div><div class="line">unzip master.zip</div><div class="line"></div><div class="line"></div><div class="line"><span class="built_in">cd</span> ./zabbix-master/mongodb</div><div class="line">ls</div><div class="line"></div><div class="line"><span class="comment">#mongodb.sh , 执行脚本</span></div><div class="line"><span class="comment">#userparameter_mongodb.conf ，配置脚本</span></div><div class="line"><span class="comment">#zbx_export_templates.xml，zabbix模板文件</span></div></pre></td></tr></table></figure>
<p><img src="/images/Zabbix/zabbix_mongodb1.png" alt="./master/mongodb"></p>
<p><br><br><strong>4. 移动并配置mongodb.sh</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">cp ./mongodb.sh /etc/zabbix</div><div class="line"></div><div class="line">chmod a+x /etc/zabbix/mongodb.sh</div><div class="line"></div><div class="line"></div><div class="line">vi mongodb.sh</div><div class="line"></div><div class="line"><span class="comment">#如果HOST,PORT不是默认，请修改</span></div><div class="line">DB_HOST=127.0.0.1</div><div class="line">DB_PORT=27017</div><div class="line">DB_USERNAME=zabbix</div><div class="line">DB_PASSWORD=zabbix</div></pre></td></tr></table></figure>
<p><img src="/images/Zabbix/zabbix_mongodb2.png" alt="mongodb.sh"></p>
<p><br><br><strong>5. 移动并修改userparameter_mongodb.conf</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">cp ./zabbix-master/userparameter_mongodb.conf /etc/zabbix/zabbix_agentd.d</div><div class="line"></div><div class="line">vi ./userparameter_mongodb.conf</div><div class="line"></div><div class="line">UserParameter=mongodb.status[*],/etc/zabbix/mongodb.sh <span class="variable">$1</span> <span class="variable">$2</span> <span class="variable">$3</span> <span class="variable">$4</span> <span class="variable">$5</span></div><div class="line"><span class="comment">#修改为mongdb.sh真实位置</span></div><div class="line"><span class="comment">#这个是用户自定义的参数，可以之间写入到zabbix_agent.conf里面</span></div></pre></td></tr></table></figure>
<p><img src="/images/Zabbix/zabbix_mongodb3.png" alt="userparameter_mongodb.conf"></p>
<p><br><br><strong>6. 重启zabbix-agent</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl restart zabbix-agent</div></pre></td></tr></table></figure>
<p><br><br><strong>7. 在zabbix-web导入mongodb模板</strong></p>
<ul>
<li>配置-模板-导入模板；</li>
<li>选择<code>./master/mongodb/zbx_export_templates.xml</code>模板文件，并导入；</li>
<li>接下来便可以在 templates中看到”Template App MongoDB”这个模板；</li>
<li>可将此模板链接到某个主机上监控，并到最新数据里查看相关MongoDB信息；</li>
<li>如果相对此模板就行修改，可编辑zbx_export_templates.xml文件。</li>
</ul>
<p><br></p>
<p><img src="/images/Zabbix/zabbix_web_import_mongodb1.png" alt="导入mongodb模板"><br><img src="/images/Zabbix/zabbix_web_import_mongodb2.png" alt="选择导入文件"><br><img src="/images/Zabbix/zabbix_web_import_mongodb3.png" alt="查看MongoDB模板"><br><img src="/images/Zabbix/zabbix_web_import_mongodb4.png" alt="在主机中关联MongoDB模板"><br><img src="/images/Zabbix/zabbix_web_import_mongodb5.png" alt="查看最新MongoDb数据"></p>
<p><br></p>
<h3 id="监控一台主机上的额外mongod实例"><a href="#监控一台主机上的额外mongod实例" class="headerlink" title="监控一台主机上的额外mongod实例"></a>监控一台主机上的额外mongod实例</h3><p>由于可能一台主机上运行的mongod实例不止一个，所以我们需要修改一下前面下载的配置文件，用以监控其它端口的mongod实例。</p>
<ul>
<li>此处假设默认的mongod实例运行在27017端口上</li>
<li>另外还有一个mongod实例运行在27018端口上</li>
<li>此处假设我们已经完成了前面对27017mongodb的监控了</li>
</ul>
<p>操作：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /etc/zabbix</div><div class="line">cp mongodb.sh mongodb_27018.sh</div><div class="line"></div><div class="line">vim ./mongodb_27018.sh</div><div class="line"><span class="comment">#配置监控的mongodb账号和端口</span></div><div class="line"></div><div class="line">DB_HOST=127.0.0.1</div><div class="line">DB_PORT=27018</div><div class="line">DB_USERNAME=zabbix</div><div class="line">DB_PASSWORD=zabbix</div><div class="line"></div><div class="line"><span class="comment">#现在就有了提取27017/27018两个mongodb实例的脚本</span></div><div class="line"><span class="comment">#mongodb.sh</span></div><div class="line"><span class="comment">#mongodb_27018.sh</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="built_in">cd</span> ./zabbxi-agentd.d</div><div class="line"></div><div class="line">vim userparameter_mongodb.conf</div><div class="line"><span class="comment">#在默认的27017下面添加一行提取mongodb_27018信息的脚本</span></div><div class="line"></div><div class="line">UserParameter=mongodb.status[*],/etc/zabbix/mongodb.sh <span class="variable">$1</span> <span class="variable">$2</span> <span class="variable">$3</span> <span class="variable">$4</span> <span class="variable">$5</span></div><div class="line">UserParameter=mongodb_27018.status[*],/etc/zabbix/mongodb_27018.sh <span class="variable">$1</span> <span class="variable">$2</span> <span class="variable">$3</span> <span class="variable">$4</span> <span class="variable">$5</span></div><div class="line"></div><div class="line"><span class="comment">#现在zabbix-server端就可以同时获取27017/27018两个mongodb实例的信息</span></div><div class="line"><span class="comment">#但是Web界面还不能直接显示出来，因为27018的键值和默认不相同</span></div><div class="line"><span class="comment">#没错，就是上面我们修改的 mongodb_27018.status[*]</span></div></pre></td></tr></table></figure>
<p><br></p>
<p><img src="/images/Zabbix/mongodb_27018.png" alt="mongodb_27018.sh"></p>
<p><img src="/images/Zabbix/mongodb_27018_02.png" alt="mongodb_27018.sh"></p>
<p><br></p>
<p><strong>接下来要在Zabbix-Web端配置监控项用以提取信息</strong></p>
<p>我们先找到一个默认的MongoDB自带的配置模板，如<code>MongoDB Connections current</code>，点进去查看它的键值对为<code>mongodb.status[connections,current]</code></p>
<p>因此我们只需要修改为我们配置文件里面的<code>mongodb_27018.status[*]</code>就可以了。</p>
<p><img src="/images/Zabbix/mongodb_27018_03.png" alt="mongodb_27018.sh"></p>
<p><img src="/images/Zabbix/mongodb_27018_04.png" alt="mongodb_27018.sh"></p>
<p><br></p>
<p>其余个监控项以此类推，我觉得其他服务也应该可以如此。</p>
<p><strong>你也可以对此建立一个单独的模板，如MongoDB_27108 templates。在此监控模板下创建上面的监控项。这样就可以对所有主机生效了。也可以批量化操作，更方便一些。</strong></p>
<p>下面是我的参考<strong>Template App MongoDB</strong>模板建立的<strong>Template App MongoDB_27018</strong></p>
<p><img src="/images/Zabbix/mongodb_27018_05.png" alt="mongodb_27018.sh"></p>
<p><img src="/images/Zabbix/mongodb_27018_06.png" alt="mongodb_27018.sh"></p>
<p><br><br><br></p>
<h2 id="监控PHP-FPM"><a href="#监控PHP-FPM" class="headerlink" title="监控PHP-FPM"></a>监控PHP-FPM</h2><p>同样使用上面大神的模板。</p>
<p>步骤和监控MongoDB类似：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#进入下载的文件目录</span></div><div class="line"><span class="built_in">cd</span> ./zabbix-master/php-fpm</div><div class="line">cp ./php-fpm.xml.sh /etc/zabbix</div><div class="line">chmod a+x /etc/zabbix/php-fpm.xml.sh</div><div class="line">vim /etc/zabbix/php-fpm.xml.sh</div><div class="line"></div><div class="line"><span class="comment">#如果这三个参数修改了，请修改</span></div><div class="line"><span class="comment">#因为是使用culr，所以请允许此IP能够访问此页面</span></div><div class="line"><span class="comment">#另外还要Nginx允许Server-IP访问哦，不然无法读取数据</span></div><div class="line"><span class="comment">#我测试的时候用IP无法获取数据，所以用的域名</span></div><div class="line"><span class="comment">#如果没做域名解析，请加本地hosts</span></div><div class="line"><span class="comment">#php-fpm_status使用我修改的</span></div><div class="line"></div><div class="line">HOST=<span class="string">"localhost"</span></div><div class="line">PORT=<span class="string">"80"</span></div><div class="line"><span class="comment">#status="status"</span></div><div class="line">status=<span class="string">"php-fpm_status"</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">cp ./userparameter_php-fpm.conf /etc/zabbix/zabbix_agent.d/</div><div class="line"><span class="comment">#当然也可以把这个用户自定义参数写入zabbix_agent.conf</span></div><div class="line"><span class="comment">#修改自定义参数里面的文件位置</span></div><div class="line">vim /etc/zabbix/zabbix_agent.d/userparameter_php-fpm.conf</div><div class="line"></div><div class="line">UserParameter=php-fpm.status[*],/etc/zabbix/php-fpm.xml.sh <span class="variable">$1</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#php-fpm，nginx的状态必须用Nginx展现，Zabbix-Server是使用curl提取状态页面的信息</span></div><div class="line">vim /etc/nginx/conf.d/zabbix.conf</div><div class="line"></div><div class="line">server &#123;</div><div class="line">	listen 80;</div><div class="line">    server_name zabbix.me localhost;</div><div class="line"><span class="comment">#如果localhost与其他配置文件冲突，那就用IP</span></div><div class="line"><span class="comment">#server_name zabbix.me 127.0.0.1 Private-IP Public-IP;</span></div><div class="line">    root /usr/share/zabbix;</div><div class="line"></div><div class="line">    access_log  /var/<span class="built_in">log</span>/nginx/zabbix.access.log  main;</div><div class="line"></div><div class="line"><span class="comment">#allow无法使用localhost，所有内外网要分开写</span></div><div class="line">	allow 127.0.0.1;</div><div class="line">	allow Private-IP;</div><div class="line">	allow Public-IP;</div><div class="line">	allow Zabbix-Server-IP;</div><div class="line">	allow Remote-View-IP;</div><div class="line">	deny all;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">    	<span class="keyword">if</span> (!-f <span class="variable">$request_filename</span>) &#123;</div><div class="line">			rewrite ^([^\?]+)$ /index.php?1=<span class="variable">$1</span> last;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#Nignx_Status</span></div><div class="line">    location /nginx_status &#123;</div><div class="line">        stub_status on;</div><div class="line">        <span class="comment">#开启nginx自带的状态检查功能</span></div><div class="line">        access_log off;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#php-fpm_Status</span></div><div class="line"><span class="comment">#php-fpm的默认状态页面是/status,/ping。我修改了一下。</span></div><div class="line">    location ~ ^/php-fpm_(status|ping)$ &#123;</div><div class="line">    	access_log off;</div><div class="line">        fastcgi_pass 127.0.0.1:9000;</div><div class="line">        fastcgi_index index.php;</div><div class="line">        fastcgi_param SCRIPT_FILENAME <span class="variable">$document_root</span>/<span class="variable">$fastcgi_script_name</span>;</div><div class="line">        include fastcgi_params;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    location ~ \.php$ &#123;</div><div class="line">    	root /usr/share/zabbix;</div><div class="line">        fastcgi_pass 127.0.0.1:9000;</div><div class="line">        fastcgi_index index.php;</div><div class="line">        fastcgi_param SCRIPT_FILENAME <span class="variable">$document_root</span>/<span class="variable">$fastcgi_script_name</span>;</div><div class="line">        include fastcgi_params;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="/images/Zabbix/zabbix-master_php-fpm.png" alt="监控php-fpm"></p>
<p><br></p>
<p><strong>php-fpm状态页面的配置文件</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div></pre></td><td class="code"><pre><div class="line">vim /etc/php-fpm.d/www.conf</div><div class="line"></div><div class="line"><span class="comment">#说明和用法如下，我做简单修改</span></div><div class="line"><span class="comment">#修改默认值</span></div><div class="line">;pm.status_path = /status</div><div class="line">pm.status_path = /php-fpm_status</div><div class="line"></div><div class="line">;ping.path = /ping</div><div class="line">ping.path = /php-fpm_ping</div><div class="line">;ping.response = pong</div><div class="line">ping.response = 200</div><div class="line"></div><div class="line"><span class="comment">#用法</span></div><div class="line">zabbix.me/php-fpm_status</div><div class="line">zabbix.me/php-fpm_ping</div><div class="line"></div><div class="line"><span class="comment">#配置文件提供了格式化输出</span></div><div class="line">zabbix.me/php-fpm_status?html</div><div class="line">zabbix.me/php-fpm_status?html&amp;full</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">; output syntax. Example:</div><div class="line">;   http://www.foo.bar/status</div><div class="line">;   http://www.foo.bar/status?json</div><div class="line">;   http://www.foo.bar/status?html</div><div class="line">;   http://www.foo.bar/status?xml</div><div class="line">;   http://www.foo.bar/status?full</div><div class="line">;   http://www.foo.bar/status?json&amp;full</div><div class="line">;   http://www.foo.bar/status?html&amp;full</div><div class="line">;   http://www.foo.bar/status?xml&amp;full</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#修改完毕后重启服务</span></div><div class="line">systemctl restart php-fpm nginx</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#具体看下面描述</span></div><div class="line"><span class="comment">##这下面是说明</span></div><div class="line"></div><div class="line">; The URI to view the FPM status page. If this value is not <span class="built_in">set</span>, no URI will be</div><div class="line">; recognized as a status page. It shows the following informations:</div><div class="line">;   pool                 - the name of the pool;</div><div class="line">;   process manager      - static, dynamic or ondemand;</div><div class="line">;   start time           - the date and time FPM has started;</div><div class="line">;   start since          - number of seconds since FPM has started;</div><div class="line">;   accepted conn        - the number of request accepted by the pool;</div><div class="line">;   listen queue         - the number of request <span class="keyword">in</span> the queue of pending</div><div class="line">;                          connections (see backlog <span class="keyword">in</span> listen(2));</div><div class="line">;   max listen queue     - the maximum number of requests <span class="keyword">in</span> the queue</div><div class="line">;                          of pending connections since FPM has started;</div><div class="line">;   listen queue len     - the size of the socket queue of pending connections;</div><div class="line">;   idle processes       - the number of idle processes;</div><div class="line">;   active processes     - the number of active processes;</div><div class="line">;   total processes      - the number of idle + active processes;</div><div class="line">;   max active processes - the maximum number of active processes since FPM</div><div class="line">;                          has started;</div><div class="line">;   max children reached - number of <span class="built_in">times</span>, the process <span class="built_in">limit</span> has been reached,</div><div class="line">;                          when pm tries to start more children (works only <span class="keyword">for</span></div><div class="line">;                          pm <span class="string">'dynamic'</span> and <span class="string">'ondemand'</span>);</div><div class="line">; Value are updated <span class="keyword">in</span> real time.</div><div class="line">; Example output:</div><div class="line">;   pool:                 www</div><div class="line">;   process manager:      static</div><div class="line">;   start time:           01/Jul/2011:17:53:49 +0200</div><div class="line">;   start since:          62636</div><div class="line">;   accepted conn:        190460</div><div class="line">;   listen queue:         0</div><div class="line">;   max listen queue:     1</div><div class="line">;   listen queue len:     42</div><div class="line">;   idle processes:       4</div><div class="line">;   active processes:     11</div><div class="line">;   total processes:      15</div><div class="line">;   max active processes: 12</div><div class="line">;   max children reached: 0</div><div class="line">;</div><div class="line">; By default the status page output is formatted as text/plain. Passing either</div><div class="line">; <span class="string">'html'</span>, <span class="string">'xml'</span> or <span class="string">'json'</span> <span class="keyword">in</span> the query string will <span class="built_in">return</span> the corresponding</div><div class="line">; output syntax. Example:</div><div class="line">;   http://www.foo.bar/status</div><div class="line">;   http://www.foo.bar/status?json</div><div class="line">;   http://www.foo.bar/status?html</div><div class="line">;   http://www.foo.bar/status?xml</div><div class="line">;</div><div class="line">; By default the status page only outputs short status. Passing <span class="string">'full'</span> <span class="keyword">in</span> the</div><div class="line">; query string will also <span class="built_in">return</span> status <span class="keyword">for</span> each pool process.</div><div class="line">; Example:</div><div class="line">;   http://www.foo.bar/status?full</div><div class="line">;   http://www.foo.bar/status?json&amp;full</div><div class="line">;   http://www.foo.bar/status?html&amp;full</div><div class="line">;   http://www.foo.bar/status?xml&amp;full</div><div class="line">; The Full status returns <span class="keyword">for</span> each process:</div><div class="line">;   pid                  - the PID of the process;</div><div class="line">;   state                - the state of the process (Idle, Running, ...);</div><div class="line">;   start time           - the date and time the process has started;</div><div class="line">;   start since          - the number of seconds since the process has started;</div><div class="line">;   requests             - the number of requests the process has served;</div><div class="line">;   request duration     - the duration <span class="keyword">in</span> µs of the requests;</div><div class="line">;   request method       - the request method (GET, POST, ...);</div><div class="line">;   request URI          - the request URI with the query string;</div><div class="line">;   content length       - the content length of the request (only with POST);</div><div class="line">;   user                 - the user (PHP_AUTH_USER) (or <span class="string">'-'</span> <span class="keyword">if</span> not <span class="built_in">set</span>);</div><div class="line">;   script               - the main script called (or <span class="string">'-'</span> <span class="keyword">if</span> not <span class="built_in">set</span>);</div><div class="line">;   last request cpu     - the %cpu the last request consumed</div><div class="line">;                          it<span class="string">'s always 0 if the process is not in Idle state</span></div><div class="line"><span class="string">;                          because CPU calculation is done when the request</span></div><div class="line"><span class="string">;                          processing has terminated;</span></div><div class="line"><span class="string">;   last request memory  - the max amount of memory the last request consumed</span></div><div class="line"><span class="string">;                          it'</span>s always 0 <span class="keyword">if</span> the process is not <span class="keyword">in</span> Idle state</div><div class="line">;                          because memory calculation is <span class="keyword">done</span> when the request</div><div class="line">;                          processing has terminated;</div><div class="line">; If the process is <span class="keyword">in</span> Idle state, <span class="keyword">then</span> informations are related to the</div><div class="line">; last request the process has served. Otherwise informations are related to</div><div class="line">; the current request being served.</div><div class="line">; Example output:</div><div class="line">;   ************************</div><div class="line">;   pid:                  31330</div><div class="line">;   state:                Running</div><div class="line">;   start time:           01/Jul/2011:17:53:49 +0200</div><div class="line">;   start since:          63087</div><div class="line">;   requests:             12808</div><div class="line">;   request duration:     1250261</div><div class="line">;   request method:       GET</div><div class="line">;   request URI:          /test_mem.php?N=10000</div><div class="line">;   content length:       0</div><div class="line">;   user:                 -</div><div class="line">;   script:               /home/fat/web/docs/php/test_mem.php</div><div class="line">;   last request cpu:     0.00</div><div class="line">;   last request memory:  0</div><div class="line">;</div><div class="line">; Note: There is a real-time FPM status monitoring sample web page available</div><div class="line">;       It<span class="string">'s available in: @EXPANDED_DATADIR@/fpm/status.html</span></div><div class="line"><span class="string">;</span></div><div class="line"><span class="string">; Note: The value must start with a leading slash (/). The value can be</span></div><div class="line"><span class="string">;       anything, but it may not be a good idea to use the .php extension or it</span></div><div class="line"><span class="string">;       may conflict with a real PHP file.</span></div><div class="line"><span class="string">; Default Value: not set</span></div><div class="line"><span class="string">;pm.status_path = /status</span></div><div class="line"><span class="string">pm.status_path = /php-fpm_status</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">; The ping URI to call the monitoring page of FPM. If this value is not set, no</span></div><div class="line"><span class="string">; URI will be recognized as a ping page. This could be used to test from outside</span></div><div class="line"><span class="string">; that FPM is alive and responding, or to</span></div><div class="line"><span class="string">; - create a graph of FPM availability (rrd or such);</span></div><div class="line"><span class="string">; - remove a server from a group if it is not responding (load balancing);</span></div><div class="line"><span class="string">; - trigger alerts for the operating team (24/7).</span></div><div class="line"><span class="string">; Note: The value must start with a leading slash (/). The value can be</span></div><div class="line"><span class="string">;       anything, but it may not be a good idea to use the .php extension or it</span></div><div class="line"><span class="string">;       may conflict with a real PHP file.</span></div><div class="line"><span class="string">; Default Value: not set</span></div><div class="line"><span class="string">;ping.path = /ping</span></div><div class="line"><span class="string">ping.path = /php-fpm_ping</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">; This directive may be used to customize the response of a ping request. The</span></div><div class="line"><span class="string">; response is formatted as text/plain with a 200 response code.</span></div><div class="line"><span class="string">; Default Value: pong</span></div><div class="line"><span class="string">;ping.response = pong</span></div><div class="line"><span class="string">ping.response = 200</span></div></pre></td></tr></table></figure>
<p><br></p>
<p>效果图：</p>
<p><img src="/images/Zabbix/zabbix-master_php-fpm2.png" alt="将php-fpm状态展现在Nginx上"></p>
<p><br></p>
<p>展现的话是在Agent端的Nginx上，这个更直观一些。<br>而Zabbix-Server就是通过<code>curl -s zabbix.me</code>来获取数据的，并通过对数据的提取来返回给Zabbix-Server。<br>所以收集php-fpm，nginx的信息状态，都是基于这个页面的。</p>
<p>现在导入PHP-FPM模板，导入操作同MongoDB。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#就是这个文件</div><div class="line">zbx_export_templates.xml</div></pre></td></tr></table></figure>
<p>导入模板后，直接链接模板就可以啦。<br>然后就可以使用了。</p>
<p><br><br><br></p>
<h2 id="监控Nginx"><a href="#监控Nginx" class="headerlink" title="监控Nginx"></a>监控Nginx</h2><p>Zabbix是通过<code>stub_status</code>模块实现对Nginx的监控。<br>Nginx的ngx_http_stub_status_module模块提供了基本的Nginx状态信息，源码安装的话需要加上–with-http_stub_status_module编译参数，如果是epel源yum安装的话，已经默认启用该模块。</p>
<p>在Nginx配置文件中加入如下配置：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">location /nginx_status &#123;</div><div class="line">	allow IP;</div><div class="line">	deny all;</div><div class="line">	stub_status on;</div><div class="line">    access_log off;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#栗子</span></div><div class="line">Active connections: 14</div><div class="line">server accepts handled requests</div><div class="line"> 22889 22889 72510</div><div class="line">Reading: 0 Writing: 2 Waiting: 12</div></pre></td></tr></table></figure>
<p><img src="/images/Zabbix/nginx_status.png" alt="nginx_status栗子"></p>
<p><br></p>
<p>以上数据是通过Web端查看。<br>但，我们需要把数据收集到Zabbix-Server。还需要使用之前下载同MongoDB，php-fpm一起的那个包。</p>
<p><strong>操作，基本还是类似MongoDB，php-fpm。只是个别参数需要修改一下。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">cd ./zabbix-master/nginx/</div><div class="line">cp ./nginx.sh /etc/zabbix/</div><div class="line">chmod a+x /etc/zabbix/nginx.sh</div><div class="line"></div><div class="line">cp ./userparameter_nginx.conf /etc/zabbix/zabbix_agentd.d</div><div class="line"></div><div class="line"></div><div class="line">vim /etc/zabbix/nginx.sh</div><div class="line"></div><div class="line">#HOST=&quot;localhost&quot;</div><div class="line">PORT=&quot;80&quot;</div><div class="line">#stub_status=stub_status</div><div class="line">stub_status=nginx_status</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">vim /etc/zabbix/zabbix_agentd.d/userparameter_nginx.conf</div><div class="line"></div><div class="line">#修改成脚本对应的位置</div><div class="line">UserParameter=nginx.status[*],/etc/zabbix/nginx.sh $1</div></pre></td></tr></table></figure>
<p>现在想以前一样导入模板。<br>然后在链接模板就可以了。</p>
<p><br><br><br></p>
<h2 id="监控Redis"><a href="#监控Redis" class="headerlink" title="监控Redis"></a>监控Redis</h2><p>监控Redis，也是把包里面对应的文件复制过去就行。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> ./zabbix-master/redis</div><div class="line">cp ./userparameter_redis.conf /etc/zabbix/zabbix_agentd.d/</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#如果redis设置有密码，请加上密码</span></div><div class="line"><span class="comment">#如果是不同的端口，请修改</span></div><div class="line">UserParameter=redis.local[*],redis-cli -h 127.0.0.1 -p 6379 info|grep <span class="variable">$1</span>|grep -v _human|cut -d : -f2</div><div class="line"><span class="comment">#UserParameter=redis.local[*],redis-cli -h 127.0.0.1 -p 6379 -a Password info|grep $1|grep -v _human|cut -d : -f2</span></div><div class="line">UserParameter=redis.status[*],redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> -a Password info|grep <span class="variable">$3</span>|grep -v _human|cut -d : -f2</div><div class="line">UserParameter=redis.proc,pidof redis-server | wc -l</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#重启服务</span></div><div class="line">systemctl restart redis</div></pre></td></tr></table></figure>
<p>导入模板，链接主机，OK。</p>
<p><br></p>
<hr>
<p><br></p>
<h1 id="系统监控"><a href="#系统监控" class="headerlink" title="系统监控"></a>系统监控</h1><p><br></p>
<h2 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h2><p>CPU的性能状态信息：</p>
<table>
<thead>
<tr>
<th>简写</th>
<th>描述</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>us</td>
<td>user cpu tim</td>
<td>用户使用CPU时间</td>
</tr>
<tr>
<td>sy</td>
<td>system cpu time</td>
<td>系统使用CPU时间</td>
</tr>
<tr>
<td>id</td>
<td>idle cpu time</td>
<td>CPU的空闲时间</td>
</tr>
<tr>
<td>wa</td>
<td>io wait cpu time</td>
<td>CPU等待IO时间</td>
</tr>
<tr>
<td>ni</td>
<td>user nice cpu time</td>
<td>用nice调整进程优先级的CPU时间</td>
</tr>
<tr>
<td>st</td>
<td>steal time</td>
<td>虚拟机偷取的CPU时间比，被强制等待虚拟CPU的时间</td>
</tr>
<tr>
<td>si</td>
<td>softirq time</td>
<td>系统处理软件中断所花费的CPU时间</td>
</tr>
<tr>
<td>hi</td>
<td>hard time</td>
<td>系统硬中断所花费的CPU时间</td>
</tr>
<tr>
<td>interrupt</td>
<td>中断</td>
<td>被处理过的中断数</td>
</tr>
<tr>
<td>cs</td>
<td>Context switches</td>
<td>上下文切换</td>
</tr>
<tr>
<td>ql</td>
<td>processor queue length</td>
<td>队列长度</td>
</tr>
<tr>
<td>processor load</td>
<td>processor load</td>
<td>处理器负载，几核乘以几</td>
</tr>
</tbody>
</table>
<p><br></p>
<h3 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h3><ul>
<li>当我们要监控并报警CPU使用率时，我们可以反过来用CPU空闲时间来定义</li>
<li>cpu idle tiem%  + cpu usage time% = 1</li>
<li>(CPU usage time% gt 80%) == (CPU idel time% lt 20%)</li>
<li>(CPU usage time% gt 90%) == (CPU idel time% &lt; 10%)</li>
<li>所以监控CPU使用率就可以监控CPU空闲时间，并依据这个报警</li>
</ul>
<p><br><br><br></p>
<h2 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h2><p>Zabbix中自带的Linux OS模板提供了<code>Total memory</code>和<code>Available memory</code>选项，这两者直接用模板就可以了。<br>但没有提供内存使用率的选项，因此需要我们自定义。</p>
<ul>
<li>内存使用率 = 可用内存 / 总内存</li>
<li>ast(vm.memory.size[available])/last(vm.memory.size[total])</li>
</ul>
<h3 id="自定义内存使用率"><a href="#自定义内存使用率" class="headerlink" title="自定义内存使用率"></a>自定义内存使用率</h3><p>我们只需要在Linux OS模板下配置内存使用率，就可以一劳永逸。</p>
<ol>
<li>配置(Configuration)</li>
<li>模板(Templates)</li>
<li>OS Linux模板的监控项(Items)</li>
<li>创建监控项</li>
<li>监控项名称: Available memory percent</li>
<li>类型： 可计算的</li>
<li>键值： vm.memory.size[percent]</li>
<li>公式： 100*last(vm.memory.size[available])/last(vm.memory.size[total])</li>
<li>记得将其加入Memory应用集，这样便于查找和管理</li>
<li>可加入单位： %</li>
</ol>
<p><br></p>
<p><img src="/images/Zabbix/custom_memorypercent.png" alt="自定义可用内存率"></p>
<p><img src="/images/Zabbix/custom_memorypercent2.png" alt="自定义可用内存率"></p>
<p><img src="/images/Zabbix/custom_memorypercent3.png" alt="效果图"></p>
<p><img src="/images/Zabbix/custom_memorypercent4.png" alt="效果图"></p>
<p><br></p>
<h3 id="添加触发器"><a href="#添加触发器" class="headerlink" title="添加触发器"></a>添加触发器</h3><ol>
<li>配置</li>
<li>模板</li>
<li>OS Linux模板</li>
<li>触发器</li>
<li>创建触发器，当可用内存率在三分钟内的平均值小于20%时报警</li>
<li>名字：Available memory percent lt 20% on {HOST.NAME}</li>
<li>严重性：一般严重</li>
<li>表达式： {Template OS Linux:vm.memory.size[percent].avg(3)}&lt;20</li>
</ol>
<p><br></p>
<p><img src="/images/Zabbix/custom_memorypercent5.png" alt="自定义可用内存率报警"></p>
<p><img src="/images/Zabbix/custom_memorypercent6.png" alt="效果图"></p>
<p><br><br><br></p>
<h2 id="磁盘"><a href="#磁盘" class="headerlink" title="磁盘"></a>磁盘</h2><p>由于Zabbix-Server自带的Linux OS模板中的filesystem的监控是一个自动发现规则，而在应用集中的filesystem是没有监控项的。所有对于磁盘的监控和触发要在自动发现规则中去定义。</p>
<p><br></p>
<p><img src="/images/Zabbix/custom_disk1.png" alt="监控项"></p>
<p><img src="/images/Zabbix/custom_disk2.png" alt="触发器"></p>
<p><img src="/images/Zabbix/custom_disk3.png" alt="触发器"></p>
<p><img src="/images/Zabbix/custom_disk4.png" alt="触发器"></p>
<p><br><br><br></p>
<h2 id="进程和端口"><a href="#进程和端口" class="headerlink" title="进程和端口"></a>进程和端口</h2><p>Zabbix-Server自带有检测进程和端口的键值对。</p>
<h3 id="检测进程数"><a href="#检测进程数" class="headerlink" title="检测进程数"></a>检测进程数</h3><p><code>proc.num[&lt;name&gt;,&lt;user&gt;,&lt;state&gt;,&lt;cmdline&gt;]</code></p>
<ul>
<li>name: 进程名；</li>
<li>user: 运行该进程的用户；</li>
<li>state:<ol>
<li>run</li>
<li>sleep</li>
<li>zomb</li>
</ol>
</li>
<li>cmdline: ps -ef的最后那项，如/usr/bin/mongod -f /etc/mongod.conf</li>
</ul>
<p>现在Zabbix-Server端测试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#zabbix-get --host hostname --key proc.num[&lt;name&gt;,&lt;user&gt;,&lt;state&gt;,&lt;cmdline&gt;]</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#检测mongd进程数量</span></div><div class="line">zabbix-get --host 192.168.1.11 --key proc.num[mongod,,,]</div><div class="line"></div><div class="line"><span class="comment">#2，因为我开了两个mongd实例</span></div><div class="line"></div><div class="line"></div><div class="line">zabbix-get --host 192.168.1.11 --key proc.num[mongod,root,,]</div><div class="line"><span class="comment">#1，只有一个是以root运行的，有一个是以mongod运行的</span></div></pre></td></tr></table></figure>
<p><br></p>
<p>由于我们上面使用的MongoDB监控模板没有判断mongod进程存活与否的判断，此处我们在MongoDB模板中增加一个检查<code>mongod</code>进程的监控项，并创建对应的触发器。</p>
<p><img src="/images/MongoDB/checkmongod.png" alt=""></p>
<p><img src="/images/MongoDB/checkmongod2.png" alt=""></p>
<p><br></p>
<h3 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h3><p><code>net.tcp.listen[port]</code>    检查 TCP 端口 是否处于侦听状态。返回 0 - 未侦听；1 - 正在侦听</p>
<p>此处我也用Mongod举例。我的两个mongod实例分别监听在27017,27018/tcp。</p>
<p><br></p>
<p>在Zabbix-Server端先测试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#net.tcp.listen[port]</span></div><div class="line"></div><div class="line">zabbix-get --host 192.168.1.11 --key net.tcp.listen[27017]</div><div class="line"><span class="comment">#1</span></div><div class="line">zabbix-get --host 192.168.1.11 --key net.tcp.listen[27018]</div><div class="line"><span class="comment">#1</span></div></pre></td></tr></table></figure>
<p>在Web端创建监控项和触发器与上面类似。</p>
<p><br></p>
<hr>
<p><br></p>
<h1 id="用户自定义参数-user-parameter-1"><a href="#用户自定义参数-user-parameter-1" class="headerlink" title="用户自定义参数(user parameter)"></a>用户自定义参数(user parameter)</h1><p>我也是参考了上述大神的脚本，进行参考而来。</p>
<p>由于公司需要监控大量的Web页面和API接口的状态，并通过页面判断相关key-value的正确性，用以判断状态。此处可能由模拟登录等操作，Zabbix自带的Web监控不太够用，所以此处自定义用户参数来实现。</p>
<p>此处，我叫公司开发人员帮忙将全部接口以及Web页面内容都生成到一个json文件里，如 <a href="http://zhang21.cn/test.json" target="_blank" rel="noopener">http://zhang21.cn/test.json</a>。然后用<code>jq</code>命令解析json文件，里面key一一对应value，这样取值就很方便了。</p>
<p><br><br><br></p>
<h2 id="jq"><a href="#jq" class="headerlink" title="jq"></a>jq</h2><p>jq 是一款命令行下处理 JSON 数据的工具。真的很好用！</p>
<p>jq官网：<a href="https://stedolan.github.io/jq/" target="_blank" rel="noopener">https://stedolan.github.io/jq/</a><br>GitHub: <a href="https://github.com/stedolan/jq" target="_blank" rel="noopener">https://github.com/stedolan/jq</a></p>
<p><br></p>
<p><strong>安装jq</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y jq</div></pre></td></tr></table></figure>
<p><br></p>
<p><strong>使用jq</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">jq --<span class="built_in">help</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#查看所有键键值</span></div><div class="line">curl --silent http://zhang21.cn/test.json | jq .</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">###栗子</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"collapsectimes"</span>: 130,</div><div class="line">  <span class="string">"collapsectimes"</span>: 0,</div><div class="line">  <span class="string">"bootfailtimes"</span>: 23,</div><div class="line">  <span class="string">"failrate"</span>: 0.3623,</div><div class="line">  <span class="string">"bootrate"</span>: 0.3324,</div><div class="line">  <span class="string">"time"</span>: <span class="string">"2018-01-25 15:03:30"</span>,</div><div class="line">  <span class="string">"db_error"</span>: <span class="literal">false</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#查看某个键值</span></div><div class="line">curl --silent http://zhang21.cn/test.json | jq <span class="string">'.time'</span></div><div class="line">curl --silent http://zhang21.cn/test.json | jq <span class="string">'.bootrate'</span></div><div class="line"></div><div class="line"><span class="comment">###</span></div><div class="line">2018-01-25 15:03:30</div><div class="line">0.3324</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#查看某个不存在的值，会返回null</span></div><div class="line">curl --silent http://zhang21.cn/test.json | jq <span class="string">'.zhang'</span></div><div class="line"></div><div class="line"><span class="comment">###</span></div><div class="line">null</div></pre></td></tr></table></figure>
<p><img src="/images/Zabbix/jq01.png" alt=""></p>
<p><br></p>
<p><strong>json嵌套解析</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cat test.json | jq <span class="string">'.location.city'</span></div><div class="line"></div><div class="line"><span class="comment">###</span></div><div class="line"><span class="string">"Chengdu"</span></div></pre></td></tr></table></figure>
<p><br></p>
<p><strong>json解析数组</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cat test.json | jq <span class="string">'.array[1].name'</span></div><div class="line"></div><div class="line"><span class="comment">###</span></div><div class="line"><span class="string">"Zhang"</span></div></pre></td></tr></table></figure>
<p><br></p>
<p><strong>内建函数</strong></p>
<p>jq还有一些内建函数，如<code>key</code>,<code>hss</code>。</p>
<p>key用来获取json中的key元素：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">curl --silent http://zhang21.cn/test.json | jq <span class="string">'keys'</span></div><div class="line"></div><div class="line"><span class="comment">###</span></div><div class="line">[</div><div class="line">	collapsectimes,</div><div class="line">	collapsectimes,</div><div class="line">	bootfailtimes,</div><div class="line">	failrate,</div><div class="line">	bootrate,</div><div class="line">	time,</div><div class="line">	db_error</div><div class="line">]</div></pre></td></tr></table></figure>
<p>has用来判断是否存在某个key:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">curl --silent http://zhang21.cn/test.json | jq <span class="string">'has("time")'</span></div><div class="line"></div><div class="line"><span class="comment">###</span></div><div class="line"><span class="literal">true</span></div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="jq的select语句"><a href="#jq的select语句" class="headerlink" title="jq的select语句"></a>jq的select语句</h3><p>使用select函数来完成jq的过滤操作。<br>jq的select语句太好了!</p>
<p>select 接受一个条件表达式作为参数。其输入可以是迭代器，或者和 map 函数配合使用来处理数组。当输入中的某个元素使 select 参数中的条件表达式结果为真时，则在结果中保留该元素，否则不保留该元素。</p>
<p>对json文件的值是数组的，根据数据里面的key在取值，厉害厉害。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">cat zhang.json</div><div class="line"></div><div class="line"><span class="string">"array"</span>: [</div><div class="line">&#123;</div><div class="line">	<span class="string">"ip"</span>: <span class="string">"192.168.1.11"</span>,</div><div class="line">	<span class="string">"loads"</span>: 1234</div><div class="line">&#125;,</div><div class="line">&#123;</div><div class="line">	<span class="string">"ip"</span>: <span class="string">"192.168.1.22"</span>,</div><div class="line">    <span class="string">"loads"</span>: 567</div><div class="line">&#125;</div><div class="line">]</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">####栗子</span></div><div class="line">cat /etc/zabbix/zhang.json | jq <span class="string">".array[] | select(.ip == \"192.168.1.11\")"</span></div><div class="line">&#123;</div><div class="line">	<span class="string">"ip"</span>: <span class="string">"192.168.1.11"</span>,</div><div class="line">	<span class="string">"loads"</span>: 1234</div><div class="line">&#125;</div><div class="line"></div><div class="line">cat /etc/zabbix/zhang.json | jq <span class="string">".array[] | select(.ip == \"192.168.1.11\").loads"</span></div><div class="line">1234</div><div class="line"></div><div class="line">我们在自定义用户参数的时候便可以将ip作为参数传入</div><div class="line">cat /etc/zabbix/zhang.json | jq <span class="string">".array[] | select(.ip == \"<span class="variable">$1</span>\").loads"</span></div></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="编写自定义参数和脚本"><a href="#编写自定义参数和脚本" class="headerlink" title="编写自定义参数和脚本"></a>编写自定义参数和脚本</h2><p>将脚本放置于<code>/etc/zabbix</code>，可将自定义参数写入zabbix-agentd.conf文件，也可单独写入<code>/etc/zabbix/zabbix_agentd.d/</code>(推荐)，这样修改更方便。</p>
<p><br></p>
<h3 id="编写脚本文件"><a href="#编写脚本文件" class="headerlink" title="编写脚本文件"></a>编写脚本文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /etc/zabbix</div><div class="line"></div><div class="line">vim xbreport.sh</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">##########</span></div><div class="line"></div><div class="line"><span class="comment"># Zabbix3.4</span></div><div class="line"><span class="comment"># Zhang21</span></div><div class="line"><span class="comment"># Thu Jan 25 15:20:44 CST 2018</span></div><div class="line"></div><div class="line"><span class="comment">###########</span></div><div class="line"></div><div class="line">url=<span class="string">"http://zhang21.cn/test.json"</span></div><div class="line"></div><div class="line">JQ=`<span class="built_in">which</span> jq`</div><div class="line">CURL=`<span class="built_in">which</span> curl`</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">XBREPORT</span></span>() &#123;</div><div class="line">        <span class="variable">$CURL</span> --silent <span class="variable">$url</span> | <span class="variable">$JQ</span> <span class="string">".<span class="variable">$1</span>"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> == 0 ]; <span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> $<span class="string">"Usage <span class="variable">$0</span> &#123;browsercollapsectimes|servercollapsectimes|xiaobaibootfailtimes|terminaldesktopfailrate|competebootrate|db_error&#125;"</span></div><div class="line">        <span class="built_in">exit</span></div><div class="line"><span class="keyword">else</span></div><div class="line">        XBREPORT <span class="string">"<span class="variable">$1</span>"</span></div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<p><img src="/images/Zabbix/jq02.png" alt=""></p>
<p><br></p>
<h3 id="编写自定义参数文件"><a href="#编写自定义参数文件" class="headerlink" title="编写自定义参数文件"></a>编写自定义参数文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /etc/zabbix/zabbix_agentd.d</div><div class="line"></div><div class="line">vim userparameter_XBreport.conf</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">##########</span></div><div class="line"><span class="comment"># Zabbix3.4</span></div><div class="line"><span class="comment"># Zhang21</span></div><div class="line"><span class="comment"># Thu Jan 25 15:45:19 CST 2018</span></div><div class="line"><span class="comment">##########</span></div><div class="line"></div><div class="line">UserParameter=XBreport[*],/etc/zabbix/xbreport.sh <span class="variable">$1</span></div></pre></td></tr></table></figure>
<p><img src="/images/Zabbix/jq03.jpg" alt=""></p>
<p><br></p>
<h3 id="测试自定义参数"><a href="#测试自定义参数" class="headerlink" title="测试自定义参数"></a>测试自定义参数</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">zabbix_get --host host --key XBreport[time]</div><div class="line"></div><div class="line"><span class="comment">###</span></div><div class="line"><span class="string">"2018-01-25 17:03:18"</span></div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="自定义用户参数额外"><a href="#自定义用户参数额外" class="headerlink" title="自定义用户参数额外"></a>自定义用户参数额外</h3><p>由于我的json文件key对应的value中内嵌有数组，所以我需要再提取数组内的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">curl http://zhang21.cn/test.json | jq &apos;.array&apos;</div><div class="line"></div><div class="line"></div><div class="line">###</div><div class="line">[</div><div class="line">  &#123;</div><div class="line">    &quot;ip&quot;: &quot;1.1.1.1&quot;,</div><div class="line">    &quot;loads&quot;: 1051</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    &quot;ip&quot;: &quot;2.2.2.2&quot;,</div><div class="line">    &quot;loads&quot;: 356</div><div class="line">  &#125;</div><div class="line">]</div><div class="line"></div><div class="line"></div><div class="line">#array[],array[1],array[2],array[n]</div><div class="line">#array[].ip, array[1].ip</div><div class="line">#array[].loads, array[2].loads</div></pre></td></tr></table></figure>
<p>上面的数据中包含有zabbix无法解析的特殊符号，所以需要改变策略。</p>
<p><br></p>
<p>由于zabbix对UserParameter中包含<strong>\’”`*?[]{}~$?&amp;;()&lt;&gt;|#@</strong>这些特殊字符无法进行处理，此处有两种方法来解决。</p>
<ol>
<li>在<code>zabbix_agentd.conf</code>中开启参数<code>UnsafeUserParameters</code>，将其值设置为1</li>
<li>或者，使用多个变量<code>$1 $2 $3...</code>来解决我这个数组值的问题</li>
</ol>
<p><br></p>
<p>我是使用多个变量来解决我这个情况的。<br>看下脚本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">cd /etc/zabbix</div><div class="line"></div><div class="line">vim ./zhang.sh</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">url=&apos;http://www.zhang21.cn/test.json&apos;</div><div class="line">JQ=`which jq`</div><div class="line">CURL=`which curl`</div><div class="line"></div><div class="line">function ZHANG() &#123;</div><div class="line">        $CURL --silent $url | $JQ &quot;.$1&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">if [ $# == 0 ]; then</div><div class="line">        echo $&quot;Usage $0 &#123;aaa|bbb|ccc|...&#125;&quot;</div><div class="line">        exit</div><div class="line">elif [ $# ==1 ]; then</div><div class="line">		ZHANG &quot;$1&quot;</div><div class="line">elif [ $# == 2 ]; then</div><div class="line">        ZHANG &quot;$1[$2]&quot;</div><div class="line">else</div><div class="line">        ZHANG &quot;$1[$2].$3&quot;</div><div class="line">fi</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">cd /etc/zabbix/zabbix_agentd.d/userparameter_Zhang.conf</div><div class="line"></div><div class="line">UserParameter=Zhangxx[*],/etc/zabbix/zhang.sh $1 $2 $3</div></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">systemctl restart zabbix-agentd</div><div class="line"></div><div class="line">zabbix_get --host host --key Zhangxx[array]</div><div class="line">zabbix_get --host host --key Zhangxx[array,0]</div><div class="line">zabbix_get --host host --key Zhangxx[array,0,loads]</div><div class="line">zabbix_get --host host --key Zhangxx[array,1,ip]</div></pre></td></tr></table></figure>
<p><br></p>
<p>测试正确能取到值的话，在Web端设置相对应的监控项。注意自己定义的<code>key</code>不要写错了。</p>
<p>数组的<code>key</code>栗子：</p>
<ul>
<li>Zhangxx[array]</li>
<li>Zhangxx[array,0]或Zhangxx[array,1]</li>
<li>Zhangxx[array,0,ip], Zhangxx[array,0,loads]</li>
</ul>
<p><br></p>
<h3 id="在Web端添加监控项"><a href="#在Web端添加监控项" class="headerlink" title="在Web端添加监控项"></a>在Web端添加监控项</h3><p>由于这个参数是我们自定义的，所以在填写监控项key的时候需要我们手动填写自己定义的参数。<br>注意监控项的参数和信息类型。</p>
<p><img src="/images/Zabbix/userparameter.png" alt=""></p>
<p><img src="/images/Zabbix/userparameter02.png" alt=""></p>
<p><img src="/images/Zabbix/userparameter03.png" alt=""></p>
<p><br></p>
<p>这里我遇到一个问题，我自定义key的执行脚本在Web端报超时问题，无法取值。这是由于zabbix默认的脚本执行超时时间为3s，所以我们需要修改超时时间30s(最大值)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vim /etc/zabbix/zabbix_server.conf</div><div class="line">vim /etc/zabbix/zabbix_agentd.conf</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="设置触发器和报警"><a href="#设置触发器和报警" class="headerlink" title="设置触发器和报警"></a>设置触发器和报警</h3><p>这个就根据你个人项目实际情况设置对于的触发器和报警。</p>
<p><br></p>
<hr>
<p><br></p>
<h1 id="短信报警"><a href="#短信报警" class="headerlink" title="短信报警"></a>短信报警</h1><h2 id="腾讯短信服务"><a href="#腾讯短信服务" class="headerlink" title="腾讯短信服务"></a>腾讯短信服务</h2><p>由于公司使用的是腾讯企业邮箱，可以将邮箱直接与微信绑定，从而在微信中实时显示邮件消息，所以不用微信报警！</p>
<p>此处使用的腾讯短信SMS服务： <a href="https://cloud.tencent.com/product/sms" target="_blank" rel="noopener">https://cloud.tencent.com/product/sms</a></p>
<ul>
<li>短信文档： <a href="https://cloud.tencent.com/document/product/382/13445" target="_blank" rel="noopener">https://cloud.tencent.com/document/product/382/13445</a></li>
<li>API文档： <a href="https://cloud.tencent.com/document/product/382/13297" target="_blank" rel="noopener">https://cloud.tencent.com/document/product/382/13297</a></li>
<li>SDK文档： <a href="https://cloud.tencent.com/document/product/382/5804" target="_blank" rel="noopener">https://cloud.tencent.com/document/product/382/5804</a></li>
<li>Python SDK: <a href="https://cloud.tencent.com/document/product/382/11672" target="_blank" rel="noopener">https://cloud.tencent.com/document/product/382/11672</a></li>
</ul>
<p>由于腾讯提供了程序SDK，所以我选择了linux自带的Python SDK。<br>这里面有详细的Python使用方法，做一些小修改就可以使用了。</p>
<p><img src="/images/Zabbix/SDK.png" alt=""></p>
<p><br><br><br></p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="获取Python-SDK"><a href="#获取Python-SDK" class="headerlink" title="获取Python SDK"></a>获取Python SDK</h3><p>获取Python SDK</p>
<p><br></p>
<h3 id="申请SDK-AppID和App-Key"><a href="#申请SDK-AppID和App-Key" class="headerlink" title="申请SDK AppID和App Key"></a>申请SDK AppID和App Key</h3><p>申请SDK AppID以及APP Key。</p>
<p>申请完毕后，效果如下：</p>
<p><img src="/images/Zabbix/SDK02.png" alt=""></p>
<p><br></p>
<h3 id="申请短信签名"><a href="#申请短信签名" class="headerlink" title="申请短信签名"></a>申请短信签名</h3><p>下发短信必须携带短信签名。<br>短信签名需要上传公司证件进行认证，大概十分钟左右！</p>
<p>效果如下：</p>
<p><img src="/images/Zabbix/SDK03.png" alt=""></p>
<p><br></p>
<h3 id="申请短信模板"><a href="#申请短信模板" class="headerlink" title="申请短信模板"></a>申请短信模板</h3><p>下发短信内容必须经过审核。<br>在此短信模板中，我们必须要定义相关变量<code>{n}</code>，其他都是不会变化的常量。此处我定义了五个变量，分别为了带入Zabbix中的宏：</p>
<ul>
<li>问题名，{TRIGGER.NAME}</li>
<li>主机名，{HOST.NAME}</li>
<li>事件事件，{EVENT.TIME}</li>
<li>事件日期，{EVENT.DATE}</li>
<li>URL，{TRIGGER.URL}</li>
</ul>
<p><img src="/images/Zabbix/SDK04.png" alt=""></p>
<p><br></p>
<h3 id="SDK配置"><a href="#SDK配置" class="headerlink" title="SDK配置"></a>SDK配置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">yum install -y eple-realse</div><div class="line">yum install -y python-pip</div><div class="line"></div><div class="line">pip install qcloudsms</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Python代码配置"><a href="#Python代码配置" class="headerlink" title="Python代码配置"></a>Python代码配置</h3><p>腾讯文档：<a href="https://cloud.tencent.com/document/product/382/11672" target="_blank" rel="noopener">https://cloud.tencent.com/document/product/382/11672</a></p>
<p>由于我是向多人发送短信，所以做了小修改：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#zabbix-server</span></div><div class="line">cd /usr/lib/zabbis/alartscripts</div><div class="line"></div><div class="line"></div><div class="line">vim sendSms.py</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#!/bin/python</span></div><div class="line"><span class="comment">#coding: utf-8</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> qcloudsms_py <span class="keyword">import</span> SmsSingleSender</div><div class="line"><span class="keyword">from</span> qcloudsms_py.httpclient <span class="keyword">import</span> HTTPError</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line"></div><div class="line">appid = App ID</div><div class="line">appkey = App Key</div><div class="line">phone_numbers = [<span class="string">"12345"</span>, <span class="string">"1234567"</span>]</div><div class="line"><span class="comment">#params = ["Problem", "Hostname", "Time", "Date","Url"]</span></div><div class="line">params = [sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>], sys.argv[<span class="number">3</span>], sys.argv[<span class="number">4</span>], sys.argv[<span class="number">5</span>]]</div><div class="line"></div><div class="line"></div><div class="line">msender = SmsSingleSender(appid, appkey)</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> phone_numbers:</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        result = msender.send_with_param(<span class="number">86</span>, i, 短信内容模板ID, params)</div><div class="line">    <span class="keyword">except</span> HTTPError <span class="keyword">as</span> e:</div><div class="line">        print(e)</div><div class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">        print(e)</div><div class="line">    print(result)</div></pre></td></tr></table></figure>
<p>要给sendSms.py加上可执行权限哈！<code>chmod a+x ./sendSms.py</code>。</p>
<p><br></p>
<p><code>sys.argv</code>变量是一个字符串的列表。特别地，<code>sys.argv</code>包含了命令行参数 的列表，即使用命令行传递给你的程序的参数。<br>使用Python的<code>sys.argv[n]</code>可以像shell一样将放在文件后的变量传入文件执行。此处对于在Zabbix-Web端将宏放在脚本后，作为变量传入，非常重要。</p>
<ul>
<li><code>sys.argv[0]</code>代表sendSms.py文件</li>
<li><code>sys.argv[1]</code>才代表第一个参数。</li>
</ul>
<p><img src="/images/Zabbix/SDK05.jpg" alt=""></p>
<p><br><br><br></p>
<h2 id="Zabbix-Web端配置"><a href="#Zabbix-Web端配置" class="headerlink" title="Zabbix Web端配置"></a>Zabbix Web端配置</h2><p>配置-动作-创建动作-操作</p>
<p>注意事项：</p>
<ul>
<li>建议针对触发器示警度最高就行短信报警，其它交给Email</li>
<li>操作类型，选择远程命令</li>
<li>目标列表，选择当前主机</li>
<li>类型，自定义脚本</li>
<li>执行在，这个一定是放在Zabbix-Server上来执行哈</li>
<li>命令，文件名SendSms.py后面接的宏一定要加上<strong>双引号(“”)</strong></li>
</ul>
<p><img src="/images/Zabbix/SDK06.png" alt=""></p>
<p><img src="/images/Zabbix/SDK07.png" alt=""></p>
<p>最后根据不同的内容，设置不同的报警机制。后台的脚本也修改为对应的名称，修改里面对应的手机号码。</p>
<ul>
<li>首先根据不同报警设置不同的触发条件</li>
<li>运维组，SendSms_dev.py，修改运维对应的号码</li>
<li>开发组，SendSms_develop.py，修改对于的号码</li>
</ul>
<p><br></p>
<p>其实这个发送短信，就是在执行远程命令。</p>
<p>你命令里是发送短信就发送短信，你命令里是发送邮件就发送邮件。这个还是挺不错的。</p>
<p><br></p>
<hr>
<p><br></p>
<h1 id="针对不同业务向不同人员报警"><a href="#针对不同业务向不同人员报警" class="headerlink" title="针对不同业务向不同人员报警"></a>针对不同业务向不同人员报警</h1><p>有时候我们只需要关心我们自己那部分就可以了，没必要所有报警都发送给所有人，这样很不方便。</p>
<p>所以，我们可以根据业务相关，组别权限等，分别向不同的人报警不同的信息。</p>
<p>如下我的一个栗子图：</p>
<p><img src="/images/Zabbix/action.png" alt=""></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Zabbix/" rel="tag"># Zabbix</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/11/06/Love-at-First-Sight/" rel="next" title="Love at First Sight">
                <i class="fa fa-chevron-left"></i> Love at First Sight
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/11/27/FHS/" rel="prev" title="Filesystem Hierarchy Standard">
                Filesystem Hierarchy Standard <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/images/leslie.jpg"
              alt="Zhang21" />
          
            <p class="site-author-name" itemprop="name">Zhang21</p>
            <p class="site-description motion-element" itemprop="description">踏踏实实谋发展</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/f13278e94ecb" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-circle-o"></i>简书</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/Zhang21" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:elite_zhang21@163.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://instagram.com/Zhang21_" target="_blank" title="Instagram">
                  
                    <i class="fa fa-fw fa-instagram"></i>Instagram</a>
              </span>
            
          
        </div>

        
        

        
        
<br>
<!--����������������ⲿ����,auto=1��ʾ�Զ�����-->
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=411315632&auto=0&height=66"></iframe>


        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Zabbix简介"><span class="nav-number">1.</span> <span class="nav-text">Zabbix简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Zabbix的系统构成"><span class="nav-number">1.1.</span> <span class="nav-text">Zabbix的系统构成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zabbix的特点"><span class="nav-number">1.2.</span> <span class="nav-text">Zabbix的特点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#定义"><span class="nav-number">2.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Zabbix进程"><span class="nav-number">3.</span> <span class="nav-text">Zabbix进程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Agent"><span class="nav-number">3.1.</span> <span class="nav-text">Agent</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Server"><span class="nav-number">3.2.</span> <span class="nav-text">Server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Proxy"><span class="nav-number">3.3.</span> <span class="nav-text">Proxy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-gateway"><span class="nav-number">3.4.</span> <span class="nav-text">Java gateway</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Sender"><span class="nav-number">3.5.</span> <span class="nav-text">Sender</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Get"><span class="nav-number">3.6.</span> <span class="nav-text">Get</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装Zabbix"><span class="nav-number">4.</span> <span class="nav-text">安装Zabbix</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Zabbix安装要求"><span class="nav-number">4.1.</span> <span class="nav-text">Zabbix安装要求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装、启动、配置Zabbix"><span class="nav-number">4.2.</span> <span class="nav-text">安装、启动、配置Zabbix</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置源码库"><span class="nav-number">4.2.1.</span> <span class="nav-text">配置源码库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装Zabbix部署包"><span class="nav-number">4.2.2.</span> <span class="nav-text">安装Zabbix部署包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装初始化数据库"><span class="nav-number">4.2.3.</span> <span class="nav-text">安装初始化数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置zabbix-server并启动"><span class="nav-number">4.2.4.</span> <span class="nav-text">配置zabbix server并启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装zabbix-web"><span class="nav-number">4.2.5.</span> <span class="nav-text">安装zabbix web</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编辑zabbix的前端Apach-PHP配置文件"><span class="nav-number">4.2.6.</span> <span class="nav-text">编辑zabbix的前端Apach-PHP配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在web端配置zabbix"><span class="nav-number">4.2.7.</span> <span class="nav-text">在web端配置zabbix</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装zabbix-agent"><span class="nav-number">4.3.</span> <span class="nav-text">安装zabbix agent</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#快速开始zabbix-web菜单"><span class="nav-number">5.</span> <span class="nav-text">快速开始zabbix-web菜单</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#登录和配置用户"><span class="nav-number">5.1.</span> <span class="nav-text">登录和配置用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#新建主机"><span class="nav-number">5.2.</span> <span class="nav-text">新建主机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#新建监控项"><span class="nav-number">5.3.</span> <span class="nav-text">新建监控项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#新建触发器"><span class="nav-number">5.4.</span> <span class="nav-text">新建触发器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取问题通知"><span class="nav-number">5.5.</span> <span class="nav-text">获取问题通知</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#新建模板"><span class="nav-number">5.6.</span> <span class="nav-text">新建模板</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#配置-Configuration"><span class="nav-number">6.</span> <span class="nav-text">配置(Configuration)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#主机和主机组-Hosts-and-groups"><span class="nav-number">6.1.</span> <span class="nav-text">主机和主机组(Hosts and groups)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置一台主机"><span class="nav-number">6.1.1.</span> <span class="nav-text">配置一台主机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#资产管理-Inventory"><span class="nav-number">6.1.2.</span> <span class="nav-text">资产管理(Inventory)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#批量更新-Mass-update"><span class="nav-number">6.1.3.</span> <span class="nav-text">批量更新(Mass update)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#监控项-Items"><span class="nav-number">6.2.</span> <span class="nav-text">监控项(Items)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建一个监控项"><span class="nav-number">6.2.1.</span> <span class="nav-text">创建一个监控项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#监控项类型-Items-type"><span class="nav-number">6.2.2.</span> <span class="nav-text">监控项类型(Items type)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#历史与趋势-history-and-trends"><span class="nav-number">6.2.3.</span> <span class="nav-text">历史与趋势(history and trends)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用户自定义参数-user-parameter"><span class="nav-number">6.2.4.</span> <span class="nav-text">用户自定义参数(user parameter)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可加载模块-loadable-modules"><span class="nav-number">6.2.5.</span> <span class="nav-text">可加载模块(loadable modules)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#windows性能计数器-windows-perfomance-counter"><span class="nav-number">6.2.6.</span> <span class="nav-text">windows性能计数器(windows perfomance counter)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#批量更新-mass-update"><span class="nav-number">6.2.7.</span> <span class="nav-text">批量更新(mass update)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#值映射-value-mapping"><span class="nav-number">6.2.8.</span> <span class="nav-text">值映射(value mapping)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#应用集-Application"><span class="nav-number">6.2.9.</span> <span class="nav-text">应用集(Application)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#队列-queue"><span class="nav-number">6.2.10.</span> <span class="nav-text">队列(queue)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#值缓存-value-cache"><span class="nav-number">6.2.11.</span> <span class="nav-text">值缓存(value cache)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#触发器-Trigger"><span class="nav-number">6.3.</span> <span class="nav-text">触发器(Trigger)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置一个触发器-configuring-a-trigger"><span class="nav-number">6.3.1.</span> <span class="nav-text">配置一个触发器(configuring a trigger)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#触发器表达式-trigger-expression"><span class="nav-number">6.3.2.</span> <span class="nav-text">触发器表达式(trigger expression)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#触发器依赖-trigger-dependency"><span class="nav-number">6.3.3.</span> <span class="nav-text">触发器依赖(trigger dependency)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#批量更新"><span class="nav-number">6.3.4.</span> <span class="nav-text">批量更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#触发器严重性-trigger-severity"><span class="nav-number">6.3.5.</span> <span class="nav-text">触发器严重性(trigger severity)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义触发器严重性-customising-trigger"><span class="nav-number">6.3.6.</span> <span class="nav-text">自定义触发器严重性(customising trigger)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#预测触发功能-predictive-trigger-function"><span class="nav-number">6.3.7.</span> <span class="nav-text">预测触发功能(predictive trigger function)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事件标签-event-tag"><span class="nav-number">6.3.8.</span> <span class="nav-text">事件标签(event tag)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事件-Events"><span class="nav-number">6.4.</span> <span class="nav-text">事件(Events)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#触发器事件生成-trigger-events-generation"><span class="nav-number">6.4.1.</span> <span class="nav-text">触发器事件生成(trigger events generation)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#手动关闭问题事件-manual-closing-of-problems"><span class="nav-number">6.4.2.</span> <span class="nav-text">手动关闭问题事件(manual closing of problems)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他事件来源-other-event-source"><span class="nav-number">6.4.3.</span> <span class="nav-text">其他事件来源(other event source)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事件关联-event-correlation"><span class="nav-number">6.5.</span> <span class="nav-text">事件关联(event correlation)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可视化-visualisation"><span class="nav-number">6.6.</span> <span class="nav-text">可视化(visualisation)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#图形-graphs"><span class="nav-number">6.6.1.</span> <span class="nav-text">图形(graphs)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#拓扑图-networking-maps"><span class="nav-number">6.6.2.</span> <span class="nav-text">拓扑图(networking maps)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#聚合图形-screen"><span class="nav-number">6.6.3.</span> <span class="nav-text">聚合图形(screen)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#幻灯片演示-slide-shows"><span class="nav-number">6.6.4.</span> <span class="nav-text">幻灯片演示(slide shows)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模板-template"><span class="nav-number">6.7.</span> <span class="nav-text">模板(template)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事件通知-notifications-upon-events"><span class="nav-number">6.8.</span> <span class="nav-text">事件通知(notifications upon events)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#media类型"><span class="nav-number">6.8.1.</span> <span class="nav-text">media类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#actions"><span class="nav-number">6.8.2.</span> <span class="nav-text">actions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#条件-condition"><span class="nav-number">6.8.2.1.</span> <span class="nav-text">条件(condition)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#操作-operation"><span class="nav-number">6.8.2.2.</span> <span class="nav-text">操作(operation)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#发送消息"><span class="nav-number">6.8.2.2.1.</span> <span class="nav-text">发送消息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#远程命令"><span class="nav-number">6.8.2.2.2.</span> <span class="nav-text">远程命令</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#宏-macros"><span class="nav-number">6.9.</span> <span class="nav-text">宏(macros)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#宏函数-macro-function"><span class="nav-number">6.9.1.</span> <span class="nav-text">宏函数(macro function)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用户宏-user-macro"><span class="nav-number">6.9.2.</span> <span class="nav-text">用户宏(user macro)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自动发现宏-LLD"><span class="nav-number">6.9.3.</span> <span class="nav-text">自动发现宏(LLD)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用户和用户组-user-and-group"><span class="nav-number">6.10.</span> <span class="nav-text">用户和用户组(user and group)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#服务监控-service-monitoring"><span class="nav-number">7.</span> <span class="nav-text">服务监控(service monitoring)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Web监控-web-monitoring"><span class="nav-number">8.</span> <span class="nav-text">Web监控(web monitoring)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Web监控项-web-monitoring-items"><span class="nav-number">8.1.</span> <span class="nav-text">Web监控项(web monitoring items)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#虚拟机监控-VM-monitoring"><span class="nav-number">9.</span> <span class="nav-text">虚拟机监控(VM monitoring)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#维护-maintenance"><span class="nav-number">10.</span> <span class="nav-text">维护(maintenance)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#事件确认-event-acknowledgment"><span class="nav-number">11.</span> <span class="nav-text">事件确认(event acknowledgment)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#配置导出-导入-Configuration-export-import"><span class="nav-number">12.</span> <span class="nav-text">配置导出/导入(Configuration export/import)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#将Zabbix展现在Nginx上"><span class="nav-number">13.</span> <span class="nav-text">将Zabbix展现在Nginx上</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Zabbix监控"><span class="nav-number">14.</span> <span class="nav-text">Zabbix监控</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#监控MySQL"><span class="nav-number">14.1.</span> <span class="nav-text">监控MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Zabbix自带模板监控MySQL"><span class="nav-number">14.1.1.</span> <span class="nav-text">使用Zabbix自带模板监控MySQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Percona插件监控MySQL"><span class="nav-number">14.1.2.</span> <span class="nav-text">使用Percona插件监控MySQL</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#监控MongoDB"><span class="nav-number">14.2.</span> <span class="nav-text">监控MongoDB</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装步骤"><span class="nav-number">14.2.1.</span> <span class="nav-text">安装步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#监控一台主机上的额外mongod实例"><span class="nav-number">14.2.2.</span> <span class="nav-text">监控一台主机上的额外mongod实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#监控PHP-FPM"><span class="nav-number">14.3.</span> <span class="nav-text">监控PHP-FPM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#监控Nginx"><span class="nav-number">14.4.</span> <span class="nav-text">监控Nginx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#监控Redis"><span class="nav-number">14.5.</span> <span class="nav-text">监控Redis</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#系统监控"><span class="nav-number">15.</span> <span class="nav-text">系统监控</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#CPU"><span class="nav-number">15.1.</span> <span class="nav-text">CPU</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Tips"><span class="nav-number">15.1.1.</span> <span class="nav-text">Tips</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内存"><span class="nav-number">15.2.</span> <span class="nav-text">内存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义内存使用率"><span class="nav-number">15.2.1.</span> <span class="nav-text">自定义内存使用率</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加触发器"><span class="nav-number">15.2.2.</span> <span class="nav-text">添加触发器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#磁盘"><span class="nav-number">15.3.</span> <span class="nav-text">磁盘</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#进程和端口"><span class="nav-number">15.4.</span> <span class="nav-text">进程和端口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#检测进程数"><span class="nav-number">15.4.1.</span> <span class="nav-text">检测进程数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#端口"><span class="nav-number">15.4.2.</span> <span class="nav-text">端口</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#用户自定义参数-user-parameter-1"><span class="nav-number">16.</span> <span class="nav-text">用户自定义参数(user parameter)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#jq"><span class="nav-number">16.1.</span> <span class="nav-text">jq</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#jq的select语句"><span class="nav-number">16.1.1.</span> <span class="nav-text">jq的select语句</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编写自定义参数和脚本"><span class="nav-number">16.2.</span> <span class="nav-text">编写自定义参数和脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#编写脚本文件"><span class="nav-number">16.2.1.</span> <span class="nav-text">编写脚本文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编写自定义参数文件"><span class="nav-number">16.2.2.</span> <span class="nav-text">编写自定义参数文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试自定义参数"><span class="nav-number">16.2.3.</span> <span class="nav-text">测试自定义参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义用户参数额外"><span class="nav-number">16.2.4.</span> <span class="nav-text">自定义用户参数额外</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在Web端添加监控项"><span class="nav-number">16.2.5.</span> <span class="nav-text">在Web端添加监控项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置触发器和报警"><span class="nav-number">16.2.6.</span> <span class="nav-text">设置触发器和报警</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#短信报警"><span class="nav-number">17.</span> <span class="nav-text">短信报警</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#腾讯短信服务"><span class="nav-number">17.1.</span> <span class="nav-text">腾讯短信服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置"><span class="nav-number">17.2.</span> <span class="nav-text">配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#获取Python-SDK"><span class="nav-number">17.2.1.</span> <span class="nav-text">获取Python SDK</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#申请SDK-AppID和App-Key"><span class="nav-number">17.2.2.</span> <span class="nav-text">申请SDK AppID和App Key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#申请短信签名"><span class="nav-number">17.2.3.</span> <span class="nav-text">申请短信签名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#申请短信模板"><span class="nav-number">17.2.4.</span> <span class="nav-text">申请短信模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SDK配置"><span class="nav-number">17.2.5.</span> <span class="nav-text">SDK配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Python代码配置"><span class="nav-number">17.2.6.</span> <span class="nav-text">Python代码配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zabbix-Web端配置"><span class="nav-number">17.3.</span> <span class="nav-text">Zabbix Web端配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#针对不同业务向不同人员报警"><span class="nav-number">18.</span> <span class="nav-text">针对不同业务向不同人员报警</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 &mdash; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhang21</span>

<!--字数统计-->
  <div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count"> 字数: 178.7k</span>
</div>


  
</div>



<!--

  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.2</div>

-->


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  

    
      <script id="dsq-count-scr" src="https://Zhang21.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://zhang21.github.io/2017/11/14/Zabbix/';
          this.page.identifier = '2017/11/14/Zabbix/';
          this.page.title = 'Zabbix';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://Zhang21.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->





  

  

  

  
  


  

  

</body>
</html>
